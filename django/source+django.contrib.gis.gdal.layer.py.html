<!DOCTYPE html><html><head><meta charset=utf-8><title>django.contrib.gis.gdal.layer</title><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=stylesheet href=./assets/purecss/pure-min.css><link rel=stylesheet href=./assets/purecss/grids-responsive-min.css><link rel=stylesheet href=./assets/style.css><link rel=stylesheet href=./assets/pygments/default.css><link rel=stylesheet href=./assets/jquery/jquery-ui.min.css><script src=./assets/jquery/jquery-3.0.0.min.js></script><script src=./assets/jquery/jquery-ui.min.js></script><script src=nedoc.js></script></head><body><div id=layout class=pure-g><div class="sidebar pure-u-1 pure-u-md-1-4"><div class=header><h1 class=brand-title>Django</h1> 1.0 </div><div id=sbox><input id=search style="color: black;" placeholder="search ..."></div><div class=tree><ul><li><a href=django.html>&#9662; django</a> </li><li><ul><li><a href=django.__main__.html>&#9656; __main__</a> </li><li><a href=django.apps.html>&#9656; apps</a> </li><li><a href=django.bin.html>&#9656; bin</a> </li><li><a href=django.conf.html>&#9656; conf</a> </li><li><a href=django.contrib.html>&#9662; contrib</a> </li><li><ul><li><a href=django.contrib.admin.html>&#9656; admin</a> </li><li><a href=django.contrib.admindocs.html>&#9656; admindocs</a> </li><li><a href=django.contrib.auth.html>&#9656; auth</a> </li><li><a href=django.contrib.contenttypes.html>&#9656; contenttypes</a> </li><li><a href=django.contrib.flatpages.html>&#9656; flatpages</a> </li><li><a href=django.contrib.gis.html>&#9662; gis</a> </li><li><ul><li><a href=django.contrib.gis.admin.html>&#9656; admin</a> </li><li><a href=django.contrib.gis.apps.html>&#9656; apps</a> </li><li><a href=django.contrib.gis.db.html>&#9656; db</a> </li><li><a href=django.contrib.gis.feeds.html>&#9656; feeds</a> </li><li><a href=django.contrib.gis.forms.html>&#9656; forms</a> </li><li><a href=django.contrib.gis.gdal.html>&#9662; gdal</a> </li><li><ul><li><a href=django.contrib.gis.gdal.base.html>&#9656; base</a> </li><li><a href=django.contrib.gis.gdal.datasource.html>&#9656; datasource</a> </li><li><a href=django.contrib.gis.gdal.driver.html>&#9656; driver</a> </li><li><a href=django.contrib.gis.gdal.envelope.html>&#9656; envelope</a> </li><li><a href=django.contrib.gis.gdal.error.html>&#9656; error</a> </li><li><a href=django.contrib.gis.gdal.feature.html>&#9656; feature</a> </li><li><a href=django.contrib.gis.gdal.field.html>&#9656; field</a> </li><li><a href=django.contrib.gis.gdal.geometries.html>&#9656; geometries</a> </li><li><a href=django.contrib.gis.gdal.geomtype.html>&#9656; geomtype</a> </li><li><div class=select><a href=django.contrib.gis.gdal.layer.html>&#9662; layer</a> </div></li><li><ul><li><a href=django.contrib.gis.gdal.layer.Layer.html> <i>class</i> Layer</a> </li></ul></li><li><a href=django.contrib.gis.gdal.libgdal.html>&#9656; libgdal</a> </li><li><a href=django.contrib.gis.gdal.prototypes.html>&#9656; prototypes</a> </li><li><a href=django.contrib.gis.gdal.raster.html>&#9656; raster</a> </li><li><a href=django.contrib.gis.gdal.srs.html>&#9656; srs</a> </li></ul></li><li><a href=django.contrib.gis.geoip2.html>&#9656; geoip2</a> </li><li><a href=django.contrib.gis.geometry.html>&#9656; geometry</a> </li><li><a href=django.contrib.gis.geos.html>&#9656; geos</a> </li><li><a href=django.contrib.gis.management.html>&#9656; management</a> </li><li><a href=django.contrib.gis.measure.html>&#9656; measure</a> </li><li><a href=django.contrib.gis.ptr.html>&#9656; ptr</a> </li><li><a href=django.contrib.gis.serializers.html>&#9656; serializers</a> </li><li><a href=django.contrib.gis.shortcuts.html>&#9656; shortcuts</a> </li><li><a href=django.contrib.gis.sitemaps.html>&#9656; sitemaps</a> </li><li><a href=django.contrib.gis.utils.html>&#9656; utils</a> </li><li><a href=django.contrib.gis.views.html>&#9656; views</a> </li></ul></li><li><a href=django.contrib.humanize.html>&#9656; humanize</a> </li><li><a href=django.contrib.messages.html>&#9656; messages</a> </li><li><a href=django.contrib.postgres.html>&#9656; postgres</a> </li><li><a href=django.contrib.redirects.html>&#9656; redirects</a> </li><li><a href=django.contrib.sessions.html>&#9656; sessions</a> </li><li><a href=django.contrib.sitemaps.html>&#9656; sitemaps</a> </li><li><a href=django.contrib.sites.html>&#9656; sites</a> </li><li><a href=django.contrib.staticfiles.html>&#9656; staticfiles</a> </li><li><a href=django.contrib.syndication.html>&#9656; syndication</a> </li></ul></li><li><a href=django.core.html>&#9656; core</a> </li><li><a href=django.db.html>&#9656; db</a> </li><li><a href=django.dispatch.html>&#9656; dispatch</a> </li><li><a href=django.forms.html>&#9656; forms</a> </li><li><a href=django.http.html>&#9656; http</a> </li><li><a href=django.middleware.html>&#9656; middleware</a> </li><li><a href=django.shortcuts.html>&#9656; shortcuts</a> </li><li><a href=django.template.html>&#9656; template</a> </li><li><a href=django.templatetags.html>&#9656; templatetags</a> </li><li><a href=django.test.html>&#9656; test</a> </li><li><a href=django.urls.html>&#9656; urls</a> </li><li><a href=django.utils.html>&#9656; utils</a> </li><li><a href=django.views.html>&#9656; views</a> </li></ul></ul></div></div><div class="content pure-u-1 pure-u-md-3-4"><h1>Source code django/contrib/gis/gdal/layer.py</h1><div id=path><a class=symbol href=django.html>django</a>.<a class=symbol href=django.contrib.html>contrib</a>.<a class=symbol href=django.contrib.gis.html>gis</a>.<a class=symbol href=django.contrib.gis.gdal.html>gdal</a>.<a class=symbol href=django.contrib.gis.gdal.layer.html>layer</a></div><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215</pre></div></td><td class=code><div class=highlight><pre><span></span><a name=line-1></a><span class=kn>from</span> <span class=nn>ctypes</span> <span class=kn>import</span> <span class=n>byref</span><span class=p>,</span> <span class=n>c_double</span>
<a name=line-2></a>
<a name=line-3></a><span class=kn>from</span> <span class=nn>django.contrib.gis.gdal.base</span> <span class=kn>import</span> <span class=n>GDALBase</span>
<a name=line-4></a><span class=kn>from</span> <span class=nn>django.contrib.gis.gdal.envelope</span> <span class=kn>import</span> <span class=n>Envelope</span><span class=p>,</span> <span class=n>OGREnvelope</span>
<a name=line-5></a><span class=kn>from</span> <span class=nn>django.contrib.gis.gdal.error</span> <span class=kn>import</span> <span class=n>GDALException</span><span class=p>,</span> <span class=n>SRSException</span>
<a name=line-6></a><span class=kn>from</span> <span class=nn>django.contrib.gis.gdal.feature</span> <span class=kn>import</span> <span class=n>Feature</span>
<a name=line-7></a><span class=kn>from</span> <span class=nn>django.contrib.gis.gdal.field</span> <span class=kn>import</span> <span class=n>OGRFieldTypes</span>
<a name=line-8></a><span class=kn>from</span> <span class=nn>django.contrib.gis.gdal.geometries</span> <span class=kn>import</span> <span class=n>OGRGeometry</span>
<a name=line-9></a><span class=kn>from</span> <span class=nn>django.contrib.gis.gdal.geomtype</span> <span class=kn>import</span> <span class=n>OGRGeomType</span>
<a name=line-10></a><span class=kn>from</span> <span class=nn>django.contrib.gis.gdal.prototypes</span> <span class=kn>import</span> <span class=p>(</span>
<a name=line-11></a>    <span class=n>ds</span> <span class=k>as</span> <span class=n>capi</span><span class=p>,</span> <span class=n>geom</span> <span class=k>as</span> <span class=n>geom_api</span><span class=p>,</span> <span class=n>srs</span> <span class=k>as</span> <span class=n>srs_api</span><span class=p>,</span>
<a name=line-12></a><span class=p>)</span>
<a name=line-13></a><span class=kn>from</span> <span class=nn>django.contrib.gis.gdal.srs</span> <span class=kn>import</span> <span class=n>SpatialReference</span>
<a name=line-14></a><span class=kn>from</span> <span class=nn>django.utils.encoding</span> <span class=kn>import</span> <span class=n>force_bytes</span><span class=p>,</span> <span class=n>force_str</span>
<a name=line-15></a>
<a name=line-16></a>
<a name=line-17></a><span class=c1># For more information, see the OGR C API source code:</span>
<a name=line-18></a><span class=c1>#  https://www.gdal.org/ogr__api_8h.html</span>
<a name=line-19></a><span class=c1>#</span>
<a name=line-20></a><span class=c1># The OGR_L_* routines are relevant here.</span>
<a name=line-21></a><span class=k>class</span> <span class=nc>Layer</span><span class=p>(</span><span class=n>GDALBase</span><span class=p>):</span>
<a name=line-22></a>    <span class=s2>&quot;A class that wraps an OGR Layer, needs to be instantiated from a DataSource object.&quot;</span>
<a name=line-23></a>
<a name=line-24></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>layer_ptr</span><span class=p>,</span> <span class=n>ds</span><span class=p>):</span>
<a name=line-25></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-26></a><span class=sd>        Initialize on an OGR C pointer to the Layer and the `DataSource` object</span>
<a name=line-27></a><span class=sd>        that owns this layer.  The `DataSource` object is required so that a</span>
<a name=line-28></a><span class=sd>        reference to it is kept with this Layer.  This prevents garbage</span>
<a name=line-29></a><span class=sd>        collection of the `DataSource` while this Layer is still active.</span>
<a name=line-30></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-31></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>layer_ptr</span><span class=p>:</span>
<a name=line-32></a>            <span class=k>raise</span> <span class=n>GDALException</span><span class=p>(</span><span class=s1>&#39;Cannot create Layer, invalid pointer given&#39;</span><span class=p>)</span>
<a name=line-33></a>        <span class=bp>self</span><span class=o>.</span><span class=n>ptr</span> <span class=o>=</span> <span class=n>layer_ptr</span>
<a name=line-34></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_ds</span> <span class=o>=</span> <span class=n>ds</span>
<a name=line-35></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_ldefn</span> <span class=o>=</span> <span class=n>capi</span><span class=o>.</span><span class=n>get_layer_defn</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ptr</span><span class=p>)</span>
<a name=line-36></a>        <span class=c1># Does the Layer support random reading?</span>
<a name=line-37></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_random_read</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>test_capability</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;RandomRead&#39;</span><span class=p>)</span>
<a name=line-38></a>
<a name=line-39></a>    <span class=k>def</span> <span class=fm>__getitem__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>index</span><span class=p>):</span>
<a name=line-40></a>        <span class=s2>&quot;Get the Feature at the specified index.&quot;</span>
<a name=line-41></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=nb>int</span><span class=p>):</span>
<a name=line-42></a>            <span class=c1># An integer index was given -- we cannot do a check based on the</span>
<a name=line-43></a>            <span class=c1># number of features because the beginning and ending feature IDs</span>
<a name=line-44></a>            <span class=c1># are not guaranteed to be 0 and len(layer)-1, respectively.</span>
<a name=line-45></a>            <span class=k>if</span> <span class=n>index</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
<a name=line-46></a>                <span class=k>raise</span> <span class=ne>IndexError</span><span class=p>(</span><span class=s1>&#39;Negative indices are not allowed on OGR Layers.&#39;</span><span class=p>)</span>
<a name=line-47></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_make_feature</span><span class=p>(</span><span class=n>index</span><span class=p>)</span>
<a name=line-48></a>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=nb>slice</span><span class=p>):</span>
<a name=line-49></a>            <span class=c1># A slice was given</span>
<a name=line-50></a>            <span class=n>start</span><span class=p>,</span> <span class=n>stop</span><span class=p>,</span> <span class=n>stride</span> <span class=o>=</span> <span class=n>index</span><span class=o>.</span><span class=n>indices</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>num_feat</span><span class=p>)</span>
<a name=line-51></a>            <span class=k>return</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>_make_feature</span><span class=p>(</span><span class=n>fid</span><span class=p>)</span> <span class=k>for</span> <span class=n>fid</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=n>stop</span><span class=p>,</span> <span class=n>stride</span><span class=p>)]</span>
<a name=line-52></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-53></a>            <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=s1>&#39;Integers and slices may only be used when indexing OGR Layers.&#39;</span><span class=p>)</span>
<a name=line-54></a>
<a name=line-55></a>    <span class=k>def</span> <span class=fm>__iter__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-56></a>        <span class=s2>&quot;Iterate over each Feature in the Layer.&quot;</span>
<a name=line-57></a>        <span class=c1># ResetReading() must be called before iteration is to begin.</span>
<a name=line-58></a>        <span class=n>capi</span><span class=o>.</span><span class=n>reset_reading</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ptr</span><span class=p>)</span>
<a name=line-59></a>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>num_feat</span><span class=p>):</span>
<a name=line-60></a>            <span class=k>yield</span> <span class=n>Feature</span><span class=p>(</span><span class=n>capi</span><span class=o>.</span><span class=n>get_next_feature</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ptr</span><span class=p>),</span> <span class=bp>self</span><span class=p>)</span>
<a name=line-61></a>
<a name=line-62></a>    <span class=k>def</span> <span class=fm>__len__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-63></a>        <span class=s2>&quot;The length is the number of features.&quot;</span>
<a name=line-64></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>num_feat</span>
<a name=line-65></a>
<a name=line-66></a>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-67></a>        <span class=s2>&quot;The string name of the layer.&quot;</span>
<a name=line-68></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span>
<a name=line-69></a>
<a name=line-70></a>    <span class=k>def</span> <span class=nf>_make_feature</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>feat_id</span><span class=p>):</span>
<a name=line-71></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-72></a><span class=sd>        Helper routine for __getitem__ that constructs a Feature from the given</span>
<a name=line-73></a><span class=sd>        Feature ID.  If the OGR Layer does not support random-access reading,</span>
<a name=line-74></a><span class=sd>        then each feature of the layer will be incremented through until the</span>
<a name=line-75></a><span class=sd>        a Feature is found matching the given feature ID.</span>
<a name=line-76></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-77></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_random_read</span><span class=p>:</span>
<a name=line-78></a>            <span class=c1># If the Layer supports random reading, return.</span>
<a name=line-79></a>            <span class=k>try</span><span class=p>:</span>
<a name=line-80></a>                <span class=k>return</span> <span class=n>Feature</span><span class=p>(</span><span class=n>capi</span><span class=o>.</span><span class=n>get_feature</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>ptr</span><span class=p>,</span> <span class=n>feat_id</span><span class=p>),</span> <span class=bp>self</span><span class=p>)</span>
<a name=line-81></a>            <span class=k>except</span> <span class=n>GDALException</span><span class=p>:</span>
<a name=line-82></a>                <span class=k>pass</span>
<a name=line-83></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-84></a>            <span class=c1># Random access isn&#39;t supported, have to increment through</span>
<a name=line-85></a>            <span class=c1># each feature until the given feature ID is encountered.</span>
<a name=line-86></a>            <span class=k>for</span> <span class=n>feat</span> <span class=ow>in</span> <span class=bp>self</span><span class=p>:</span>
<a name=line-87></a>                <span class=k>if</span> <span class=n>feat</span><span class=o>.</span><span class=n>fid</span> <span class=o>==</span> <span class=n>feat_id</span><span class=p>:</span>
<a name=line-88></a>                    <span class=k>return</span> <span class=n>feat</span>
<a name=line-89></a>        <span class=c1># Should have returned a Feature, raise an IndexError.</span>
<a name=line-90></a>        <span class=k>raise</span> <span class=ne>IndexError</span><span class=p>(</span><span class=s1>&#39;Invalid feature id: </span><span class=si>%s</span><span class=s1>.&#39;</span> <span class=o>%</span> <span class=n>feat_id</span><span class=p>)</span>
<a name=line-91></a>
<a name=line-92></a>    <span class=c1># #### Layer properties ####</span>
<a name=line-93></a>    <span class=nd>@property</span>
<a name=line-94></a>    <span class=k>def</span> <span class=nf>extent</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-95></a>        <span class=s2>&quot;Return the extent (an Envelope) of this layer.&quot;</span>
<a name=line-96></a>        <span class=n>env</span> <span class=o>=</span> <span class=n>OGREnvelope</span><span class=p>()</span>
<a name=line-97></a>        <span class=n>capi</span><span class=o>.</span><span class=n>get_extent</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>ptr</span><span class=p>,</span> <span class=n>byref</span><span class=p>(</span><span class=n>env</span><span class=p>),</span> <span class=mi>1</span><span class=p>)</span>
<a name=line-98></a>        <span class=k>return</span> <span class=n>Envelope</span><span class=p>(</span><span class=n>env</span><span class=p>)</span>
<a name=line-99></a>
<a name=line-100></a>    <span class=nd>@property</span>
<a name=line-101></a>    <span class=k>def</span> <span class=nf>name</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-102></a>        <span class=s2>&quot;Return the name of this layer in the Data Source.&quot;</span>
<a name=line-103></a>        <span class=n>name</span> <span class=o>=</span> <span class=n>capi</span><span class=o>.</span><span class=n>get_fd_name</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ldefn</span><span class=p>)</span>
<a name=line-104></a>        <span class=k>return</span> <span class=n>force_str</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_ds</span><span class=o>.</span><span class=n>encoding</span><span class=p>,</span> <span class=n>strings_only</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a name=line-105></a>
<a name=line-106></a>    <span class=nd>@property</span>
<a name=line-107></a>    <span class=k>def</span> <span class=nf>num_feat</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>force</span><span class=o>=</span><span class=mi>1</span><span class=p>):</span>
<a name=line-108></a>        <span class=s2>&quot;Return the number of features in the Layer.&quot;</span>
<a name=line-109></a>        <span class=k>return</span> <span class=n>capi</span><span class=o>.</span><span class=n>get_feature_count</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>ptr</span><span class=p>,</span> <span class=n>force</span><span class=p>)</span>
<a name=line-110></a>
<a name=line-111></a>    <span class=nd>@property</span>
<a name=line-112></a>    <span class=k>def</span> <span class=nf>num_fields</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-113></a>        <span class=s2>&quot;Return the number of fields in the Layer.&quot;</span>
<a name=line-114></a>        <span class=k>return</span> <span class=n>capi</span><span class=o>.</span><span class=n>get_field_count</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ldefn</span><span class=p>)</span>
<a name=line-115></a>
<a name=line-116></a>    <span class=nd>@property</span>
<a name=line-117></a>    <span class=k>def</span> <span class=nf>geom_type</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-118></a>        <span class=s2>&quot;Return the geometry type (OGRGeomType) of the Layer.&quot;</span>
<a name=line-119></a>        <span class=k>return</span> <span class=n>OGRGeomType</span><span class=p>(</span><span class=n>capi</span><span class=o>.</span><span class=n>get_fd_geom_type</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ldefn</span><span class=p>))</span>
<a name=line-120></a>
<a name=line-121></a>    <span class=nd>@property</span>
<a name=line-122></a>    <span class=k>def</span> <span class=nf>srs</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-123></a>        <span class=s2>&quot;Return the Spatial Reference used in this Layer.&quot;</span>
<a name=line-124></a>        <span class=k>try</span><span class=p>:</span>
<a name=line-125></a>            <span class=n>ptr</span> <span class=o>=</span> <span class=n>capi</span><span class=o>.</span><span class=n>get_layer_srs</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>ptr</span><span class=p>)</span>
<a name=line-126></a>            <span class=k>return</span> <span class=n>SpatialReference</span><span class=p>(</span><span class=n>srs_api</span><span class=o>.</span><span class=n>clone_srs</span><span class=p>(</span><span class=n>ptr</span><span class=p>))</span>
<a name=line-127></a>        <span class=k>except</span> <span class=n>SRSException</span><span class=p>:</span>
<a name=line-128></a>            <span class=k>return</span> <span class=kc>None</span>
<a name=line-129></a>
<a name=line-130></a>    <span class=nd>@property</span>
<a name=line-131></a>    <span class=k>def</span> <span class=nf>fields</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-132></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-133></a><span class=sd>        Return a list of string names corresponding to each of the Fields</span>
<a name=line-134></a><span class=sd>        available in this Layer.</span>
<a name=line-135></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-136></a>        <span class=k>return</span> <span class=p>[</span><span class=n>force_str</span><span class=p>(</span>
<a name=line-137></a>            <span class=n>capi</span><span class=o>.</span><span class=n>get_field_name</span><span class=p>(</span><span class=n>capi</span><span class=o>.</span><span class=n>get_field_defn</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ldefn</span><span class=p>,</span> <span class=n>i</span><span class=p>)),</span>
<a name=line-138></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_ds</span><span class=o>.</span><span class=n>encoding</span><span class=p>,</span> <span class=n>strings_only</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
<a name=line-139></a>        <span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>num_fields</span><span class=p>)]</span>
<a name=line-140></a>
<a name=line-141></a>    <span class=nd>@property</span>
<a name=line-142></a>    <span class=k>def</span> <span class=nf>field_types</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-143></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-144></a><span class=sd>        Return a list of the types of fields in this Layer.  For example,</span>
<a name=line-145></a><span class=sd>        return the list [OFTInteger, OFTReal, OFTString] for an OGR layer that</span>
<a name=line-146></a><span class=sd>        has an integer, a floating-point, and string fields.</span>
<a name=line-147></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-148></a>        <span class=k>return</span> <span class=p>[</span><span class=n>OGRFieldTypes</span><span class=p>[</span><span class=n>capi</span><span class=o>.</span><span class=n>get_field_type</span><span class=p>(</span><span class=n>capi</span><span class=o>.</span><span class=n>get_field_defn</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ldefn</span><span class=p>,</span> <span class=n>i</span><span class=p>))]</span>
<a name=line-149></a>                <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>num_fields</span><span class=p>)]</span>
<a name=line-150></a>
<a name=line-151></a>    <span class=nd>@property</span>
<a name=line-152></a>    <span class=k>def</span> <span class=nf>field_widths</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-153></a>        <span class=s2>&quot;Return a list of the maximum field widths for the features.&quot;</span>
<a name=line-154></a>        <span class=k>return</span> <span class=p>[</span><span class=n>capi</span><span class=o>.</span><span class=n>get_field_width</span><span class=p>(</span><span class=n>capi</span><span class=o>.</span><span class=n>get_field_defn</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ldefn</span><span class=p>,</span> <span class=n>i</span><span class=p>))</span>
<a name=line-155></a>                <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>num_fields</span><span class=p>)]</span>
<a name=line-156></a>
<a name=line-157></a>    <span class=nd>@property</span>
<a name=line-158></a>    <span class=k>def</span> <span class=nf>field_precisions</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-159></a>        <span class=s2>&quot;Return the field precisions for the features.&quot;</span>
<a name=line-160></a>        <span class=k>return</span> <span class=p>[</span><span class=n>capi</span><span class=o>.</span><span class=n>get_field_precision</span><span class=p>(</span><span class=n>capi</span><span class=o>.</span><span class=n>get_field_defn</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ldefn</span><span class=p>,</span> <span class=n>i</span><span class=p>))</span>
<a name=line-161></a>                <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>num_fields</span><span class=p>)]</span>
<a name=line-162></a>
<a name=line-163></a>    <span class=k>def</span> <span class=nf>_get_spatial_filter</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-164></a>        <span class=k>try</span><span class=p>:</span>
<a name=line-165></a>            <span class=k>return</span> <span class=n>OGRGeometry</span><span class=p>(</span><span class=n>geom_api</span><span class=o>.</span><span class=n>clone_geom</span><span class=p>(</span><span class=n>capi</span><span class=o>.</span><span class=n>get_spatial_filter</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>ptr</span><span class=p>)))</span>
<a name=line-166></a>        <span class=k>except</span> <span class=n>GDALException</span><span class=p>:</span>
<a name=line-167></a>            <span class=k>return</span> <span class=kc>None</span>
<a name=line-168></a>
<a name=line-169></a>    <span class=k>def</span> <span class=nf>_set_spatial_filter</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=nb>filter</span><span class=p>):</span>
<a name=line-170></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=nb>filter</span><span class=p>,</span> <span class=n>OGRGeometry</span><span class=p>):</span>
<a name=line-171></a>            <span class=n>capi</span><span class=o>.</span><span class=n>set_spatial_filter</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>ptr</span><span class=p>,</span> <span class=nb>filter</span><span class=o>.</span><span class=n>ptr</span><span class=p>)</span>
<a name=line-172></a>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=nb>filter</span><span class=p>,</span> <span class=p>(</span><span class=nb>tuple</span><span class=p>,</span> <span class=nb>list</span><span class=p>)):</span>
<a name=line-173></a>            <span class=k>if</span> <span class=ow>not</span> <span class=nb>len</span><span class=p>(</span><span class=nb>filter</span><span class=p>)</span> <span class=o>==</span> <span class=mi>4</span><span class=p>:</span>
<a name=line-174></a>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;Spatial filter list/tuple must have 4 elements.&#39;</span><span class=p>)</span>
<a name=line-175></a>            <span class=c1># Map c_double onto params -- if a bad type is passed in it</span>
<a name=line-176></a>            <span class=c1># will be caught here.</span>
<a name=line-177></a>            <span class=n>xmin</span><span class=p>,</span> <span class=n>ymin</span><span class=p>,</span> <span class=n>xmax</span><span class=p>,</span> <span class=n>ymax</span> <span class=o>=</span> <span class=nb>map</span><span class=p>(</span><span class=n>c_double</span><span class=p>,</span> <span class=nb>filter</span><span class=p>)</span>
<a name=line-178></a>            <span class=n>capi</span><span class=o>.</span><span class=n>set_spatial_filter_rect</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>ptr</span><span class=p>,</span> <span class=n>xmin</span><span class=p>,</span> <span class=n>ymin</span><span class=p>,</span> <span class=n>xmax</span><span class=p>,</span> <span class=n>ymax</span><span class=p>)</span>
<a name=line-179></a>        <span class=k>elif</span> <span class=nb>filter</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-180></a>            <span class=n>capi</span><span class=o>.</span><span class=n>set_spatial_filter</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>ptr</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<a name=line-181></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-182></a>            <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=s1>&#39;Spatial filter must be either an OGRGeometry instance, a 4-tuple, or None.&#39;</span><span class=p>)</span>
<a name=line-183></a>
<a name=line-184></a>    <span class=n>spatial_filter</span> <span class=o>=</span> <span class=nb>property</span><span class=p>(</span><span class=n>_get_spatial_filter</span><span class=p>,</span> <span class=n>_set_spatial_filter</span><span class=p>)</span>
<a name=line-185></a>
<a name=line-186></a>    <span class=c1># #### Layer Methods ####</span>
<a name=line-187></a>    <span class=k>def</span> <span class=nf>get_fields</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>field_name</span><span class=p>):</span>
<a name=line-188></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-189></a><span class=sd>        Return a list containing the given field name for every Feature</span>
<a name=line-190></a><span class=sd>        in the Layer.</span>
<a name=line-191></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-192></a>        <span class=k>if</span> <span class=n>field_name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>fields</span><span class=p>:</span>
<a name=line-193></a>            <span class=k>raise</span> <span class=n>GDALException</span><span class=p>(</span><span class=s1>&#39;invalid field name: </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>field_name</span><span class=p>)</span>
<a name=line-194></a>        <span class=k>return</span> <span class=p>[</span><span class=n>feat</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>field_name</span><span class=p>)</span> <span class=k>for</span> <span class=n>feat</span> <span class=ow>in</span> <span class=bp>self</span><span class=p>]</span>
<a name=line-195></a>
<a name=line-196></a>    <span class=k>def</span> <span class=nf>get_geoms</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>geos</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<a name=line-197></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-198></a><span class=sd>        Return a list containing the OGRGeometry for every Feature in</span>
<a name=line-199></a><span class=sd>        the Layer.</span>
<a name=line-200></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-201></a>        <span class=k>if</span> <span class=n>geos</span><span class=p>:</span>
<a name=line-202></a>            <span class=kn>from</span> <span class=nn>django.contrib.gis.geos</span> <span class=kn>import</span> <span class=n>GEOSGeometry</span>
<a name=line-203></a>            <span class=k>return</span> <span class=p>[</span><span class=n>GEOSGeometry</span><span class=p>(</span><span class=n>feat</span><span class=o>.</span><span class=n>geom</span><span class=o>.</span><span class=n>wkb</span><span class=p>)</span> <span class=k>for</span> <span class=n>feat</span> <span class=ow>in</span> <span class=bp>self</span><span class=p>]</span>
<a name=line-204></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-205></a>            <span class=k>return</span> <span class=p>[</span><span class=n>feat</span><span class=o>.</span><span class=n>geom</span> <span class=k>for</span> <span class=n>feat</span> <span class=ow>in</span> <span class=bp>self</span><span class=p>]</span>
<a name=line-206></a>
<a name=line-207></a>    <span class=k>def</span> <span class=nf>test_capability</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>capability</span><span class=p>):</span>
<a name=line-208></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-209></a><span class=sd>        Return a bool indicating whether the this Layer supports the given</span>
<a name=line-210></a><span class=sd>        capability (a string).  Valid capability strings include:</span>
<a name=line-211></a><span class=sd>          &#39;RandomRead&#39;, &#39;SequentialWrite&#39;, &#39;RandomWrite&#39;, &#39;FastSpatialFilter&#39;,</span>
<a name=line-212></a><span class=sd>          &#39;FastFeatureCount&#39;, &#39;FastGetExtent&#39;, &#39;CreateField&#39;, &#39;Transactions&#39;,</span>
<a name=line-213></a><span class=sd>          &#39;DeleteFeature&#39;, and &#39;FastSetNextByIndex&#39;.</span>
<a name=line-214></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-215></a>        <span class=k>return</span> <span class=nb>bool</span><span class=p>(</span><span class=n>capi</span><span class=o>.</span><span class=n>test_capability</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>ptr</span><span class=p>,</span> <span class=n>force_bytes</span><span class=p>(</span><span class=n>capability</span><span class=p>)))</span>
</pre></div></td></tr></table><p class=footer> Generated by <a href=https://github.com/spirali/nedoc>nedoc</a> v0.9 at 2020-12-29 14:04 </p></div></div></body></html>