<!DOCTYPE html><html><head><meta charset=utf-8><title>django.contrib.gis.db.models.fields</title><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=stylesheet href=./assets/purecss/pure-min.css><link rel=stylesheet href=./assets/purecss/grids-responsive-min.css><link rel=stylesheet href=./assets/style.css><link rel=stylesheet href=./assets/pygments/default.css><link rel=stylesheet href=./assets/jquery/jquery-ui.min.css><script src=./assets/jquery/jquery-3.0.0.min.js></script><script src=./assets/jquery/jquery-ui.min.js></script><script src=nedoc.js></script></head><body><div id=layout class=pure-g><div class="sidebar pure-u-1 pure-u-md-1-4"><div class=header><h1 class=brand-title>Django</h1> 1.0 </div><div id=sbox><input id=search style="color: black;" placeholder="search ..."></div><div class=tree><ul><li><a href=django.html>&#9662; django</a> </li><li><ul><li><a href=django.__main__.html>&#9656; __main__</a> </li><li><a href=django.apps.html>&#9656; apps</a> </li><li><a href=django.bin.html>&#9656; bin</a> </li><li><a href=django.conf.html>&#9656; conf</a> </li><li><a href=django.contrib.html>&#9662; contrib</a> </li><li><ul><li><a href=django.contrib.admin.html>&#9656; admin</a> </li><li><a href=django.contrib.admindocs.html>&#9656; admindocs</a> </li><li><a href=django.contrib.auth.html>&#9656; auth</a> </li><li><a href=django.contrib.contenttypes.html>&#9656; contenttypes</a> </li><li><a href=django.contrib.flatpages.html>&#9656; flatpages</a> </li><li><a href=django.contrib.gis.html>&#9662; gis</a> </li><li><ul><li><a href=django.contrib.gis.admin.html>&#9656; admin</a> </li><li><a href=django.contrib.gis.apps.html>&#9656; apps</a> </li><li><a href=django.contrib.gis.db.html>&#9662; db</a> </li><li><ul><li><a href=django.contrib.gis.db.backends.html>&#9656; backends</a> </li><li><a href=django.contrib.gis.db.models.html>&#9662; models</a> </li><li><ul><li><a href=django.contrib.gis.db.models.aggregates.html>&#9656; aggregates</a> </li><li><div class=select><a href=django.contrib.gis.db.models.fields.html>&#9662; fields</a> </div></li><li><ul><li><a href=django.contrib.gis.db.models.fields.BaseSpatialField.html> <i>class</i> BaseSpatialField</a> </li><li><a href=django.contrib.gis.db.models.fields.ExtentField.html> <i>class</i> ExtentField</a> </li><li><a href=django.contrib.gis.db.models.fields.GeometryCollectionField.html> <i>class</i> GeometryCollectionField</a> </li><li><a href=django.contrib.gis.db.models.fields.GeometryField.html> <i>class</i> GeometryField</a> </li><li><a href=django.contrib.gis.db.models.fields.LineStringField.html> <i>class</i> LineStringField</a> </li><li><a href=django.contrib.gis.db.models.fields.MultiLineStringField.html> <i>class</i> MultiLineStringField</a> </li><li><a href=django.contrib.gis.db.models.fields.MultiPointField.html> <i>class</i> MultiPointField</a> </li><li><a href=django.contrib.gis.db.models.fields.MultiPolygonField.html> <i>class</i> MultiPolygonField</a> </li><li><a href=django.contrib.gis.db.models.fields.PointField.html> <i>class</i> PointField</a> </li><li><a href=django.contrib.gis.db.models.fields.PolygonField.html> <i>class</i> PolygonField</a> </li><li><a href=django.contrib.gis.db.models.fields.RasterField.html> <i>class</i> RasterField</a> </li></ul></li><li><a href=django.contrib.gis.db.models.functions.html>&#9656; functions</a> </li><li><a href=django.contrib.gis.db.models.lookups.html>&#9656; lookups</a> </li><li><a href=django.contrib.gis.db.models.proxy.html>&#9656; proxy</a> </li><li><a href=django.contrib.gis.db.models.sql.html>&#9656; sql</a> </li></ul></li><li><a href=django.contrib.gis.feeds.html>&#9656; feeds</a> </li><li><a href=django.contrib.gis.forms.html>&#9656; forms</a> </li><li><a href=django.contrib.gis.gdal.html>&#9656; gdal</a> </li><li><a href=django.contrib.gis.geoip2.html>&#9656; geoip2</a> </li><li><a href=django.contrib.gis.geometry.html>&#9656; geometry</a> </li><li><a href=django.contrib.gis.geos.html>&#9656; geos</a> </li><li><a href=django.contrib.gis.management.html>&#9656; management</a> </li><li><a href=django.contrib.gis.measure.html>&#9656; measure</a> </li><li><a href=django.contrib.gis.ptr.html>&#9656; ptr</a> </li><li><a href=django.contrib.gis.serializers.html>&#9656; serializers</a> </li><li><a href=django.contrib.gis.shortcuts.html>&#9656; shortcuts</a> </li><li><a href=django.contrib.gis.sitemaps.html>&#9656; sitemaps</a> </li><li><a href=django.contrib.gis.utils.html>&#9656; utils</a> </li><li><a href=django.contrib.gis.views.html>&#9656; views</a> </li></ul></li><li><a href=django.contrib.humanize.html>&#9656; humanize</a> </li><li><a href=django.contrib.messages.html>&#9656; messages</a> </li><li><a href=django.contrib.postgres.html>&#9656; postgres</a> </li><li><a href=django.contrib.redirects.html>&#9656; redirects</a> </li><li><a href=django.contrib.sessions.html>&#9656; sessions</a> </li><li><a href=django.contrib.sitemaps.html>&#9656; sitemaps</a> </li><li><a href=django.contrib.sites.html>&#9656; sites</a> </li><li><a href=django.contrib.staticfiles.html>&#9656; staticfiles</a> </li><li><a href=django.contrib.syndication.html>&#9656; syndication</a> </li></ul></li><li><a href=django.core.html>&#9656; core</a> </li><li><a href=django.db.html>&#9656; db</a> </li><li><a href=django.dispatch.html>&#9656; dispatch</a> </li><li><a href=django.forms.html>&#9656; forms</a> </li><li><a href=django.http.html>&#9656; http</a> </li><li><a href=django.middleware.html>&#9656; middleware</a> </li><li><a href=django.shortcuts.html>&#9656; shortcuts</a> </li><li><a href=django.template.html>&#9656; template</a> </li><li><a href=django.templatetags.html>&#9656; templatetags</a> </li><li><a href=django.test.html>&#9656; test</a> </li><li><a href=django.urls.html>&#9656; urls</a> </li><li><a href=django.utils.html>&#9656; utils</a> </li><li><a href=django.views.html>&#9656; views</a> </li></ul></ul></div></div><div class="content pure-u-1 pure-u-md-3-4"><h1>Source code django/contrib/gis/db/models/fields.py</h1><div id=path><a class=symbol href=django.html>django</a>.<a class=symbol href=django.contrib.html>contrib</a>.<a class=symbol href=django.contrib.gis.html>gis</a>.<a class=symbol href=django.contrib.gis.db.html>db</a>.<a class=symbol href=django.contrib.gis.db.models.html>models</a>.<a class=symbol href=django.contrib.gis.db.models.fields.html>fields</a></div><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387</pre></div></td><td class=code><div class=highlight><pre><span></span><a name=line-1></a><span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>defaultdict</span><span class=p>,</span> <span class=n>namedtuple</span>
<a name=line-2></a>
<a name=line-3></a><span class=kn>from</span> <span class=nn>django.contrib.gis</span> <span class=kn>import</span> <span class=n>forms</span><span class=p>,</span> <span class=n>gdal</span>
<a name=line-4></a><span class=kn>from</span> <span class=nn>django.contrib.gis.db.models.proxy</span> <span class=kn>import</span> <span class=n>SpatialProxy</span>
<a name=line-5></a><span class=kn>from</span> <span class=nn>django.contrib.gis.gdal.error</span> <span class=kn>import</span> <span class=n>GDALException</span>
<a name=line-6></a><span class=kn>from</span> <span class=nn>django.contrib.gis.geos</span> <span class=kn>import</span> <span class=p>(</span>
<a name=line-7></a>    <span class=n>GeometryCollection</span><span class=p>,</span> <span class=n>GEOSException</span><span class=p>,</span> <span class=n>GEOSGeometry</span><span class=p>,</span> <span class=n>LineString</span><span class=p>,</span>
<a name=line-8></a>    <span class=n>MultiLineString</span><span class=p>,</span> <span class=n>MultiPoint</span><span class=p>,</span> <span class=n>MultiPolygon</span><span class=p>,</span> <span class=n>Point</span><span class=p>,</span> <span class=n>Polygon</span><span class=p>,</span>
<a name=line-9></a><span class=p>)</span>
<a name=line-10></a><span class=kn>from</span> <span class=nn>django.core.exceptions</span> <span class=kn>import</span> <span class=n>ImproperlyConfigured</span>
<a name=line-11></a><span class=kn>from</span> <span class=nn>django.db.models</span> <span class=kn>import</span> <span class=n>Field</span>
<a name=line-12></a><span class=kn>from</span> <span class=nn>django.utils.translation</span> <span class=kn>import</span> <span class=n>gettext_lazy</span> <span class=k>as</span> <span class=n>_</span>
<a name=line-13></a>
<a name=line-14></a><span class=c1># Local cache of the spatial_ref_sys table, which holds SRID data for each</span>
<a name=line-15></a><span class=c1># spatial database alias. This cache exists so that the database isn&#39;t queried</span>
<a name=line-16></a><span class=c1># for SRID info each time a distance query is constructed.</span>
<a name=line-17></a><span class=n>_srid_cache</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>dict</span><span class=p>)</span>
<a name=line-18></a>
<a name=line-19></a>
<a name=line-20></a><span class=n>SRIDCacheEntry</span> <span class=o>=</span> <span class=n>namedtuple</span><span class=p>(</span><span class=s1>&#39;SRIDCacheEntry&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;units&#39;</span><span class=p>,</span> <span class=s1>&#39;units_name&#39;</span><span class=p>,</span> <span class=s1>&#39;spheroid&#39;</span><span class=p>,</span> <span class=s1>&#39;geodetic&#39;</span><span class=p>])</span>
<a name=line-21></a>
<a name=line-22></a>
<a name=line-23></a><span class=k>def</span> <span class=nf>get_srid_info</span><span class=p>(</span><span class=n>srid</span><span class=p>,</span> <span class=n>connection</span><span class=p>):</span>
<a name=line-24></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-25></a><span class=sd>    Return the units, unit name, and spheroid WKT associated with the</span>
<a name=line-26></a><span class=sd>    given SRID from the `spatial_ref_sys` (or equivalent) spatial database</span>
<a name=line-27></a><span class=sd>    table for the given database connection.  These results are cached.</span>
<a name=line-28></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-29></a>    <span class=kn>from</span> <span class=nn>django.contrib.gis.gdal</span> <span class=kn>import</span> <span class=n>SpatialReference</span>
<a name=line-30></a>    <span class=k>global</span> <span class=n>_srid_cache</span>
<a name=line-31></a>
<a name=line-32></a>    <span class=k>try</span><span class=p>:</span>
<a name=line-33></a>        <span class=c1># The SpatialRefSys model for the spatial backend.</span>
<a name=line-34></a>        <span class=n>SpatialRefSys</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>ops</span><span class=o>.</span><span class=n>spatial_ref_sys</span><span class=p>()</span>
<a name=line-35></a>    <span class=k>except</span> <span class=ne>NotImplementedError</span><span class=p>:</span>
<a name=line-36></a>        <span class=n>SpatialRefSys</span> <span class=o>=</span> <span class=kc>None</span>
<a name=line-37></a>
<a name=line-38></a>    <span class=n>alias</span><span class=p>,</span> <span class=n>get_srs</span> <span class=o>=</span> <span class=p>(</span>
<a name=line-39></a>        <span class=p>(</span><span class=n>connection</span><span class=o>.</span><span class=n>alias</span><span class=p>,</span> <span class=k>lambda</span> <span class=n>srid</span><span class=p>:</span> <span class=n>SpatialRefSys</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>using</span><span class=p>(</span><span class=n>connection</span><span class=o>.</span><span class=n>alias</span><span class=p>)</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>srid</span><span class=o>=</span><span class=n>srid</span><span class=p>)</span><span class=o>.</span><span class=n>srs</span><span class=p>)</span>
<a name=line-40></a>        <span class=k>if</span> <span class=n>SpatialRefSys</span> <span class=k>else</span>
<a name=line-41></a>        <span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>SpatialReference</span><span class=p>)</span>
<a name=line-42></a>    <span class=p>)</span>
<a name=line-43></a>    <span class=k>if</span> <span class=n>srid</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>_srid_cache</span><span class=p>[</span><span class=n>alias</span><span class=p>]:</span>
<a name=line-44></a>        <span class=n>srs</span> <span class=o>=</span> <span class=n>get_srs</span><span class=p>(</span><span class=n>srid</span><span class=p>)</span>
<a name=line-45></a>        <span class=n>units</span><span class=p>,</span> <span class=n>units_name</span> <span class=o>=</span> <span class=n>srs</span><span class=o>.</span><span class=n>units</span>
<a name=line-46></a>        <span class=n>_srid_cache</span><span class=p>[</span><span class=n>alias</span><span class=p>][</span><span class=n>srid</span><span class=p>]</span> <span class=o>=</span> <span class=n>SRIDCacheEntry</span><span class=p>(</span>
<a name=line-47></a>            <span class=n>units</span><span class=o>=</span><span class=n>units</span><span class=p>,</span>
<a name=line-48></a>            <span class=n>units_name</span><span class=o>=</span><span class=n>units_name</span><span class=p>,</span>
<a name=line-49></a>            <span class=n>spheroid</span><span class=o>=</span><span class=s1>&#39;SPHEROID[&quot;</span><span class=si>%s</span><span class=s1>&quot;,</span><span class=si>%s</span><span class=s1>,</span><span class=si>%s</span><span class=s1>]&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>srs</span><span class=p>[</span><span class=s1>&#39;spheroid&#39;</span><span class=p>],</span> <span class=n>srs</span><span class=o>.</span><span class=n>semi_major</span><span class=p>,</span> <span class=n>srs</span><span class=o>.</span><span class=n>inverse_flattening</span><span class=p>),</span>
<a name=line-50></a>            <span class=n>geodetic</span><span class=o>=</span><span class=n>srs</span><span class=o>.</span><span class=n>geographic</span><span class=p>,</span>
<a name=line-51></a>        <span class=p>)</span>
<a name=line-52></a>
<a name=line-53></a>    <span class=k>return</span> <span class=n>_srid_cache</span><span class=p>[</span><span class=n>alias</span><span class=p>][</span><span class=n>srid</span><span class=p>]</span>
<a name=line-54></a>
<a name=line-55></a>
<a name=line-56></a><span class=k>class</span> <span class=nc>BaseSpatialField</span><span class=p>(</span><span class=n>Field</span><span class=p>):</span>
<a name=line-57></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-58></a><span class=sd>    The Base GIS Field.</span>
<a name=line-59></a>
<a name=line-60></a><span class=sd>    It&#39;s used as a base class for GeometryField and RasterField. Defines</span>
<a name=line-61></a><span class=sd>    properties that are common to all GIS fields such as the characteristics</span>
<a name=line-62></a><span class=sd>    of the spatial reference system of the field.</span>
<a name=line-63></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-64></a>    <span class=n>description</span> <span class=o>=</span> <span class=n>_</span><span class=p>(</span><span class=s2>&quot;The base GIS field.&quot;</span><span class=p>)</span>
<a name=line-65></a>    <span class=n>empty_strings_allowed</span> <span class=o>=</span> <span class=kc>False</span>
<a name=line-66></a>
<a name=line-67></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>verbose_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>srid</span><span class=o>=</span><span class=mi>4326</span><span class=p>,</span> <span class=n>spatial_index</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
<a name=line-68></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-69></a><span class=sd>        The initialization function for base spatial fields. Takes the following</span>
<a name=line-70></a><span class=sd>        as keyword arguments:</span>
<a name=line-71></a>
<a name=line-72></a><span class=sd>        srid:</span>
<a name=line-73></a><span class=sd>         The spatial reference system identifier, an OGC standard.</span>
<a name=line-74></a><span class=sd>         Defaults to 4326 (WGS84).</span>
<a name=line-75></a>
<a name=line-76></a><span class=sd>        spatial_index:</span>
<a name=line-77></a><span class=sd>         Indicates whether to create a spatial index.  Defaults to True.</span>
<a name=line-78></a><span class=sd>         Set this instead of &#39;db_index&#39; for geographic fields since index</span>
<a name=line-79></a><span class=sd>         creation is different for geometry columns.</span>
<a name=line-80></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-81></a>
<a name=line-82></a>        <span class=c1># Setting the index flag with the value of the `spatial_index` keyword.</span>
<a name=line-83></a>        <span class=bp>self</span><span class=o>.</span><span class=n>spatial_index</span> <span class=o>=</span> <span class=n>spatial_index</span>
<a name=line-84></a>
<a name=line-85></a>        <span class=c1># Setting the SRID and getting the units.  Unit information must be</span>
<a name=line-86></a>        <span class=c1># easily available in the field instance for distance queries.</span>
<a name=line-87></a>        <span class=bp>self</span><span class=o>.</span><span class=n>srid</span> <span class=o>=</span> <span class=n>srid</span>
<a name=line-88></a>
<a name=line-89></a>        <span class=c1># Setting the verbose_name keyword argument with the positional</span>
<a name=line-90></a>        <span class=c1># first parameter, so this works like normal fields.</span>
<a name=line-91></a>        <span class=n>kwargs</span><span class=p>[</span><span class=s1>&#39;verbose_name&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>verbose_name</span>
<a name=line-92></a>
<a name=line-93></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
<a name=line-94></a>
<a name=line-95></a>    <span class=k>def</span> <span class=nf>deconstruct</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-96></a>        <span class=n>name</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span> <span class=o>=</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>deconstruct</span><span class=p>()</span>
<a name=line-97></a>        <span class=c1># Always include SRID for less fragility; include spatial index if it&#39;s</span>
<a name=line-98></a>        <span class=c1># not the default value.</span>
<a name=line-99></a>        <span class=n>kwargs</span><span class=p>[</span><span class=s1>&#39;srid&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>srid</span>
<a name=line-100></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>spatial_index</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>True</span><span class=p>:</span>
<a name=line-101></a>            <span class=n>kwargs</span><span class=p>[</span><span class=s1>&#39;spatial_index&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>spatial_index</span>
<a name=line-102></a>        <span class=k>return</span> <span class=n>name</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span>
<a name=line-103></a>
<a name=line-104></a>    <span class=k>def</span> <span class=nf>db_type</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection</span><span class=p>):</span>
<a name=line-105></a>        <span class=k>return</span> <span class=n>connection</span><span class=o>.</span><span class=n>ops</span><span class=o>.</span><span class=n>geo_db_type</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
<a name=line-106></a>
<a name=line-107></a>    <span class=k>def</span> <span class=nf>spheroid</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection</span><span class=p>):</span>
<a name=line-108></a>        <span class=k>return</span> <span class=n>get_srid_info</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>srid</span><span class=p>,</span> <span class=n>connection</span><span class=p>)</span><span class=o>.</span><span class=n>spheroid</span>
<a name=line-109></a>
<a name=line-110></a>    <span class=k>def</span> <span class=nf>units</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection</span><span class=p>):</span>
<a name=line-111></a>        <span class=k>return</span> <span class=n>get_srid_info</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>srid</span><span class=p>,</span> <span class=n>connection</span><span class=p>)</span><span class=o>.</span><span class=n>units</span>
<a name=line-112></a>
<a name=line-113></a>    <span class=k>def</span> <span class=nf>units_name</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection</span><span class=p>):</span>
<a name=line-114></a>        <span class=k>return</span> <span class=n>get_srid_info</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>srid</span><span class=p>,</span> <span class=n>connection</span><span class=p>)</span><span class=o>.</span><span class=n>units_name</span>
<a name=line-115></a>
<a name=line-116></a>    <span class=k>def</span> <span class=nf>geodetic</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection</span><span class=p>):</span>
<a name=line-117></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-118></a><span class=sd>        Return true if this field&#39;s SRID corresponds with a coordinate</span>
<a name=line-119></a><span class=sd>        system that uses non-projected units (e.g., latitude/longitude).</span>
<a name=line-120></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-121></a>        <span class=k>return</span> <span class=n>get_srid_info</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>srid</span><span class=p>,</span> <span class=n>connection</span><span class=p>)</span><span class=o>.</span><span class=n>geodetic</span>
<a name=line-122></a>
<a name=line-123></a>    <span class=k>def</span> <span class=nf>get_placeholder</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>):</span>
<a name=line-124></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-125></a><span class=sd>        Return the placeholder for the spatial column for the</span>
<a name=line-126></a><span class=sd>        given value.</span>
<a name=line-127></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-128></a>        <span class=k>return</span> <span class=n>connection</span><span class=o>.</span><span class=n>ops</span><span class=o>.</span><span class=n>get_geom_placeholder</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>compiler</span><span class=p>)</span>
<a name=line-129></a>
<a name=line-130></a>    <span class=k>def</span> <span class=nf>get_srid</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj</span><span class=p>):</span>
<a name=line-131></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-132></a><span class=sd>        Return the default SRID for the given geometry or raster, taking into</span>
<a name=line-133></a><span class=sd>        account the SRID set for the field. For example, if the input geometry</span>
<a name=line-134></a><span class=sd>        or raster doesn&#39;t have an SRID, then the SRID of the field will be</span>
<a name=line-135></a><span class=sd>        returned.</span>
<a name=line-136></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-137></a>        <span class=n>srid</span> <span class=o>=</span> <span class=n>obj</span><span class=o>.</span><span class=n>srid</span>  <span class=c1># SRID of given geometry.</span>
<a name=line-138></a>        <span class=k>if</span> <span class=n>srid</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>srid</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span> <span class=ow>or</span> <span class=p>(</span><span class=n>srid</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>srid</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>):</span>
<a name=line-139></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>srid</span>
<a name=line-140></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-141></a>            <span class=k>return</span> <span class=n>srid</span>
<a name=line-142></a>
<a name=line-143></a>    <span class=k>def</span> <span class=nf>get_db_prep_value</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
<a name=line-144></a>        <span class=k>if</span> <span class=n>value</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-145></a>            <span class=k>return</span> <span class=kc>None</span>
<a name=line-146></a>        <span class=k>return</span> <span class=n>connection</span><span class=o>.</span><span class=n>ops</span><span class=o>.</span><span class=n>Adapter</span><span class=p>(</span>
<a name=line-147></a>            <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>get_db_prep_value</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>),</span>
<a name=line-148></a>            <span class=o>**</span><span class=p>(</span>
<a name=line-149></a>                <span class=p>{</span><span class=s1>&#39;geography&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>}</span>
<a name=line-150></a>                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>geography</span> <span class=ow>and</span> <span class=n>connection</span><span class=o>.</span><span class=n>features</span><span class=o>.</span><span class=n>supports_geography</span>
<a name=line-151></a>                <span class=k>else</span> <span class=p>{}</span>
<a name=line-152></a>            <span class=p>)</span>
<a name=line-153></a>        <span class=p>)</span>
<a name=line-154></a>
<a name=line-155></a>    <span class=k>def</span> <span class=nf>get_raster_prep_value</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>is_candidate</span><span class=p>):</span>
<a name=line-156></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-157></a><span class=sd>        Return a GDALRaster if conversion is successful, otherwise return None.</span>
<a name=line-158></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-159></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>gdal</span><span class=o>.</span><span class=n>GDALRaster</span><span class=p>):</span>
<a name=line-160></a>            <span class=k>return</span> <span class=n>value</span>
<a name=line-161></a>        <span class=k>elif</span> <span class=n>is_candidate</span><span class=p>:</span>
<a name=line-162></a>            <span class=k>try</span><span class=p>:</span>
<a name=line-163></a>                <span class=k>return</span> <span class=n>gdal</span><span class=o>.</span><span class=n>GDALRaster</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<a name=line-164></a>            <span class=k>except</span> <span class=n>GDALException</span><span class=p>:</span>
<a name=line-165></a>                <span class=k>pass</span>
<a name=line-166></a>        <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
<a name=line-167></a>            <span class=k>try</span><span class=p>:</span>
<a name=line-168></a>                <span class=k>return</span> <span class=n>gdal</span><span class=o>.</span><span class=n>GDALRaster</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<a name=line-169></a>            <span class=k>except</span> <span class=n>GDALException</span><span class=p>:</span>
<a name=line-170></a>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Couldn&#39;t create spatial object from lookup value &#39;</span><span class=si>%s</span><span class=s2>&#39;.&quot;</span> <span class=o>%</span> <span class=n>value</span><span class=p>)</span>
<a name=line-171></a>
<a name=line-172></a>    <span class=k>def</span> <span class=nf>get_prep_value</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
<a name=line-173></a>        <span class=n>obj</span> <span class=o>=</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>get_prep_value</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<a name=line-174></a>        <span class=k>if</span> <span class=n>obj</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-175></a>            <span class=k>return</span> <span class=kc>None</span>
<a name=line-176></a>        <span class=c1># When the input is not a geometry or raster, attempt to construct one</span>
<a name=line-177></a>        <span class=c1># from the given string input.</span>
<a name=line-178></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>GEOSGeometry</span><span class=p>):</span>
<a name=line-179></a>            <span class=k>pass</span>
<a name=line-180></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-181></a>            <span class=c1># Check if input is a candidate for conversion to raster or geometry.</span>
<a name=line-182></a>            <span class=n>is_candidate</span> <span class=o>=</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=p>(</span><span class=nb>bytes</span><span class=p>,</span> <span class=nb>str</span><span class=p>))</span> <span class=ow>or</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=s1>&#39;__geo_interface__&#39;</span><span class=p>)</span>
<a name=line-183></a>            <span class=c1># Try to convert the input to raster.</span>
<a name=line-184></a>            <span class=n>raster</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_raster_prep_value</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>is_candidate</span><span class=p>)</span>
<a name=line-185></a>
<a name=line-186></a>            <span class=k>if</span> <span class=n>raster</span><span class=p>:</span>
<a name=line-187></a>                <span class=n>obj</span> <span class=o>=</span> <span class=n>raster</span>
<a name=line-188></a>            <span class=k>elif</span> <span class=n>is_candidate</span><span class=p>:</span>
<a name=line-189></a>                <span class=k>try</span><span class=p>:</span>
<a name=line-190></a>                    <span class=n>obj</span> <span class=o>=</span> <span class=n>GEOSGeometry</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
<a name=line-191></a>                <span class=k>except</span> <span class=p>(</span><span class=n>GEOSException</span><span class=p>,</span> <span class=n>GDALException</span><span class=p>):</span>
<a name=line-192></a>                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Couldn&#39;t create spatial object from lookup value &#39;</span><span class=si>%s</span><span class=s2>&#39;.&quot;</span> <span class=o>%</span> <span class=n>obj</span><span class=p>)</span>
<a name=line-193></a>            <span class=k>else</span><span class=p>:</span>
<a name=line-194></a>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;Cannot use object with type </span><span class=si>%s</span><span class=s1> for a spatial lookup parameter.&#39;</span> <span class=o>%</span> <span class=nb>type</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span><span class=o>.</span><span class=vm>__name__</span><span class=p>)</span>
<a name=line-195></a>
<a name=line-196></a>        <span class=c1># Assigning the SRID value.</span>
<a name=line-197></a>        <span class=n>obj</span><span class=o>.</span><span class=n>srid</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_srid</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
<a name=line-198></a>        <span class=k>return</span> <span class=n>obj</span>
<a name=line-199></a>
<a name=line-200></a>
<a name=line-201></a><span class=k>class</span> <span class=nc>GeometryField</span><span class=p>(</span><span class=n>BaseSpatialField</span><span class=p>):</span>
<a name=line-202></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-203></a><span class=sd>    The base Geometry field -- maps to the OpenGIS Specification Geometry type.</span>
<a name=line-204></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-205></a>    <span class=n>description</span> <span class=o>=</span> <span class=n>_</span><span class=p>(</span><span class=s1>&#39;The base Geometry field — maps to the OpenGIS Specification Geometry type.&#39;</span><span class=p>)</span>
<a name=line-206></a>    <span class=n>form_class</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>GeometryField</span>
<a name=line-207></a>    <span class=c1># The OpenGIS Geometry name.</span>
<a name=line-208></a>    <span class=n>geom_type</span> <span class=o>=</span> <span class=s1>&#39;GEOMETRY&#39;</span>
<a name=line-209></a>    <span class=n>geom_class</span> <span class=o>=</span> <span class=kc>None</span>
<a name=line-210></a>
<a name=line-211></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>verbose_name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>dim</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>geography</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>extent</span><span class=o>=</span><span class=p>(</span><span class=o>-</span><span class=mf>180.0</span><span class=p>,</span> <span class=o>-</span><span class=mf>90.0</span><span class=p>,</span> <span class=mf>180.0</span><span class=p>,</span> <span class=mf>90.0</span><span class=p>),</span>
<a name=line-212></a>                 <span class=n>tolerance</span><span class=o>=</span><span class=mf>0.05</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
<a name=line-213></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-214></a><span class=sd>        The initialization function for geometry fields. In addition to the</span>
<a name=line-215></a><span class=sd>        parameters from BaseSpatialField, it takes the following as keyword</span>
<a name=line-216></a><span class=sd>        arguments:</span>
<a name=line-217></a>
<a name=line-218></a><span class=sd>        dim:</span>
<a name=line-219></a><span class=sd>         The number of dimensions for this geometry.  Defaults to 2.</span>
<a name=line-220></a>
<a name=line-221></a><span class=sd>        extent:</span>
<a name=line-222></a><span class=sd>         Customize the extent, in a 4-tuple of WGS 84 coordinates, for the</span>
<a name=line-223></a><span class=sd>         geometry field entry in the `USER_SDO_GEOM_METADATA` table.  Defaults</span>
<a name=line-224></a><span class=sd>         to (-180.0, -90.0, 180.0, 90.0).</span>
<a name=line-225></a>
<a name=line-226></a><span class=sd>        tolerance:</span>
<a name=line-227></a><span class=sd>         Define the tolerance, in meters, to use for the geometry field</span>
<a name=line-228></a><span class=sd>         entry in the `USER_SDO_GEOM_METADATA` table.  Defaults to 0.05.</span>
<a name=line-229></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-230></a>        <span class=c1># Setting the dimension of the geometry field.</span>
<a name=line-231></a>        <span class=bp>self</span><span class=o>.</span><span class=n>dim</span> <span class=o>=</span> <span class=n>dim</span>
<a name=line-232></a>
<a name=line-233></a>        <span class=c1># Is this a geography rather than a geometry column?</span>
<a name=line-234></a>        <span class=bp>self</span><span class=o>.</span><span class=n>geography</span> <span class=o>=</span> <span class=n>geography</span>
<a name=line-235></a>
<a name=line-236></a>        <span class=c1># Oracle-specific private attributes for creating the entry in</span>
<a name=line-237></a>        <span class=c1># `USER_SDO_GEOM_METADATA`</span>
<a name=line-238></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_extent</span> <span class=o>=</span> <span class=n>extent</span>
<a name=line-239></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_tolerance</span> <span class=o>=</span> <span class=n>tolerance</span>
<a name=line-240></a>
<a name=line-241></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>verbose_name</span><span class=o>=</span><span class=n>verbose_name</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
<a name=line-242></a>
<a name=line-243></a>    <span class=k>def</span> <span class=nf>deconstruct</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-244></a>        <span class=n>name</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span> <span class=o>=</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>deconstruct</span><span class=p>()</span>
<a name=line-245></a>        <span class=c1># Include kwargs if they&#39;re not the default values.</span>
<a name=line-246></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>dim</span> <span class=o>!=</span> <span class=mi>2</span><span class=p>:</span>
<a name=line-247></a>            <span class=n>kwargs</span><span class=p>[</span><span class=s1>&#39;dim&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dim</span>
<a name=line-248></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>geography</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>False</span><span class=p>:</span>
<a name=line-249></a>            <span class=n>kwargs</span><span class=p>[</span><span class=s1>&#39;geography&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>geography</span>
<a name=line-250></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_extent</span> <span class=o>!=</span> <span class=p>(</span><span class=o>-</span><span class=mf>180.0</span><span class=p>,</span> <span class=o>-</span><span class=mf>90.0</span><span class=p>,</span> <span class=mf>180.0</span><span class=p>,</span> <span class=mf>90.0</span><span class=p>):</span>
<a name=line-251></a>            <span class=n>kwargs</span><span class=p>[</span><span class=s1>&#39;extent&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_extent</span>
<a name=line-252></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_tolerance</span> <span class=o>!=</span> <span class=mf>0.05</span><span class=p>:</span>
<a name=line-253></a>            <span class=n>kwargs</span><span class=p>[</span><span class=s1>&#39;tolerance&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_tolerance</span>
<a name=line-254></a>        <span class=k>return</span> <span class=n>name</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span>
<a name=line-255></a>
<a name=line-256></a>    <span class=k>def</span> <span class=nf>contribute_to_class</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=bp>cls</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
<a name=line-257></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>contribute_to_class</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
<a name=line-258></a>
<a name=line-259></a>        <span class=c1># Setup for lazy-instantiated Geometry object.</span>
<a name=line-260></a>        <span class=nb>setattr</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>attname</span><span class=p>,</span> <span class=n>SpatialProxy</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>geom_class</span> <span class=ow>or</span> <span class=n>GEOSGeometry</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=n>load_func</span><span class=o>=</span><span class=n>GEOSGeometry</span><span class=p>))</span>
<a name=line-261></a>
<a name=line-262></a>    <span class=k>def</span> <span class=nf>formfield</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
<a name=line-263></a>        <span class=n>defaults</span> <span class=o>=</span> <span class=p>{</span>
<a name=line-264></a>            <span class=s1>&#39;form_class&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>form_class</span><span class=p>,</span>
<a name=line-265></a>            <span class=s1>&#39;geom_type&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>geom_type</span><span class=p>,</span>
<a name=line-266></a>            <span class=s1>&#39;srid&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>srid</span><span class=p>,</span>
<a name=line-267></a>            <span class=o>**</span><span class=n>kwargs</span><span class=p>,</span>
<a name=line-268></a>        <span class=p>}</span>
<a name=line-269></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>dim</span> <span class=o>&gt;</span> <span class=mi>2</span> <span class=ow>and</span> <span class=ow>not</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>defaults</span><span class=p>[</span><span class=s1>&#39;form_class&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>widget</span><span class=p>,</span> <span class=s1>&#39;supports_3d&#39;</span><span class=p>,</span> <span class=kc>False</span><span class=p>):</span>
<a name=line-270></a>            <span class=n>defaults</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=s1>&#39;widget&#39;</span><span class=p>,</span> <span class=n>forms</span><span class=o>.</span><span class=n>Textarea</span><span class=p>)</span>
<a name=line-271></a>        <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>formfield</span><span class=p>(</span><span class=o>**</span><span class=n>defaults</span><span class=p>)</span>
<a name=line-272></a>
<a name=line-273></a>    <span class=k>def</span> <span class=nf>select_format</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>compiler</span><span class=p>,</span> <span class=n>sql</span><span class=p>,</span> <span class=n>params</span><span class=p>):</span>
<a name=line-274></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-275></a><span class=sd>        Return the selection format string, depending on the requirements</span>
<a name=line-276></a><span class=sd>        of the spatial backend. For example, Oracle and MySQL require custom</span>
<a name=line-277></a><span class=sd>        selection formats in order to retrieve geometries in OGC WKB.</span>
<a name=line-278></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-279></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>compiler</span><span class=o>.</span><span class=n>query</span><span class=o>.</span><span class=n>subquery</span><span class=p>:</span>
<a name=line-280></a>            <span class=k>return</span> <span class=n>compiler</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>ops</span><span class=o>.</span><span class=n>select</span> <span class=o>%</span> <span class=n>sql</span><span class=p>,</span> <span class=n>params</span>
<a name=line-281></a>        <span class=k>return</span> <span class=n>sql</span><span class=p>,</span> <span class=n>params</span>
<a name=line-282></a>
<a name=line-283></a>
<a name=line-284></a><span class=c1># The OpenGIS Geometry Type Fields</span>
<a name=line-285></a><span class=k>class</span> <span class=nc>PointField</span><span class=p>(</span><span class=n>GeometryField</span><span class=p>):</span>
<a name=line-286></a>    <span class=n>geom_type</span> <span class=o>=</span> <span class=s1>&#39;POINT&#39;</span>
<a name=line-287></a>    <span class=n>geom_class</span> <span class=o>=</span> <span class=n>Point</span>
<a name=line-288></a>    <span class=n>form_class</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>PointField</span>
<a name=line-289></a>    <span class=n>description</span> <span class=o>=</span> <span class=n>_</span><span class=p>(</span><span class=s2>&quot;Point&quot;</span><span class=p>)</span>
<a name=line-290></a>
<a name=line-291></a>
<a name=line-292></a><span class=k>class</span> <span class=nc>LineStringField</span><span class=p>(</span><span class=n>GeometryField</span><span class=p>):</span>
<a name=line-293></a>    <span class=n>geom_type</span> <span class=o>=</span> <span class=s1>&#39;LINESTRING&#39;</span>
<a name=line-294></a>    <span class=n>geom_class</span> <span class=o>=</span> <span class=n>LineString</span>
<a name=line-295></a>    <span class=n>form_class</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>LineStringField</span>
<a name=line-296></a>    <span class=n>description</span> <span class=o>=</span> <span class=n>_</span><span class=p>(</span><span class=s2>&quot;Line string&quot;</span><span class=p>)</span>
<a name=line-297></a>
<a name=line-298></a>
<a name=line-299></a><span class=k>class</span> <span class=nc>PolygonField</span><span class=p>(</span><span class=n>GeometryField</span><span class=p>):</span>
<a name=line-300></a>    <span class=n>geom_type</span> <span class=o>=</span> <span class=s1>&#39;POLYGON&#39;</span>
<a name=line-301></a>    <span class=n>geom_class</span> <span class=o>=</span> <span class=n>Polygon</span>
<a name=line-302></a>    <span class=n>form_class</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>PolygonField</span>
<a name=line-303></a>    <span class=n>description</span> <span class=o>=</span> <span class=n>_</span><span class=p>(</span><span class=s2>&quot;Polygon&quot;</span><span class=p>)</span>
<a name=line-304></a>
<a name=line-305></a>
<a name=line-306></a><span class=k>class</span> <span class=nc>MultiPointField</span><span class=p>(</span><span class=n>GeometryField</span><span class=p>):</span>
<a name=line-307></a>    <span class=n>geom_type</span> <span class=o>=</span> <span class=s1>&#39;MULTIPOINT&#39;</span>
<a name=line-308></a>    <span class=n>geom_class</span> <span class=o>=</span> <span class=n>MultiPoint</span>
<a name=line-309></a>    <span class=n>form_class</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>MultiPointField</span>
<a name=line-310></a>    <span class=n>description</span> <span class=o>=</span> <span class=n>_</span><span class=p>(</span><span class=s2>&quot;Multi-point&quot;</span><span class=p>)</span>
<a name=line-311></a>
<a name=line-312></a>
<a name=line-313></a><span class=k>class</span> <span class=nc>MultiLineStringField</span><span class=p>(</span><span class=n>GeometryField</span><span class=p>):</span>
<a name=line-314></a>    <span class=n>geom_type</span> <span class=o>=</span> <span class=s1>&#39;MULTILINESTRING&#39;</span>
<a name=line-315></a>    <span class=n>geom_class</span> <span class=o>=</span> <span class=n>MultiLineString</span>
<a name=line-316></a>    <span class=n>form_class</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>MultiLineStringField</span>
<a name=line-317></a>    <span class=n>description</span> <span class=o>=</span> <span class=n>_</span><span class=p>(</span><span class=s2>&quot;Multi-line string&quot;</span><span class=p>)</span>
<a name=line-318></a>
<a name=line-319></a>
<a name=line-320></a><span class=k>class</span> <span class=nc>MultiPolygonField</span><span class=p>(</span><span class=n>GeometryField</span><span class=p>):</span>
<a name=line-321></a>    <span class=n>geom_type</span> <span class=o>=</span> <span class=s1>&#39;MULTIPOLYGON&#39;</span>
<a name=line-322></a>    <span class=n>geom_class</span> <span class=o>=</span> <span class=n>MultiPolygon</span>
<a name=line-323></a>    <span class=n>form_class</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>MultiPolygonField</span>
<a name=line-324></a>    <span class=n>description</span> <span class=o>=</span> <span class=n>_</span><span class=p>(</span><span class=s2>&quot;Multi polygon&quot;</span><span class=p>)</span>
<a name=line-325></a>
<a name=line-326></a>
<a name=line-327></a><span class=k>class</span> <span class=nc>GeometryCollectionField</span><span class=p>(</span><span class=n>GeometryField</span><span class=p>):</span>
<a name=line-328></a>    <span class=n>geom_type</span> <span class=o>=</span> <span class=s1>&#39;GEOMETRYCOLLECTION&#39;</span>
<a name=line-329></a>    <span class=n>geom_class</span> <span class=o>=</span> <span class=n>GeometryCollection</span>
<a name=line-330></a>    <span class=n>form_class</span> <span class=o>=</span> <span class=n>forms</span><span class=o>.</span><span class=n>GeometryCollectionField</span>
<a name=line-331></a>    <span class=n>description</span> <span class=o>=</span> <span class=n>_</span><span class=p>(</span><span class=s2>&quot;Geometry collection&quot;</span><span class=p>)</span>
<a name=line-332></a>
<a name=line-333></a>
<a name=line-334></a><span class=k>class</span> <span class=nc>ExtentField</span><span class=p>(</span><span class=n>Field</span><span class=p>):</span>
<a name=line-335></a>    <span class=s2>&quot;Used as a return value from an extent aggregate&quot;</span>
<a name=line-336></a>
<a name=line-337></a>    <span class=n>description</span> <span class=o>=</span> <span class=n>_</span><span class=p>(</span><span class=s2>&quot;Extent Aggregate Field&quot;</span><span class=p>)</span>
<a name=line-338></a>
<a name=line-339></a>    <span class=k>def</span> <span class=nf>get_internal_type</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-340></a>        <span class=k>return</span> <span class=s2>&quot;ExtentField&quot;</span>
<a name=line-341></a>
<a name=line-342></a>    <span class=k>def</span> <span class=nf>select_format</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>compiler</span><span class=p>,</span> <span class=n>sql</span><span class=p>,</span> <span class=n>params</span><span class=p>):</span>
<a name=line-343></a>        <span class=n>select</span> <span class=o>=</span> <span class=n>compiler</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>ops</span><span class=o>.</span><span class=n>select_extent</span>
<a name=line-344></a>        <span class=k>return</span> <span class=n>select</span> <span class=o>%</span> <span class=n>sql</span> <span class=k>if</span> <span class=n>select</span> <span class=k>else</span> <span class=n>sql</span><span class=p>,</span> <span class=n>params</span>
<a name=line-345></a>
<a name=line-346></a>
<a name=line-347></a><span class=k>class</span> <span class=nc>RasterField</span><span class=p>(</span><span class=n>BaseSpatialField</span><span class=p>):</span>
<a name=line-348></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-349></a><span class=sd>    Raster field for GeoDjango -- evaluates into GDALRaster objects.</span>
<a name=line-350></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-351></a>
<a name=line-352></a>    <span class=n>description</span> <span class=o>=</span> <span class=n>_</span><span class=p>(</span><span class=s2>&quot;Raster Field&quot;</span><span class=p>)</span>
<a name=line-353></a>    <span class=n>geom_type</span> <span class=o>=</span> <span class=s1>&#39;RASTER&#39;</span>
<a name=line-354></a>    <span class=n>geography</span> <span class=o>=</span> <span class=kc>False</span>
<a name=line-355></a>
<a name=line-356></a>    <span class=k>def</span> <span class=nf>_check_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection</span><span class=p>):</span>
<a name=line-357></a>        <span class=c1># Make sure raster fields are used only on backends with raster support.</span>
<a name=line-358></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>connection</span><span class=o>.</span><span class=n>features</span><span class=o>.</span><span class=n>gis_enabled</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>connection</span><span class=o>.</span><span class=n>features</span><span class=o>.</span><span class=n>supports_raster</span><span class=p>:</span>
<a name=line-359></a>            <span class=k>raise</span> <span class=n>ImproperlyConfigured</span><span class=p>(</span><span class=s1>&#39;Raster fields require backends with raster support.&#39;</span><span class=p>)</span>
<a name=line-360></a>
<a name=line-361></a>    <span class=k>def</span> <span class=nf>db_type</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection</span><span class=p>):</span>
<a name=line-362></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_check_connection</span><span class=p>(</span><span class=n>connection</span><span class=p>)</span>
<a name=line-363></a>        <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>db_type</span><span class=p>(</span><span class=n>connection</span><span class=p>)</span>
<a name=line-364></a>
<a name=line-365></a>    <span class=k>def</span> <span class=nf>from_db_value</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>expression</span><span class=p>,</span> <span class=n>connection</span><span class=p>):</span>
<a name=line-366></a>        <span class=k>return</span> <span class=n>connection</span><span class=o>.</span><span class=n>ops</span><span class=o>.</span><span class=n>parse_raster</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<a name=line-367></a>
<a name=line-368></a>    <span class=k>def</span> <span class=nf>contribute_to_class</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=bp>cls</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
<a name=line-369></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>contribute_to_class</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
<a name=line-370></a>        <span class=c1># Setup for lazy-instantiated Raster object. For large querysets, the</span>
<a name=line-371></a>        <span class=c1># instantiation of all GDALRasters can potentially be expensive. This</span>
<a name=line-372></a>        <span class=c1># delays the instantiation of the objects to the moment of evaluation</span>
<a name=line-373></a>        <span class=c1># of the raster attribute.</span>
<a name=line-374></a>        <span class=nb>setattr</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>attname</span><span class=p>,</span> <span class=n>SpatialProxy</span><span class=p>(</span><span class=n>gdal</span><span class=o>.</span><span class=n>GDALRaster</span><span class=p>,</span> <span class=bp>self</span><span class=p>))</span>
<a name=line-375></a>
<a name=line-376></a>    <span class=k>def</span> <span class=nf>get_transform</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>):</span>
<a name=line-377></a>        <span class=kn>from</span> <span class=nn>django.contrib.gis.db.models.lookups</span> <span class=kn>import</span> <span class=n>RasterBandTransform</span>
<a name=line-378></a>        <span class=k>try</span><span class=p>:</span>
<a name=line-379></a>            <span class=n>band_index</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
<a name=line-380></a>            <span class=k>return</span> <span class=nb>type</span><span class=p>(</span>
<a name=line-381></a>                <span class=s1>&#39;SpecificRasterBandTransform&#39;</span><span class=p>,</span>
<a name=line-382></a>                <span class=p>(</span><span class=n>RasterBandTransform</span><span class=p>,),</span>
<a name=line-383></a>                <span class=p>{</span><span class=s1>&#39;band_index&#39;</span><span class=p>:</span> <span class=n>band_index</span><span class=p>}</span>
<a name=line-384></a>            <span class=p>)</span>
<a name=line-385></a>        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
<a name=line-386></a>            <span class=k>pass</span>
<a name=line-387></a>        <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>get_transform</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</pre></div></td></tr></table><p class=footer> Generated by <a href=https://github.com/spirali/nedoc>nedoc</a> v0.9 at 2020-12-29 14:04 </p></div></div></body></html>