<!DOCTYPE html><html><head><meta charset=utf-8><title>django.contrib.gis.gdal.raster.band</title><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=stylesheet href=./assets/purecss/pure-min.css><link rel=stylesheet href=./assets/purecss/grids-responsive-min.css><link rel=stylesheet href=./assets/style.css><link rel=stylesheet href=./assets/pygments/default.css><link rel=stylesheet href=./assets/jquery/jquery-ui.min.css><script src=./assets/jquery/jquery-3.0.0.min.js></script><script src=./assets/jquery/jquery-ui.min.js></script><script src=nedoc.js></script></head><body><div id=layout class=pure-g><div class="sidebar pure-u-1 pure-u-md-1-4"><div class=header><h1 class=brand-title>Django</h1> 1.0 </div><div id=sbox><input id=search style="color: black;" placeholder="search ..."></div><div class=tree><ul><li><a href=django.html>&#9662; django</a> </li><li><ul><li><a href=django.__main__.html>&#9656; __main__</a> </li><li><a href=django.apps.html>&#9656; apps</a> </li><li><a href=django.bin.html>&#9656; bin</a> </li><li><a href=django.conf.html>&#9656; conf</a> </li><li><a href=django.contrib.html>&#9662; contrib</a> </li><li><ul><li><a href=django.contrib.admin.html>&#9656; admin</a> </li><li><a href=django.contrib.admindocs.html>&#9656; admindocs</a> </li><li><a href=django.contrib.auth.html>&#9656; auth</a> </li><li><a href=django.contrib.contenttypes.html>&#9656; contenttypes</a> </li><li><a href=django.contrib.flatpages.html>&#9656; flatpages</a> </li><li><a href=django.contrib.gis.html>&#9662; gis</a> </li><li><ul><li><a href=django.contrib.gis.admin.html>&#9656; admin</a> </li><li><a href=django.contrib.gis.apps.html>&#9656; apps</a> </li><li><a href=django.contrib.gis.db.html>&#9656; db</a> </li><li><a href=django.contrib.gis.feeds.html>&#9656; feeds</a> </li><li><a href=django.contrib.gis.forms.html>&#9656; forms</a> </li><li><a href=django.contrib.gis.gdal.html>&#9662; gdal</a> </li><li><ul><li><a href=django.contrib.gis.gdal.base.html>&#9656; base</a> </li><li><a href=django.contrib.gis.gdal.datasource.html>&#9656; datasource</a> </li><li><a href=django.contrib.gis.gdal.driver.html>&#9656; driver</a> </li><li><a href=django.contrib.gis.gdal.envelope.html>&#9656; envelope</a> </li><li><a href=django.contrib.gis.gdal.error.html>&#9656; error</a> </li><li><a href=django.contrib.gis.gdal.feature.html>&#9656; feature</a> </li><li><a href=django.contrib.gis.gdal.field.html>&#9656; field</a> </li><li><a href=django.contrib.gis.gdal.geometries.html>&#9656; geometries</a> </li><li><a href=django.contrib.gis.gdal.geomtype.html>&#9656; geomtype</a> </li><li><a href=django.contrib.gis.gdal.layer.html>&#9656; layer</a> </li><li><a href=django.contrib.gis.gdal.libgdal.html>&#9656; libgdal</a> </li><li><a href=django.contrib.gis.gdal.prototypes.html>&#9656; prototypes</a> </li><li><a href=django.contrib.gis.gdal.raster.html>&#9662; raster</a> </li><li><ul><li><div class=select><a href=django.contrib.gis.gdal.raster.band.html>&#9662; band</a> </div></li><li><ul><li><a href=django.contrib.gis.gdal.raster.band.BandList.html> <i>class</i> BandList</a> </li><li><a href=django.contrib.gis.gdal.raster.band.GDALBand.html> <i>class</i> GDALBand</a> </li></ul></li><li><a href=django.contrib.gis.gdal.raster.base.html>&#9656; base</a> </li><li><a href=django.contrib.gis.gdal.raster.const.html>&#9656; const</a> </li><li><a href=django.contrib.gis.gdal.raster.source.html>&#9656; source</a> </li></ul></li><li><a href=django.contrib.gis.gdal.srs.html>&#9656; srs</a> </li></ul></li><li><a href=django.contrib.gis.geoip2.html>&#9656; geoip2</a> </li><li><a href=django.contrib.gis.geometry.html>&#9656; geometry</a> </li><li><a href=django.contrib.gis.geos.html>&#9656; geos</a> </li><li><a href=django.contrib.gis.management.html>&#9656; management</a> </li><li><a href=django.contrib.gis.measure.html>&#9656; measure</a> </li><li><a href=django.contrib.gis.ptr.html>&#9656; ptr</a> </li><li><a href=django.contrib.gis.serializers.html>&#9656; serializers</a> </li><li><a href=django.contrib.gis.shortcuts.html>&#9656; shortcuts</a> </li><li><a href=django.contrib.gis.sitemaps.html>&#9656; sitemaps</a> </li><li><a href=django.contrib.gis.utils.html>&#9656; utils</a> </li><li><a href=django.contrib.gis.views.html>&#9656; views</a> </li></ul></li><li><a href=django.contrib.humanize.html>&#9656; humanize</a> </li><li><a href=django.contrib.messages.html>&#9656; messages</a> </li><li><a href=django.contrib.postgres.html>&#9656; postgres</a> </li><li><a href=django.contrib.redirects.html>&#9656; redirects</a> </li><li><a href=django.contrib.sessions.html>&#9656; sessions</a> </li><li><a href=django.contrib.sitemaps.html>&#9656; sitemaps</a> </li><li><a href=django.contrib.sites.html>&#9656; sites</a> </li><li><a href=django.contrib.staticfiles.html>&#9656; staticfiles</a> </li><li><a href=django.contrib.syndication.html>&#9656; syndication</a> </li></ul></li><li><a href=django.core.html>&#9656; core</a> </li><li><a href=django.db.html>&#9656; db</a> </li><li><a href=django.dispatch.html>&#9656; dispatch</a> </li><li><a href=django.forms.html>&#9656; forms</a> </li><li><a href=django.http.html>&#9656; http</a> </li><li><a href=django.middleware.html>&#9656; middleware</a> </li><li><a href=django.shortcuts.html>&#9656; shortcuts</a> </li><li><a href=django.template.html>&#9656; template</a> </li><li><a href=django.templatetags.html>&#9656; templatetags</a> </li><li><a href=django.test.html>&#9656; test</a> </li><li><a href=django.urls.html>&#9656; urls</a> </li><li><a href=django.utils.html>&#9656; utils</a> </li><li><a href=django.views.html>&#9656; views</a> </li></ul></ul></div></div><div class="content pure-u-1 pure-u-md-3-4"><h1>Source code django/contrib/gis/gdal/raster/band.py</h1><div id=path><a class=symbol href=django.html>django</a>.<a class=symbol href=django.contrib.html>contrib</a>.<a class=symbol href=django.contrib.gis.html>gis</a>.<a class=symbol href=django.contrib.gis.gdal.html>gdal</a>.<a class=symbol href=django.contrib.gis.gdal.raster.html>raster</a>.<a class=symbol href=django.contrib.gis.gdal.raster.band.html>band</a></div><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252</pre></div></td><td class=code><div class=highlight><pre><span></span><a name=line-1></a><span class=kn>from</span> <span class=nn>ctypes</span> <span class=kn>import</span> <span class=n>byref</span><span class=p>,</span> <span class=n>c_double</span><span class=p>,</span> <span class=n>c_int</span><span class=p>,</span> <span class=n>c_void_p</span>
<a name=line-2></a>
<a name=line-3></a><span class=kn>from</span> <span class=nn>django.contrib.gis.gdal.error</span> <span class=kn>import</span> <span class=n>GDALException</span>
<a name=line-4></a><span class=kn>from</span> <span class=nn>django.contrib.gis.gdal.prototypes</span> <span class=kn>import</span> <span class=n>raster</span> <span class=k>as</span> <span class=n>capi</span>
<a name=line-5></a><span class=kn>from</span> <span class=nn>django.contrib.gis.gdal.raster.base</span> <span class=kn>import</span> <span class=n>GDALRasterBase</span>
<a name=line-6></a><span class=kn>from</span> <span class=nn>django.contrib.gis.shortcuts</span> <span class=kn>import</span> <span class=n>numpy</span>
<a name=line-7></a><span class=kn>from</span> <span class=nn>django.utils.encoding</span> <span class=kn>import</span> <span class=n>force_str</span>
<a name=line-8></a>
<a name=line-9></a><span class=kn>from</span> <span class=nn>.const</span> <span class=kn>import</span> <span class=p>(</span>
<a name=line-10></a>    <span class=n>GDAL_COLOR_TYPES</span><span class=p>,</span> <span class=n>GDAL_INTEGER_TYPES</span><span class=p>,</span> <span class=n>GDAL_PIXEL_TYPES</span><span class=p>,</span> <span class=n>GDAL_TO_CTYPES</span><span class=p>,</span>
<a name=line-11></a><span class=p>)</span>
<a name=line-12></a>
<a name=line-13></a>
<a name=line-14></a><span class=k>class</span> <span class=nc>GDALBand</span><span class=p>(</span><span class=n>GDALRasterBase</span><span class=p>):</span>
<a name=line-15></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-16></a><span class=sd>    Wrap a GDAL raster band, needs to be obtained from a GDALRaster object.</span>
<a name=line-17></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-18></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>source</span><span class=p>,</span> <span class=n>index</span><span class=p>):</span>
<a name=line-19></a>        <span class=bp>self</span><span class=o>.</span><span class=n>source</span> <span class=o>=</span> <span class=n>source</span>
<a name=line-20></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_ptr</span> <span class=o>=</span> <span class=n>capi</span><span class=o>.</span><span class=n>get_ds_raster_band</span><span class=p>(</span><span class=n>source</span><span class=o>.</span><span class=n>_ptr</span><span class=p>,</span> <span class=n>index</span><span class=p>)</span>
<a name=line-21></a>
<a name=line-22></a>    <span class=k>def</span> <span class=nf>_flush</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-23></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-24></a><span class=sd>        Call the flush method on the Band&#39;s parent raster and force a refresh</span>
<a name=line-25></a><span class=sd>        of the statistics attribute when requested the next time.</span>
<a name=line-26></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-27></a>        <span class=bp>self</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>_flush</span><span class=p>()</span>
<a name=line-28></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_stats_refresh</span> <span class=o>=</span> <span class=kc>True</span>
<a name=line-29></a>
<a name=line-30></a>    <span class=nd>@property</span>
<a name=line-31></a>    <span class=k>def</span> <span class=nf>description</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-32></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-33></a><span class=sd>        Return the description string of the band.</span>
<a name=line-34></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-35></a>        <span class=k>return</span> <span class=n>force_str</span><span class=p>(</span><span class=n>capi</span><span class=o>.</span><span class=n>get_band_description</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ptr</span><span class=p>))</span>
<a name=line-36></a>
<a name=line-37></a>    <span class=nd>@property</span>
<a name=line-38></a>    <span class=k>def</span> <span class=nf>width</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-39></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-40></a><span class=sd>        Width (X axis) in pixels of the band.</span>
<a name=line-41></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-42></a>        <span class=k>return</span> <span class=n>capi</span><span class=o>.</span><span class=n>get_band_xsize</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ptr</span><span class=p>)</span>
<a name=line-43></a>
<a name=line-44></a>    <span class=nd>@property</span>
<a name=line-45></a>    <span class=k>def</span> <span class=nf>height</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-46></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-47></a><span class=sd>        Height (Y axis) in pixels of the band.</span>
<a name=line-48></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-49></a>        <span class=k>return</span> <span class=n>capi</span><span class=o>.</span><span class=n>get_band_ysize</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ptr</span><span class=p>)</span>
<a name=line-50></a>
<a name=line-51></a>    <span class=nd>@property</span>
<a name=line-52></a>    <span class=k>def</span> <span class=nf>pixel_count</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-53></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-54></a><span class=sd>        Return the total number of pixels in this band.</span>
<a name=line-55></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-56></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>width</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>height</span>
<a name=line-57></a>
<a name=line-58></a>    <span class=n>_stats_refresh</span> <span class=o>=</span> <span class=kc>False</span>
<a name=line-59></a>
<a name=line-60></a>    <span class=k>def</span> <span class=nf>statistics</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>refresh</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>approximate</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<a name=line-61></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-62></a><span class=sd>        Compute statistics on the pixel values of this band.</span>
<a name=line-63></a>
<a name=line-64></a><span class=sd>        The return value is a tuple with the following structure:</span>
<a name=line-65></a><span class=sd>        (minimum, maximum, mean, standard deviation).</span>
<a name=line-66></a>
<a name=line-67></a><span class=sd>        If approximate=True, the statistics may be computed based on overviews</span>
<a name=line-68></a><span class=sd>        or a subset of image tiles.</span>
<a name=line-69></a>
<a name=line-70></a><span class=sd>        If refresh=True, the statistics will be computed from the data directly,</span>
<a name=line-71></a><span class=sd>        and the cache will be updated where applicable.</span>
<a name=line-72></a>
<a name=line-73></a><span class=sd>        For empty bands (where all pixel values are nodata), all statistics</span>
<a name=line-74></a><span class=sd>        values are returned as None.</span>
<a name=line-75></a>
<a name=line-76></a><span class=sd>        For raster formats using Persistent Auxiliary Metadata (PAM) services,</span>
<a name=line-77></a><span class=sd>        the statistics might be cached in an auxiliary file.</span>
<a name=line-78></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-79></a>        <span class=c1># Prepare array with arguments for capi function</span>
<a name=line-80></a>        <span class=n>smin</span><span class=p>,</span> <span class=n>smax</span><span class=p>,</span> <span class=n>smean</span><span class=p>,</span> <span class=n>sstd</span> <span class=o>=</span> <span class=n>c_double</span><span class=p>(),</span> <span class=n>c_double</span><span class=p>(),</span> <span class=n>c_double</span><span class=p>(),</span> <span class=n>c_double</span><span class=p>()</span>
<a name=line-81></a>        <span class=n>stats_args</span> <span class=o>=</span> <span class=p>[</span>
<a name=line-82></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_ptr</span><span class=p>,</span> <span class=n>c_int</span><span class=p>(</span><span class=n>approximate</span><span class=p>),</span> <span class=n>byref</span><span class=p>(</span><span class=n>smin</span><span class=p>),</span> <span class=n>byref</span><span class=p>(</span><span class=n>smax</span><span class=p>),</span>
<a name=line-83></a>            <span class=n>byref</span><span class=p>(</span><span class=n>smean</span><span class=p>),</span> <span class=n>byref</span><span class=p>(</span><span class=n>sstd</span><span class=p>),</span> <span class=n>c_void_p</span><span class=p>(),</span> <span class=n>c_void_p</span><span class=p>(),</span>
<a name=line-84></a>        <span class=p>]</span>
<a name=line-85></a>
<a name=line-86></a>        <span class=k>if</span> <span class=n>refresh</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>_stats_refresh</span><span class=p>:</span>
<a name=line-87></a>            <span class=n>func</span> <span class=o>=</span> <span class=n>capi</span><span class=o>.</span><span class=n>compute_band_statistics</span>
<a name=line-88></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-89></a>            <span class=c1># Add additional argument to force computation if there is no</span>
<a name=line-90></a>            <span class=c1># existing PAM file to take the values from.</span>
<a name=line-91></a>            <span class=n>force</span> <span class=o>=</span> <span class=kc>True</span>
<a name=line-92></a>            <span class=n>stats_args</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>c_int</span><span class=p>(</span><span class=n>force</span><span class=p>))</span>
<a name=line-93></a>            <span class=n>func</span> <span class=o>=</span> <span class=n>capi</span><span class=o>.</span><span class=n>get_band_statistics</span>
<a name=line-94></a>
<a name=line-95></a>        <span class=c1># Computation of statistics fails for empty bands.</span>
<a name=line-96></a>        <span class=k>try</span><span class=p>:</span>
<a name=line-97></a>            <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>stats_args</span><span class=p>)</span>
<a name=line-98></a>            <span class=n>result</span> <span class=o>=</span> <span class=n>smin</span><span class=o>.</span><span class=n>value</span><span class=p>,</span> <span class=n>smax</span><span class=o>.</span><span class=n>value</span><span class=p>,</span> <span class=n>smean</span><span class=o>.</span><span class=n>value</span><span class=p>,</span> <span class=n>sstd</span><span class=o>.</span><span class=n>value</span>
<a name=line-99></a>        <span class=k>except</span> <span class=n>GDALException</span><span class=p>:</span>
<a name=line-100></a>            <span class=n>result</span> <span class=o>=</span> <span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<a name=line-101></a>
<a name=line-102></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_stats_refresh</span> <span class=o>=</span> <span class=kc>False</span>
<a name=line-103></a>
<a name=line-104></a>        <span class=k>return</span> <span class=n>result</span>
<a name=line-105></a>
<a name=line-106></a>    <span class=nd>@property</span>
<a name=line-107></a>    <span class=k>def</span> <span class=nf>min</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-108></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-109></a><span class=sd>        Return the minimum pixel value for this band.</span>
<a name=line-110></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-111></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>statistics</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
<a name=line-112></a>
<a name=line-113></a>    <span class=nd>@property</span>
<a name=line-114></a>    <span class=k>def</span> <span class=nf>max</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-115></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-116></a><span class=sd>        Return the maximum pixel value for this band.</span>
<a name=line-117></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-118></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>statistics</span><span class=p>()[</span><span class=mi>1</span><span class=p>]</span>
<a name=line-119></a>
<a name=line-120></a>    <span class=nd>@property</span>
<a name=line-121></a>    <span class=k>def</span> <span class=nf>mean</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-122></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-123></a><span class=sd>        Return the mean of all pixel values of this band.</span>
<a name=line-124></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-125></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>statistics</span><span class=p>()[</span><span class=mi>2</span><span class=p>]</span>
<a name=line-126></a>
<a name=line-127></a>    <span class=nd>@property</span>
<a name=line-128></a>    <span class=k>def</span> <span class=nf>std</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-129></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-130></a><span class=sd>        Return the standard deviation of all pixel values of this band.</span>
<a name=line-131></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-132></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>statistics</span><span class=p>()[</span><span class=mi>3</span><span class=p>]</span>
<a name=line-133></a>
<a name=line-134></a>    <span class=nd>@property</span>
<a name=line-135></a>    <span class=k>def</span> <span class=nf>nodata_value</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-136></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-137></a><span class=sd>        Return the nodata value for this band, or None if it isn&#39;t set.</span>
<a name=line-138></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-139></a>        <span class=c1># Get value and nodata exists flag</span>
<a name=line-140></a>        <span class=n>nodata_exists</span> <span class=o>=</span> <span class=n>c_int</span><span class=p>()</span>
<a name=line-141></a>        <span class=n>value</span> <span class=o>=</span> <span class=n>capi</span><span class=o>.</span><span class=n>get_band_nodata_value</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ptr</span><span class=p>,</span> <span class=n>nodata_exists</span><span class=p>)</span>
<a name=line-142></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>nodata_exists</span><span class=p>:</span>
<a name=line-143></a>            <span class=n>value</span> <span class=o>=</span> <span class=kc>None</span>
<a name=line-144></a>        <span class=c1># If the pixeltype is an integer, convert to int</span>
<a name=line-145></a>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>datatype</span><span class=p>()</span> <span class=ow>in</span> <span class=n>GDAL_INTEGER_TYPES</span><span class=p>:</span>
<a name=line-146></a>            <span class=n>value</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<a name=line-147></a>        <span class=k>return</span> <span class=n>value</span>
<a name=line-148></a>
<a name=line-149></a>    <span class=nd>@nodata_value</span><span class=o>.</span><span class=n>setter</span>
<a name=line-150></a>    <span class=k>def</span> <span class=nf>nodata_value</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
<a name=line-151></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-152></a><span class=sd>        Set the nodata value for this band.</span>
<a name=line-153></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-154></a>        <span class=k>if</span> <span class=n>value</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-155></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>capi</span><span class=o>.</span><span class=n>delete_band_nodata_value</span><span class=p>:</span>
<a name=line-156></a>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;GDAL &gt;= 2.1 required to delete nodata values.&#39;</span><span class=p>)</span>
<a name=line-157></a>            <span class=n>capi</span><span class=o>.</span><span class=n>delete_band_nodata_value</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ptr</span><span class=p>)</span>
<a name=line-158></a>        <span class=k>elif</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=p>(</span><span class=nb>int</span><span class=p>,</span> <span class=nb>float</span><span class=p>)):</span>
<a name=line-159></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;Nodata value must be numeric or None.&#39;</span><span class=p>)</span>
<a name=line-160></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-161></a>            <span class=n>capi</span><span class=o>.</span><span class=n>set_band_nodata_value</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ptr</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span>
<a name=line-162></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_flush</span><span class=p>()</span>
<a name=line-163></a>
<a name=line-164></a>    <span class=k>def</span> <span class=nf>datatype</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>as_string</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<a name=line-165></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-166></a><span class=sd>        Return the GDAL Pixel Datatype for this band.</span>
<a name=line-167></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-168></a>        <span class=n>dtype</span> <span class=o>=</span> <span class=n>capi</span><span class=o>.</span><span class=n>get_band_datatype</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ptr</span><span class=p>)</span>
<a name=line-169></a>        <span class=k>if</span> <span class=n>as_string</span><span class=p>:</span>
<a name=line-170></a>            <span class=n>dtype</span> <span class=o>=</span> <span class=n>GDAL_PIXEL_TYPES</span><span class=p>[</span><span class=n>dtype</span><span class=p>]</span>
<a name=line-171></a>        <span class=k>return</span> <span class=n>dtype</span>
<a name=line-172></a>
<a name=line-173></a>    <span class=k>def</span> <span class=nf>color_interp</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>as_string</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<a name=line-174></a>        <span class=sd>&quot;&quot;&quot;Return the GDAL color interpretation for this band.&quot;&quot;&quot;</span>
<a name=line-175></a>        <span class=n>color</span> <span class=o>=</span> <span class=n>capi</span><span class=o>.</span><span class=n>get_band_color_interp</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ptr</span><span class=p>)</span>
<a name=line-176></a>        <span class=k>if</span> <span class=n>as_string</span><span class=p>:</span>
<a name=line-177></a>            <span class=n>color</span> <span class=o>=</span> <span class=n>GDAL_COLOR_TYPES</span><span class=p>[</span><span class=n>color</span><span class=p>]</span>
<a name=line-178></a>        <span class=k>return</span> <span class=n>color</span>
<a name=line-179></a>
<a name=line-180></a>    <span class=k>def</span> <span class=nf>data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>offset</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>shape</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>as_memoryview</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<a name=line-181></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-182></a><span class=sd>        Read or writes pixel values for this band. Blocks of data can</span>
<a name=line-183></a><span class=sd>        be accessed by specifying the width, height and offset of the</span>
<a name=line-184></a><span class=sd>        desired block. The same specification can be used to update</span>
<a name=line-185></a><span class=sd>        parts of a raster by providing an array of values.</span>
<a name=line-186></a>
<a name=line-187></a><span class=sd>        Allowed input data types are bytes, memoryview, list, tuple, and array.</span>
<a name=line-188></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-189></a>        <span class=n>offset</span> <span class=o>=</span> <span class=n>offset</span> <span class=ow>or</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
<a name=line-190></a>        <span class=n>size</span> <span class=o>=</span> <span class=n>size</span> <span class=ow>or</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>width</span> <span class=o>-</span> <span class=n>offset</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>height</span> <span class=o>-</span> <span class=n>offset</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
<a name=line-191></a>        <span class=n>shape</span> <span class=o>=</span> <span class=n>shape</span> <span class=ow>or</span> <span class=n>size</span>
<a name=line-192></a>        <span class=k>if</span> <span class=nb>any</span><span class=p>(</span><span class=n>x</span> <span class=o>&lt;=</span> <span class=mi>0</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>size</span><span class=p>):</span>
<a name=line-193></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;Offset too big for this raster.&#39;</span><span class=p>)</span>
<a name=line-194></a>
<a name=line-195></a>        <span class=k>if</span> <span class=n>size</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>width</span> <span class=ow>or</span> <span class=n>size</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>height</span><span class=p>:</span>
<a name=line-196></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;Size is larger than raster.&#39;</span><span class=p>)</span>
<a name=line-197></a>
<a name=line-198></a>        <span class=c1># Create ctypes type array generator</span>
<a name=line-199></a>        <span class=n>ctypes_array</span> <span class=o>=</span> <span class=n>GDAL_TO_CTYPES</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>datatype</span><span class=p>()]</span> <span class=o>*</span> <span class=p>(</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
<a name=line-200></a>
<a name=line-201></a>        <span class=k>if</span> <span class=n>data</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-202></a>            <span class=c1># Set read mode</span>
<a name=line-203></a>            <span class=n>access_flag</span> <span class=o>=</span> <span class=mi>0</span>
<a name=line-204></a>            <span class=c1># Prepare empty ctypes array</span>
<a name=line-205></a>            <span class=n>data_array</span> <span class=o>=</span> <span class=n>ctypes_array</span><span class=p>()</span>
<a name=line-206></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-207></a>            <span class=c1># Set write mode</span>
<a name=line-208></a>            <span class=n>access_flag</span> <span class=o>=</span> <span class=mi>1</span>
<a name=line-209></a>
<a name=line-210></a>            <span class=c1># Instantiate ctypes array holding the input data</span>
<a name=line-211></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=p>(</span><span class=nb>bytes</span><span class=p>,</span> <span class=nb>memoryview</span><span class=p>))</span> <span class=ow>or</span> <span class=p>(</span><span class=n>numpy</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>numpy</span><span class=o>.</span><span class=n>ndarray</span><span class=p>)):</span>
<a name=line-212></a>                <span class=n>data_array</span> <span class=o>=</span> <span class=n>ctypes_array</span><span class=o>.</span><span class=n>from_buffer_copy</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
<a name=line-213></a>            <span class=k>else</span><span class=p>:</span>
<a name=line-214></a>                <span class=n>data_array</span> <span class=o>=</span> <span class=n>ctypes_array</span><span class=p>(</span><span class=o>*</span><span class=n>data</span><span class=p>)</span>
<a name=line-215></a>
<a name=line-216></a>        <span class=c1># Access band</span>
<a name=line-217></a>        <span class=n>capi</span><span class=o>.</span><span class=n>band_io</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_ptr</span><span class=p>,</span> <span class=n>access_flag</span><span class=p>,</span> <span class=n>offset</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>offset</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span>
<a name=line-218></a>                     <span class=n>size</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>size</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>byref</span><span class=p>(</span><span class=n>data_array</span><span class=p>),</span> <span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
<a name=line-219></a>                     <span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>datatype</span><span class=p>(),</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
<a name=line-220></a>
<a name=line-221></a>        <span class=c1># Return data as numpy array if possible, otherwise as list</span>
<a name=line-222></a>        <span class=k>if</span> <span class=n>data</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-223></a>            <span class=k>if</span> <span class=n>as_memoryview</span><span class=p>:</span>
<a name=line-224></a>                <span class=k>return</span> <span class=nb>memoryview</span><span class=p>(</span><span class=n>data_array</span><span class=p>)</span>
<a name=line-225></a>            <span class=k>elif</span> <span class=n>numpy</span><span class=p>:</span>
<a name=line-226></a>                <span class=c1># reshape() needs a reshape parameter with the height first.</span>
<a name=line-227></a>                <span class=k>return</span> <span class=n>numpy</span><span class=o>.</span><span class=n>frombuffer</span><span class=p>(</span>
<a name=line-228></a>                    <span class=n>data_array</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>numpy</span><span class=o>.</span><span class=n>dtype</span><span class=p>(</span><span class=n>data_array</span><span class=p>)</span>
<a name=line-229></a>                <span class=p>)</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=nb>tuple</span><span class=p>(</span><span class=nb>reversed</span><span class=p>(</span><span class=n>size</span><span class=p>)))</span>
<a name=line-230></a>            <span class=k>else</span><span class=p>:</span>
<a name=line-231></a>                <span class=k>return</span> <span class=nb>list</span><span class=p>(</span><span class=n>data_array</span><span class=p>)</span>
<a name=line-232></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-233></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_flush</span><span class=p>()</span>
<a name=line-234></a>
<a name=line-235></a>
<a name=line-236></a><span class=k>class</span> <span class=nc>BandList</span><span class=p>(</span><span class=nb>list</span><span class=p>):</span>
<a name=line-237></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>source</span><span class=p>):</span>
<a name=line-238></a>        <span class=bp>self</span><span class=o>.</span><span class=n>source</span> <span class=o>=</span> <span class=n>source</span>
<a name=line-239></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
<a name=line-240></a>
<a name=line-241></a>    <span class=k>def</span> <span class=fm>__iter__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-242></a>        <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
<a name=line-243></a>            <span class=k>yield</span> <span class=n>GDALBand</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>source</span><span class=p>,</span> <span class=n>idx</span><span class=p>)</span>
<a name=line-244></a>
<a name=line-245></a>    <span class=k>def</span> <span class=fm>__len__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-246></a>        <span class=k>return</span> <span class=n>capi</span><span class=o>.</span><span class=n>get_ds_raster_count</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>source</span><span class=o>.</span><span class=n>_ptr</span><span class=p>)</span>
<a name=line-247></a>
<a name=line-248></a>    <span class=k>def</span> <span class=fm>__getitem__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>index</span><span class=p>):</span>
<a name=line-249></a>        <span class=k>try</span><span class=p>:</span>
<a name=line-250></a>            <span class=k>return</span> <span class=n>GDALBand</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>source</span><span class=p>,</span> <span class=n>index</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
<a name=line-251></a>        <span class=k>except</span> <span class=n>GDALException</span><span class=p>:</span>
<a name=line-252></a>            <span class=k>raise</span> <span class=n>GDALException</span><span class=p>(</span><span class=s1>&#39;Unable to get band index </span><span class=si>%d</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>index</span><span class=p>)</span>
</pre></div></td></tr></table><p class=footer> Generated by <a href=https://github.com/spirali/nedoc>nedoc</a> v0.9 at 2020-12-29 14:04 </p></div></div></body></html>