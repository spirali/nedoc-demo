<!DOCTYPE html><html><head><meta charset=utf-8><title>django.utils.functional</title><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=stylesheet href=./assets/purecss/pure-min.css><link rel=stylesheet href=./assets/purecss/grids-responsive-min.css><link rel=stylesheet href=./assets/style.css><link rel=stylesheet href=./assets/pygments/default.css><link rel=stylesheet href=./assets/jquery/jquery-ui.min.css><script src=./assets/jquery/jquery-3.0.0.min.js></script><script src=./assets/jquery/jquery-ui.min.js></script><script src=nedoc.js></script></head><body><div id=layout class=pure-g><div class="sidebar pure-u-1 pure-u-md-1-4"><div class=header><h1 class=brand-title>Django</h1> 1.0 </div><div id=sbox><input id=search style="color: black;" placeholder="search ..."></div><div class=tree><ul><li><a href=django.html>&#9662; django</a> </li><li><ul><li><a href=django.__main__.html>&#9656; __main__</a> </li><li><a href=django.apps.html>&#9656; apps</a> </li><li><a href=django.bin.html>&#9656; bin</a> </li><li><a href=django.conf.html>&#9656; conf</a> </li><li><a href=django.contrib.html>&#9656; contrib</a> </li><li><a href=django.core.html>&#9656; core</a> </li><li><a href=django.db.html>&#9656; db</a> </li><li><a href=django.dispatch.html>&#9656; dispatch</a> </li><li><a href=django.forms.html>&#9656; forms</a> </li><li><a href=django.http.html>&#9656; http</a> </li><li><a href=django.middleware.html>&#9656; middleware</a> </li><li><a href=django.shortcuts.html>&#9656; shortcuts</a> </li><li><a href=django.template.html>&#9656; template</a> </li><li><a href=django.templatetags.html>&#9656; templatetags</a> </li><li><a href=django.test.html>&#9656; test</a> </li><li><a href=django.urls.html>&#9656; urls</a> </li><li><a href=django.utils.html>&#9662; utils</a> </li><li><ul><li><a href=django.utils.archive.html>&#9656; archive</a> </li><li><a href=django.utils.asyncio.html>&#9656; asyncio</a> </li><li><a href=django.utils.autoreload.html>&#9656; autoreload</a> </li><li><a href=django.utils.baseconv.html>&#9656; baseconv</a> </li><li><a href=django.utils.cache.html>&#9656; cache</a> </li><li><a href=django.utils.crypto.html>&#9656; crypto</a> </li><li><a href=django.utils.datastructures.html>&#9656; datastructures</a> </li><li><a href=django.utils.dateformat.html>&#9656; dateformat</a> </li><li><a href=django.utils.dateparse.html>&#9656; dateparse</a> </li><li><a href=django.utils.dates.html>&#9656; dates</a> </li><li><a href=django.utils.datetime_safe.html>&#9656; datetime_safe</a> </li><li><a href=django.utils.deconstruct.html>&#9656; deconstruct</a> </li><li><a href=django.utils.decorators.html>&#9656; decorators</a> </li><li><a href=django.utils.deprecation.html>&#9656; deprecation</a> </li><li><a href=django.utils.duration.html>&#9656; duration</a> </li><li><a href=django.utils.encoding.html>&#9656; encoding</a> </li><li><a href=django.utils.feedgenerator.html>&#9656; feedgenerator</a> </li><li><a href=django.utils.formats.html>&#9656; formats</a> </li><li><div class=select><a href=django.utils.functional.html>&#9662; functional</a> </div></li><li><ul><li><a href=django.utils.functional.LazyObject.html> <i>class</i> LazyObject</a> </li><li><a href=django.utils.functional.Promise.html> <i>class</i> Promise</a> </li><li><a href=django.utils.functional.SimpleLazyObject.html> <i>class</i> SimpleLazyObject</a> </li><li><a href=django.utils.functional.cached_property.html> <i>class</i> cached_property</a> </li><li><a href=django.utils.functional.classproperty.html> <i>class</i> classproperty</a> </li></ul></li><li><a href=django.utils.hashable.html>&#9656; hashable</a> </li><li><a href=django.utils.html.html>&#9656; html</a> </li><li><a href=django.utils.http.html>&#9656; http</a> </li><li><a href=django.utils.inspect.html>&#9656; inspect</a> </li><li><a href=django.utils.ipv6.html>&#9656; ipv6</a> </li><li><a href=django.utils.itercompat.html>&#9656; itercompat</a> </li><li><a href=django.utils.jslex.html>&#9656; jslex</a> </li><li><a href=django.utils.log.html>&#9656; log</a> </li><li><a href=django.utils.lorem_ipsum.html>&#9656; lorem_ipsum</a> </li><li><a href=django.utils.module_loading.html>&#9656; module_loading</a> </li><li><a href=django.utils.numberformat.html>&#9656; numberformat</a> </li><li><a href=django.utils.regex_helper.html>&#9656; regex_helper</a> </li><li><a href=django.utils.safestring.html>&#9656; safestring</a> </li><li><a href=django.utils.termcolors.html>&#9656; termcolors</a> </li><li><a href=django.utils.text.html>&#9656; text</a> </li><li><a href=django.utils.timesince.html>&#9656; timesince</a> </li><li><a href=django.utils.timezone.html>&#9656; timezone</a> </li><li><a href=django.utils.topological_sort.html>&#9656; topological_sort</a> </li><li><a href=django.utils.translation.html>&#9656; translation</a> </li><li><a href=django.utils.tree.html>&#9656; tree</a> </li><li><a href=django.utils.version.html>&#9656; version</a> </li><li><a href=django.utils.xmlutils.html>&#9656; xmlutils</a> </li></ul></li><li><a href=django.views.html>&#9656; views</a> </li></ul></ul></div></div><div class="content pure-u-1 pure-u-md-3-4"><h1>Source code django/utils/functional.py</h1><div id=path><a class=symbol href=django.html>django</a>.<a class=symbol href=django.utils.html>utils</a>.<a class=symbol href=django.utils.functional.html>functional</a></div><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417</pre></div></td><td class=code><div class=highlight><pre><span></span><a name=line-1></a><span class=kn>import</span> <span class=nn>copy</span>
<a name=line-2></a><span class=kn>import</span> <span class=nn>itertools</span>
<a name=line-3></a><span class=kn>import</span> <span class=nn>operator</span>
<a name=line-4></a><span class=kn>from</span> <span class=nn>functools</span> <span class=kn>import</span> <span class=n>total_ordering</span><span class=p>,</span> <span class=n>wraps</span>
<a name=line-5></a>
<a name=line-6></a>
<a name=line-7></a><span class=k>class</span> <span class=nc>cached_property</span><span class=p>:</span>
<a name=line-8></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-9></a><span class=sd>    Decorator that converts a method with a single self argument into a</span>
<a name=line-10></a><span class=sd>    property cached on the instance.</span>
<a name=line-11></a>
<a name=line-12></a><span class=sd>    A cached property can be made out of an existing method:</span>
<a name=line-13></a><span class=sd>    (e.g. ``url = cached_property(get_absolute_url)``).</span>
<a name=line-14></a><span class=sd>    The optional ``name`` argument is obsolete as of Python 3.6 and will be</span>
<a name=line-15></a><span class=sd>    deprecated in Django 4.0 (#30127).</span>
<a name=line-16></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-17></a>    <span class=n>name</span> <span class=o>=</span> <span class=kc>None</span>
<a name=line-18></a>
<a name=line-19></a>    <span class=nd>@staticmethod</span>
<a name=line-20></a>    <span class=k>def</span> <span class=nf>func</span><span class=p>(</span><span class=n>instance</span><span class=p>):</span>
<a name=line-21></a>        <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span>
<a name=line-22></a>            <span class=s1>&#39;Cannot use cached_property instance without calling &#39;</span>
<a name=line-23></a>            <span class=s1>&#39;__set_name__() on it.&#39;</span>
<a name=line-24></a>        <span class=p>)</span>
<a name=line-25></a>
<a name=line-26></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a name=line-27></a>        <span class=bp>self</span><span class=o>.</span><span class=n>real_func</span> <span class=o>=</span> <span class=n>func</span>
<a name=line-28></a>        <span class=bp>self</span><span class=o>.</span><span class=vm>__doc__</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=s1>&#39;__doc__&#39;</span><span class=p>)</span>
<a name=line-29></a>
<a name=line-30></a>    <span class=k>def</span> <span class=nf>__set_name__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>owner</span><span class=p>,</span> <span class=n>name</span><span class=p>):</span>
<a name=line-31></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-32></a>            <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>
<a name=line-33></a>            <span class=bp>self</span><span class=o>.</span><span class=n>func</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>real_func</span>
<a name=line-34></a>        <span class=k>elif</span> <span class=n>name</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>:</span>
<a name=line-35></a>            <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span>
<a name=line-36></a>                <span class=s2>&quot;Cannot assign the same cached_property to two different names &quot;</span>
<a name=line-37></a>                <span class=s2>&quot;(</span><span class=si>%r</span><span class=s2> and </span><span class=si>%r</span><span class=s2>).&quot;</span> <span class=o>%</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
<a name=line-38></a>            <span class=p>)</span>
<a name=line-39></a>
<a name=line-40></a>    <span class=k>def</span> <span class=fm>__get__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>,</span> <span class=bp>cls</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a name=line-41></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-42></a><span class=sd>        Call the function and put the return value in instance.__dict__ so that</span>
<a name=line-43></a><span class=sd>        subsequent attribute access on the instance returns the cached value</span>
<a name=line-44></a><span class=sd>        instead of calling cached_property.__get__().</span>
<a name=line-45></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-46></a>        <span class=k>if</span> <span class=n>instance</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-47></a>            <span class=k>return</span> <span class=bp>self</span>
<a name=line-48></a>        <span class=n>res</span> <span class=o>=</span> <span class=n>instance</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>func</span><span class=p>(</span><span class=n>instance</span><span class=p>)</span>
<a name=line-49></a>        <span class=k>return</span> <span class=n>res</span>
<a name=line-50></a>
<a name=line-51></a>
<a name=line-52></a><span class=k>class</span> <span class=nc>classproperty</span><span class=p>:</span>
<a name=line-53></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-54></a><span class=sd>    Decorator that converts a method with a single cls argument into a property</span>
<a name=line-55></a><span class=sd>    that can be accessed directly from the class.</span>
<a name=line-56></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-57></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>method</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a name=line-58></a>        <span class=bp>self</span><span class=o>.</span><span class=n>fget</span> <span class=o>=</span> <span class=n>method</span>
<a name=line-59></a>
<a name=line-60></a>    <span class=k>def</span> <span class=fm>__get__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>,</span> <span class=bp>cls</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a name=line-61></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>fget</span><span class=p>(</span><span class=bp>cls</span><span class=p>)</span>
<a name=line-62></a>
<a name=line-63></a>    <span class=k>def</span> <span class=nf>getter</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>method</span><span class=p>):</span>
<a name=line-64></a>        <span class=bp>self</span><span class=o>.</span><span class=n>fget</span> <span class=o>=</span> <span class=n>method</span>
<a name=line-65></a>        <span class=k>return</span> <span class=bp>self</span>
<a name=line-66></a>
<a name=line-67></a>
<a name=line-68></a><span class=k>class</span> <span class=nc>Promise</span><span class=p>:</span>
<a name=line-69></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-70></a><span class=sd>    Base class for the proxy class created in the closure of the lazy function.</span>
<a name=line-71></a><span class=sd>    It&#39;s used to recognize promises in code.</span>
<a name=line-72></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-73></a>    <span class=k>pass</span>
<a name=line-74></a>
<a name=line-75></a>
<a name=line-76></a><span class=k>def</span> <span class=nf>lazy</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=o>*</span><span class=n>resultclasses</span><span class=p>):</span>
<a name=line-77></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-78></a><span class=sd>    Turn any callable into a lazy evaluated callable. result classes or types</span>
<a name=line-79></a><span class=sd>    is required -- at least one is needed so that the automatic forcing of</span>
<a name=line-80></a><span class=sd>    the lazy evaluation code is triggered. Results are not memoized; the</span>
<a name=line-81></a><span class=sd>    function is evaluated on every access.</span>
<a name=line-82></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-83></a>
<a name=line-84></a>    <span class=nd>@total_ordering</span>
<a name=line-85></a>    <span class=k>class</span> <span class=nc>__proxy__</span><span class=p>(</span><span class=n>Promise</span><span class=p>):</span>
<a name=line-86></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-87></a><span class=sd>        Encapsulate a function call and act as a proxy for methods that are</span>
<a name=line-88></a><span class=sd>        called on the result of that function. The function is not evaluated</span>
<a name=line-89></a><span class=sd>        until one of the methods on the result is called.</span>
<a name=line-90></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-91></a>        <span class=n>__prepared</span> <span class=o>=</span> <span class=kc>False</span>
<a name=line-92></a>
<a name=line-93></a>        <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kw</span><span class=p>):</span>
<a name=line-94></a>            <span class=bp>self</span><span class=o>.</span><span class=n>__args</span> <span class=o>=</span> <span class=n>args</span>
<a name=line-95></a>            <span class=bp>self</span><span class=o>.</span><span class=n>__kw</span> <span class=o>=</span> <span class=n>kw</span>
<a name=line-96></a>            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>__prepared</span><span class=p>:</span>
<a name=line-97></a>                <span class=bp>self</span><span class=o>.</span><span class=n>__prepare_class__</span><span class=p>()</span>
<a name=line-98></a>            <span class=bp>self</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=n>__prepared</span> <span class=o>=</span> <span class=kc>True</span>
<a name=line-99></a>
<a name=line-100></a>        <span class=k>def</span> <span class=nf>__reduce__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-101></a>            <span class=k>return</span> <span class=p>(</span>
<a name=line-102></a>                <span class=n>_lazy_proxy_unpickle</span><span class=p>,</span>
<a name=line-103></a>                <span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>__args</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>__kw</span><span class=p>)</span> <span class=o>+</span> <span class=n>resultclasses</span>
<a name=line-104></a>            <span class=p>)</span>
<a name=line-105></a>
<a name=line-106></a>        <span class=k>def</span> <span class=fm>__repr__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-107></a>            <span class=k>return</span> <span class=nb>repr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__cast</span><span class=p>())</span>
<a name=line-108></a>
<a name=line-109></a>        <span class=nd>@classmethod</span>
<a name=line-110></a>        <span class=k>def</span> <span class=nf>__prepare_class__</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
<a name=line-111></a>            <span class=k>for</span> <span class=n>resultclass</span> <span class=ow>in</span> <span class=n>resultclasses</span><span class=p>:</span>
<a name=line-112></a>                <span class=k>for</span> <span class=n>type_</span> <span class=ow>in</span> <span class=n>resultclass</span><span class=o>.</span><span class=n>mro</span><span class=p>():</span>
<a name=line-113></a>                    <span class=k>for</span> <span class=n>method_name</span> <span class=ow>in</span> <span class=n>type_</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>:</span>
<a name=line-114></a>                        <span class=c1># All __promise__ return the same wrapper method, they</span>
<a name=line-115></a>                        <span class=c1># look up the correct implementation when called.</span>
<a name=line-116></a>                        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>method_name</span><span class=p>):</span>
<a name=line-117></a>                            <span class=k>continue</span>
<a name=line-118></a>                        <span class=n>meth</span> <span class=o>=</span> <span class=bp>cls</span><span class=o>.</span><span class=n>__promise__</span><span class=p>(</span><span class=n>method_name</span><span class=p>)</span>
<a name=line-119></a>                        <span class=nb>setattr</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>method_name</span><span class=p>,</span> <span class=n>meth</span><span class=p>)</span>
<a name=line-120></a>            <span class=bp>cls</span><span class=o>.</span><span class=n>_delegate_bytes</span> <span class=o>=</span> <span class=nb>bytes</span> <span class=ow>in</span> <span class=n>resultclasses</span>
<a name=line-121></a>            <span class=bp>cls</span><span class=o>.</span><span class=n>_delegate_text</span> <span class=o>=</span> <span class=nb>str</span> <span class=ow>in</span> <span class=n>resultclasses</span>
<a name=line-122></a>            <span class=k>assert</span> <span class=ow>not</span> <span class=p>(</span><span class=bp>cls</span><span class=o>.</span><span class=n>_delegate_bytes</span> <span class=ow>and</span> <span class=bp>cls</span><span class=o>.</span><span class=n>_delegate_text</span><span class=p>),</span> <span class=p>(</span>
<a name=line-123></a>                <span class=s2>&quot;Cannot call lazy() with both bytes and text return types.&quot;</span><span class=p>)</span>
<a name=line-124></a>            <span class=k>if</span> <span class=bp>cls</span><span class=o>.</span><span class=n>_delegate_text</span><span class=p>:</span>
<a name=line-125></a>                <span class=bp>cls</span><span class=o>.</span><span class=fm>__str__</span> <span class=o>=</span> <span class=bp>cls</span><span class=o>.</span><span class=n>__text_cast</span>
<a name=line-126></a>            <span class=k>elif</span> <span class=bp>cls</span><span class=o>.</span><span class=n>_delegate_bytes</span><span class=p>:</span>
<a name=line-127></a>                <span class=bp>cls</span><span class=o>.</span><span class=fm>__bytes__</span> <span class=o>=</span> <span class=bp>cls</span><span class=o>.</span><span class=n>__bytes_cast</span>
<a name=line-128></a>
<a name=line-129></a>        <span class=nd>@classmethod</span>
<a name=line-130></a>        <span class=k>def</span> <span class=nf>__promise__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>method_name</span><span class=p>):</span>
<a name=line-131></a>            <span class=c1># Builds a wrapper around some magic method</span>
<a name=line-132></a>            <span class=k>def</span> <span class=nf>__wrapper__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>):</span>
<a name=line-133></a>                <span class=c1># Automatically triggers the evaluation of a lazy value and</span>
<a name=line-134></a>                <span class=c1># applies the given magic method of the result type.</span>
<a name=line-135></a>                <span class=n>res</span> <span class=o>=</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=bp>self</span><span class=o>.</span><span class=n>__args</span><span class=p>,</span> <span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>__kw</span><span class=p>)</span>
<a name=line-136></a>                <span class=k>return</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>res</span><span class=p>,</span> <span class=n>method_name</span><span class=p>)(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>)</span>
<a name=line-137></a>            <span class=k>return</span> <span class=n>__wrapper__</span>
<a name=line-138></a>
<a name=line-139></a>        <span class=k>def</span> <span class=nf>__text_cast</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-140></a>            <span class=k>return</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=bp>self</span><span class=o>.</span><span class=n>__args</span><span class=p>,</span> <span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>__kw</span><span class=p>)</span>
<a name=line-141></a>
<a name=line-142></a>        <span class=k>def</span> <span class=nf>__bytes_cast</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-143></a>            <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=bp>self</span><span class=o>.</span><span class=n>__args</span><span class=p>,</span> <span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>__kw</span><span class=p>))</span>
<a name=line-144></a>
<a name=line-145></a>        <span class=k>def</span> <span class=nf>__bytes_cast_encoded</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-146></a>            <span class=k>return</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=bp>self</span><span class=o>.</span><span class=n>__args</span><span class=p>,</span> <span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>__kw</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span>
<a name=line-147></a>
<a name=line-148></a>        <span class=k>def</span> <span class=nf>__cast</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-149></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_delegate_bytes</span><span class=p>:</span>
<a name=line-150></a>                <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>__bytes_cast</span><span class=p>()</span>
<a name=line-151></a>            <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>_delegate_text</span><span class=p>:</span>
<a name=line-152></a>                <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>__text_cast</span><span class=p>()</span>
<a name=line-153></a>            <span class=k>else</span><span class=p>:</span>
<a name=line-154></a>                <span class=k>return</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=bp>self</span><span class=o>.</span><span class=n>__args</span><span class=p>,</span> <span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>__kw</span><span class=p>)</span>
<a name=line-155></a>
<a name=line-156></a>        <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-157></a>            <span class=c1># object defines __str__(), so __prepare_class__() won&#39;t overload</span>
<a name=line-158></a>            <span class=c1># a __str__() method from the proxied class.</span>
<a name=line-159></a>            <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__cast</span><span class=p>())</span>
<a name=line-160></a>
<a name=line-161></a>        <span class=k>def</span> <span class=fm>__eq__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other</span><span class=p>):</span>
<a name=line-162></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>other</span><span class=p>,</span> <span class=n>Promise</span><span class=p>):</span>
<a name=line-163></a>                <span class=n>other</span> <span class=o>=</span> <span class=n>other</span><span class=o>.</span><span class=n>__cast</span><span class=p>()</span>
<a name=line-164></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>__cast</span><span class=p>()</span> <span class=o>==</span> <span class=n>other</span>
<a name=line-165></a>
<a name=line-166></a>        <span class=k>def</span> <span class=fm>__lt__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other</span><span class=p>):</span>
<a name=line-167></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>other</span><span class=p>,</span> <span class=n>Promise</span><span class=p>):</span>
<a name=line-168></a>                <span class=n>other</span> <span class=o>=</span> <span class=n>other</span><span class=o>.</span><span class=n>__cast</span><span class=p>()</span>
<a name=line-169></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>__cast</span><span class=p>()</span> <span class=o>&lt;</span> <span class=n>other</span>
<a name=line-170></a>
<a name=line-171></a>        <span class=k>def</span> <span class=fm>__hash__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-172></a>            <span class=k>return</span> <span class=nb>hash</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__cast</span><span class=p>())</span>
<a name=line-173></a>
<a name=line-174></a>        <span class=k>def</span> <span class=fm>__mod__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rhs</span><span class=p>):</span>
<a name=line-175></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_delegate_text</span><span class=p>:</span>
<a name=line-176></a>                <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>%</span> <span class=n>rhs</span>
<a name=line-177></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>__cast</span><span class=p>()</span> <span class=o>%</span> <span class=n>rhs</span>
<a name=line-178></a>
<a name=line-179></a>        <span class=k>def</span> <span class=nf>__deepcopy__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>memo</span><span class=p>):</span>
<a name=line-180></a>            <span class=c1># Instances of this class are effectively immutable. It&#39;s just a</span>
<a name=line-181></a>            <span class=c1># collection of functions. So we don&#39;t need to do anything</span>
<a name=line-182></a>            <span class=c1># complicated for copying.</span>
<a name=line-183></a>            <span class=n>memo</span><span class=p>[</span><span class=nb>id</span><span class=p>(</span><span class=bp>self</span><span class=p>)]</span> <span class=o>=</span> <span class=bp>self</span>
<a name=line-184></a>            <span class=k>return</span> <span class=bp>self</span>
<a name=line-185></a>
<a name=line-186></a>    <span class=nd>@wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
<a name=line-187></a>    <span class=k>def</span> <span class=nf>__wrapper__</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>):</span>
<a name=line-188></a>        <span class=c1># Creates the proxy object, instead of the actual value.</span>
<a name=line-189></a>        <span class=k>return</span> <span class=n>__proxy__</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=n>kw</span><span class=p>)</span>
<a name=line-190></a>
<a name=line-191></a>    <span class=k>return</span> <span class=n>__wrapper__</span>
<a name=line-192></a>
<a name=line-193></a>
<a name=line-194></a><span class=k>def</span> <span class=nf>_lazy_proxy_unpickle</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>,</span> <span class=o>*</span><span class=n>resultclasses</span><span class=p>):</span>
<a name=line-195></a>    <span class=k>return</span> <span class=n>lazy</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=o>*</span><span class=n>resultclasses</span><span class=p>)(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
<a name=line-196></a>
<a name=line-197></a>
<a name=line-198></a><span class=k>def</span> <span class=nf>lazystr</span><span class=p>(</span><span class=n>text</span><span class=p>):</span>
<a name=line-199></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-200></a><span class=sd>    Shortcut for the common case of a lazy callable that returns str.</span>
<a name=line-201></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-202></a>    <span class=k>return</span> <span class=n>lazy</span><span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>)(</span><span class=n>text</span><span class=p>)</span>
<a name=line-203></a>
<a name=line-204></a>
<a name=line-205></a><span class=k>def</span> <span class=nf>keep_lazy</span><span class=p>(</span><span class=o>*</span><span class=n>resultclasses</span><span class=p>):</span>
<a name=line-206></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-207></a><span class=sd>    A decorator that allows a function to be called with one or more lazy</span>
<a name=line-208></a><span class=sd>    arguments. If none of the args are lazy, the function is evaluated</span>
<a name=line-209></a><span class=sd>    immediately, otherwise a __proxy__ is returned that will evaluate the</span>
<a name=line-210></a><span class=sd>    function when needed.</span>
<a name=line-211></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-212></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>resultclasses</span><span class=p>:</span>
<a name=line-213></a>        <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=s2>&quot;You must pass at least one argument to keep_lazy().&quot;</span><span class=p>)</span>
<a name=line-214></a>
<a name=line-215></a>    <span class=k>def</span> <span class=nf>decorator</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
<a name=line-216></a>        <span class=n>lazy_func</span> <span class=o>=</span> <span class=n>lazy</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=o>*</span><span class=n>resultclasses</span><span class=p>)</span>
<a name=line-217></a>
<a name=line-218></a>        <span class=nd>@wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
<a name=line-219></a>        <span class=k>def</span> <span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
<a name=line-220></a>            <span class=k>if</span> <span class=nb>any</span><span class=p>(</span><span class=nb>isinstance</span><span class=p>(</span><span class=n>arg</span><span class=p>,</span> <span class=n>Promise</span><span class=p>)</span> <span class=k>for</span> <span class=n>arg</span> <span class=ow>in</span> <span class=n>itertools</span><span class=o>.</span><span class=n>chain</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>values</span><span class=p>())):</span>
<a name=line-221></a>                <span class=k>return</span> <span class=n>lazy_func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
<a name=line-222></a>            <span class=k>return</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
<a name=line-223></a>        <span class=k>return</span> <span class=n>wrapper</span>
<a name=line-224></a>    <span class=k>return</span> <span class=n>decorator</span>
<a name=line-225></a>
<a name=line-226></a>
<a name=line-227></a><span class=k>def</span> <span class=nf>keep_lazy_text</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
<a name=line-228></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-229></a><span class=sd>    A decorator for functions that accept lazy arguments and return text.</span>
<a name=line-230></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-231></a>    <span class=k>return</span> <span class=n>keep_lazy</span><span class=p>(</span><span class=nb>str</span><span class=p>)(</span><span class=n>func</span><span class=p>)</span>
<a name=line-232></a>
<a name=line-233></a>
<a name=line-234></a><span class=n>empty</span> <span class=o>=</span> <span class=nb>object</span><span class=p>()</span>
<a name=line-235></a>
<a name=line-236></a>
<a name=line-237></a><span class=k>def</span> <span class=nf>new_method_proxy</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
<a name=line-238></a>    <span class=k>def</span> <span class=nf>inner</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>):</span>
<a name=line-239></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span> <span class=ow>is</span> <span class=n>empty</span><span class=p>:</span>
<a name=line-240></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_setup</span><span class=p>()</span>
<a name=line-241></a>        <span class=k>return</span> <span class=n>func</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>)</span>
<a name=line-242></a>    <span class=k>return</span> <span class=n>inner</span>
<a name=line-243></a>
<a name=line-244></a>
<a name=line-245></a><span class=k>class</span> <span class=nc>LazyObject</span><span class=p>:</span>
<a name=line-246></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-247></a><span class=sd>    A wrapper for another class that can be used to delay instantiation of the</span>
<a name=line-248></a><span class=sd>    wrapped class.</span>
<a name=line-249></a>
<a name=line-250></a><span class=sd>    By subclassing, you have the opportunity to intercept and alter the</span>
<a name=line-251></a><span class=sd>    instantiation. If you don&#39;t need to do that, use SimpleLazyObject.</span>
<a name=line-252></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-253></a>
<a name=line-254></a>    <span class=c1># Avoid infinite recursion when tracing __init__ (#19456).</span>
<a name=line-255></a>    <span class=n>_wrapped</span> <span class=o>=</span> <span class=kc>None</span>
<a name=line-256></a>
<a name=line-257></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-258></a>        <span class=c1># Note: if a subclass overrides __init__(), it will likely need to</span>
<a name=line-259></a>        <span class=c1># override __copy__() and __deepcopy__() as well.</span>
<a name=line-260></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span> <span class=o>=</span> <span class=n>empty</span>
<a name=line-261></a>
<a name=line-262></a>    <span class=fm>__getattr__</span> <span class=o>=</span> <span class=n>new_method_proxy</span><span class=p>(</span><span class=nb>getattr</span><span class=p>)</span>
<a name=line-263></a>
<a name=line-264></a>    <span class=k>def</span> <span class=fm>__setattr__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
<a name=line-265></a>        <span class=k>if</span> <span class=n>name</span> <span class=o>==</span> <span class=s2>&quot;_wrapped&quot;</span><span class=p>:</span>
<a name=line-266></a>            <span class=c1># Assign to __dict__ to avoid infinite __setattr__ loops.</span>
<a name=line-267></a>            <span class=bp>self</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>[</span><span class=s2>&quot;_wrapped&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
<a name=line-268></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-269></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span> <span class=ow>is</span> <span class=n>empty</span><span class=p>:</span>
<a name=line-270></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_setup</span><span class=p>()</span>
<a name=line-271></a>            <span class=nb>setattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span>
<a name=line-272></a>
<a name=line-273></a>    <span class=k>def</span> <span class=fm>__delattr__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>):</span>
<a name=line-274></a>        <span class=k>if</span> <span class=n>name</span> <span class=o>==</span> <span class=s2>&quot;_wrapped&quot;</span><span class=p>:</span>
<a name=line-275></a>            <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=s2>&quot;can&#39;t delete _wrapped.&quot;</span><span class=p>)</span>
<a name=line-276></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span> <span class=ow>is</span> <span class=n>empty</span><span class=p>:</span>
<a name=line-277></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_setup</span><span class=p>()</span>
<a name=line-278></a>        <span class=nb>delattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
<a name=line-279></a>
<a name=line-280></a>    <span class=k>def</span> <span class=nf>_setup</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-281></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-282></a><span class=sd>        Must be implemented by subclasses to initialize the wrapped object.</span>
<a name=line-283></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-284></a>        <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>(</span><span class=s1>&#39;subclasses of LazyObject must provide a _setup() method&#39;</span><span class=p>)</span>
<a name=line-285></a>
<a name=line-286></a>    <span class=c1># Because we have messed with __class__ below, we confuse pickle as to what</span>
<a name=line-287></a>    <span class=c1># class we are pickling. We&#39;re going to have to initialize the wrapped</span>
<a name=line-288></a>    <span class=c1># object to successfully pickle it, so we might as well just pickle the</span>
<a name=line-289></a>    <span class=c1># wrapped object since they&#39;re supposed to act the same way.</span>
<a name=line-290></a>    <span class=c1>#</span>
<a name=line-291></a>    <span class=c1># Unfortunately, if we try to simply act like the wrapped object, the ruse</span>
<a name=line-292></a>    <span class=c1># will break down when pickle gets our id(). Thus we end up with pickle</span>
<a name=line-293></a>    <span class=c1># thinking, in effect, that we are a distinct object from the wrapped</span>
<a name=line-294></a>    <span class=c1># object, but with the same __dict__. This can cause problems (see #25389).</span>
<a name=line-295></a>    <span class=c1>#</span>
<a name=line-296></a>    <span class=c1># So instead, we define our own __reduce__ method and custom unpickler. We</span>
<a name=line-297></a>    <span class=c1># pickle the wrapped object as the unpickler&#39;s argument, so that pickle</span>
<a name=line-298></a>    <span class=c1># will pickle it normally, and then the unpickler simply returns its</span>
<a name=line-299></a>    <span class=c1># argument.</span>
<a name=line-300></a>    <span class=k>def</span> <span class=nf>__reduce__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-301></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span> <span class=ow>is</span> <span class=n>empty</span><span class=p>:</span>
<a name=line-302></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_setup</span><span class=p>()</span>
<a name=line-303></a>        <span class=k>return</span> <span class=p>(</span><span class=n>unpickle_lazyobject</span><span class=p>,</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span><span class=p>,))</span>
<a name=line-304></a>
<a name=line-305></a>    <span class=k>def</span> <span class=nf>__copy__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-306></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span> <span class=ow>is</span> <span class=n>empty</span><span class=p>:</span>
<a name=line-307></a>            <span class=c1># If uninitialized, copy the wrapper. Use type(self), not</span>
<a name=line-308></a>            <span class=c1># self.__class__, because the latter is proxied.</span>
<a name=line-309></a>            <span class=k>return</span> <span class=nb>type</span><span class=p>(</span><span class=bp>self</span><span class=p>)()</span>
<a name=line-310></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-311></a>            <span class=c1># If initialized, return a copy of the wrapped object.</span>
<a name=line-312></a>            <span class=k>return</span> <span class=n>copy</span><span class=o>.</span><span class=n>copy</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span><span class=p>)</span>
<a name=line-313></a>
<a name=line-314></a>    <span class=k>def</span> <span class=nf>__deepcopy__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>memo</span><span class=p>):</span>
<a name=line-315></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span> <span class=ow>is</span> <span class=n>empty</span><span class=p>:</span>
<a name=line-316></a>            <span class=c1># We have to use type(self), not self.__class__, because the</span>
<a name=line-317></a>            <span class=c1># latter is proxied.</span>
<a name=line-318></a>            <span class=n>result</span> <span class=o>=</span> <span class=nb>type</span><span class=p>(</span><span class=bp>self</span><span class=p>)()</span>
<a name=line-319></a>            <span class=n>memo</span><span class=p>[</span><span class=nb>id</span><span class=p>(</span><span class=bp>self</span><span class=p>)]</span> <span class=o>=</span> <span class=n>result</span>
<a name=line-320></a>            <span class=k>return</span> <span class=n>result</span>
<a name=line-321></a>        <span class=k>return</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span><span class=p>,</span> <span class=n>memo</span><span class=p>)</span>
<a name=line-322></a>
<a name=line-323></a>    <span class=fm>__bytes__</span> <span class=o>=</span> <span class=n>new_method_proxy</span><span class=p>(</span><span class=nb>bytes</span><span class=p>)</span>
<a name=line-324></a>    <span class=fm>__str__</span> <span class=o>=</span> <span class=n>new_method_proxy</span><span class=p>(</span><span class=nb>str</span><span class=p>)</span>
<a name=line-325></a>    <span class=fm>__bool__</span> <span class=o>=</span> <span class=n>new_method_proxy</span><span class=p>(</span><span class=nb>bool</span><span class=p>)</span>
<a name=line-326></a>
<a name=line-327></a>    <span class=c1># Introspection support</span>
<a name=line-328></a>    <span class=fm>__dir__</span> <span class=o>=</span> <span class=n>new_method_proxy</span><span class=p>(</span><span class=nb>dir</span><span class=p>)</span>
<a name=line-329></a>
<a name=line-330></a>    <span class=c1># Need to pretend to be the wrapped class, for the sake of objects that</span>
<a name=line-331></a>    <span class=c1># care about this (especially in equality tests)</span>
<a name=line-332></a>    <span class=vm>__class__</span> <span class=o>=</span> <span class=nb>property</span><span class=p>(</span><span class=n>new_method_proxy</span><span class=p>(</span><span class=n>operator</span><span class=o>.</span><span class=n>attrgetter</span><span class=p>(</span><span class=s2>&quot;__class__&quot;</span><span class=p>)))</span>
<a name=line-333></a>    <span class=fm>__eq__</span> <span class=o>=</span> <span class=n>new_method_proxy</span><span class=p>(</span><span class=n>operator</span><span class=o>.</span><span class=n>eq</span><span class=p>)</span>
<a name=line-334></a>    <span class=fm>__lt__</span> <span class=o>=</span> <span class=n>new_method_proxy</span><span class=p>(</span><span class=n>operator</span><span class=o>.</span><span class=n>lt</span><span class=p>)</span>
<a name=line-335></a>    <span class=fm>__gt__</span> <span class=o>=</span> <span class=n>new_method_proxy</span><span class=p>(</span><span class=n>operator</span><span class=o>.</span><span class=n>gt</span><span class=p>)</span>
<a name=line-336></a>    <span class=fm>__ne__</span> <span class=o>=</span> <span class=n>new_method_proxy</span><span class=p>(</span><span class=n>operator</span><span class=o>.</span><span class=n>ne</span><span class=p>)</span>
<a name=line-337></a>    <span class=fm>__hash__</span> <span class=o>=</span> <span class=n>new_method_proxy</span><span class=p>(</span><span class=nb>hash</span><span class=p>)</span>
<a name=line-338></a>
<a name=line-339></a>    <span class=c1># List/Tuple/Dictionary methods support</span>
<a name=line-340></a>    <span class=fm>__getitem__</span> <span class=o>=</span> <span class=n>new_method_proxy</span><span class=p>(</span><span class=n>operator</span><span class=o>.</span><span class=n>getitem</span><span class=p>)</span>
<a name=line-341></a>    <span class=fm>__setitem__</span> <span class=o>=</span> <span class=n>new_method_proxy</span><span class=p>(</span><span class=n>operator</span><span class=o>.</span><span class=n>setitem</span><span class=p>)</span>
<a name=line-342></a>    <span class=fm>__delitem__</span> <span class=o>=</span> <span class=n>new_method_proxy</span><span class=p>(</span><span class=n>operator</span><span class=o>.</span><span class=n>delitem</span><span class=p>)</span>
<a name=line-343></a>    <span class=fm>__iter__</span> <span class=o>=</span> <span class=n>new_method_proxy</span><span class=p>(</span><span class=nb>iter</span><span class=p>)</span>
<a name=line-344></a>    <span class=fm>__len__</span> <span class=o>=</span> <span class=n>new_method_proxy</span><span class=p>(</span><span class=nb>len</span><span class=p>)</span>
<a name=line-345></a>    <span class=fm>__contains__</span> <span class=o>=</span> <span class=n>new_method_proxy</span><span class=p>(</span><span class=n>operator</span><span class=o>.</span><span class=n>contains</span><span class=p>)</span>
<a name=line-346></a>
<a name=line-347></a>
<a name=line-348></a><span class=k>def</span> <span class=nf>unpickle_lazyobject</span><span class=p>(</span><span class=n>wrapped</span><span class=p>):</span>
<a name=line-349></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-350></a><span class=sd>    Used to unpickle lazy objects. Just return its argument, which will be the</span>
<a name=line-351></a><span class=sd>    wrapped object.</span>
<a name=line-352></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-353></a>    <span class=k>return</span> <span class=n>wrapped</span>
<a name=line-354></a>
<a name=line-355></a>
<a name=line-356></a><span class=k>class</span> <span class=nc>SimpleLazyObject</span><span class=p>(</span><span class=n>LazyObject</span><span class=p>):</span>
<a name=line-357></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-358></a><span class=sd>    A lazy object initialized from any function.</span>
<a name=line-359></a>
<a name=line-360></a><span class=sd>    Designed for compound objects of unknown type. For builtins or objects of</span>
<a name=line-361></a><span class=sd>    known type, use django.utils.functional.lazy.</span>
<a name=line-362></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-363></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>):</span>
<a name=line-364></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-365></a><span class=sd>        Pass in a callable that returns the object to be wrapped.</span>
<a name=line-366></a>
<a name=line-367></a><span class=sd>        If copies are made of the resulting SimpleLazyObject, which can happen</span>
<a name=line-368></a><span class=sd>        in various circumstances within Django, then you must ensure that the</span>
<a name=line-369></a><span class=sd>        callable can be safely run more than once and will return the same</span>
<a name=line-370></a><span class=sd>        value.</span>
<a name=line-371></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-372></a>        <span class=bp>self</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>[</span><span class=s1>&#39;_setupfunc&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>func</span>
<a name=line-373></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
<a name=line-374></a>
<a name=line-375></a>    <span class=k>def</span> <span class=nf>_setup</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-376></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_setupfunc</span><span class=p>()</span>
<a name=line-377></a>
<a name=line-378></a>    <span class=c1># Return a meaningful representation of the lazy object for debugging</span>
<a name=line-379></a>    <span class=c1># without evaluating the wrapped object.</span>
<a name=line-380></a>    <span class=k>def</span> <span class=fm>__repr__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-381></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span> <span class=ow>is</span> <span class=n>empty</span><span class=p>:</span>
<a name=line-382></a>            <span class=n>repr_attr</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_setupfunc</span>
<a name=line-383></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-384></a>            <span class=n>repr_attr</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span>
<a name=line-385></a>        <span class=k>return</span> <span class=s1>&#39;&lt;</span><span class=si>%s</span><span class=s1>: </span><span class=si>%r</span><span class=s1>&gt;&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=nb>type</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span> <span class=n>repr_attr</span><span class=p>)</span>
<a name=line-386></a>
<a name=line-387></a>    <span class=k>def</span> <span class=nf>__copy__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-388></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span> <span class=ow>is</span> <span class=n>empty</span><span class=p>:</span>
<a name=line-389></a>            <span class=c1># If uninitialized, copy the wrapper. Use SimpleLazyObject, not</span>
<a name=line-390></a>            <span class=c1># self.__class__, because the latter is proxied.</span>
<a name=line-391></a>            <span class=k>return</span> <span class=n>SimpleLazyObject</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_setupfunc</span><span class=p>)</span>
<a name=line-392></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-393></a>            <span class=c1># If initialized, return a copy of the wrapped object.</span>
<a name=line-394></a>            <span class=k>return</span> <span class=n>copy</span><span class=o>.</span><span class=n>copy</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span><span class=p>)</span>
<a name=line-395></a>
<a name=line-396></a>    <span class=k>def</span> <span class=nf>__deepcopy__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>memo</span><span class=p>):</span>
<a name=line-397></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span> <span class=ow>is</span> <span class=n>empty</span><span class=p>:</span>
<a name=line-398></a>            <span class=c1># We have to use SimpleLazyObject, not self.__class__, because the</span>
<a name=line-399></a>            <span class=c1># latter is proxied.</span>
<a name=line-400></a>            <span class=n>result</span> <span class=o>=</span> <span class=n>SimpleLazyObject</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_setupfunc</span><span class=p>)</span>
<a name=line-401></a>            <span class=n>memo</span><span class=p>[</span><span class=nb>id</span><span class=p>(</span><span class=bp>self</span><span class=p>)]</span> <span class=o>=</span> <span class=n>result</span>
<a name=line-402></a>            <span class=k>return</span> <span class=n>result</span>
<a name=line-403></a>        <span class=k>return</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_wrapped</span><span class=p>,</span> <span class=n>memo</span><span class=p>)</span>
<a name=line-404></a>
<a name=line-405></a>
<a name=line-406></a><span class=k>def</span> <span class=nf>partition</span><span class=p>(</span><span class=n>predicate</span><span class=p>,</span> <span class=n>values</span><span class=p>):</span>
<a name=line-407></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-408></a><span class=sd>    Split the values into two sets, based on the return value of the function</span>
<a name=line-409></a><span class=sd>    (True/False). e.g.:</span>
<a name=line-410></a>
<a name=line-411></a><span class=sd>        &gt;&gt;&gt; partition(lambda x: x &gt; 3, range(5))</span>
<a name=line-412></a><span class=sd>        [0, 1, 2, 3], [4]</span>
<a name=line-413></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-414></a>    <span class=n>results</span> <span class=o>=</span> <span class=p>([],</span> <span class=p>[])</span>
<a name=line-415></a>    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>values</span><span class=p>:</span>
<a name=line-416></a>        <span class=n>results</span><span class=p>[</span><span class=n>predicate</span><span class=p>(</span><span class=n>item</span><span class=p>)]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
<a name=line-417></a>    <span class=k>return</span> <span class=n>results</span>
</pre></div></td></tr></table><p class=footer> Generated by <a href=https://github.com/spirali/nedoc>nedoc</a> v0.9 at 2020-12-29 14:05 </p></div></div></body></html>