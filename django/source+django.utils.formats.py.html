<!DOCTYPE html><html><head><meta charset=utf-8><title>django.utils.formats</title><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=stylesheet href=./assets/purecss/pure-min.css><link rel=stylesheet href=./assets/purecss/grids-responsive-min.css><link rel=stylesheet href=./assets/style.css><link rel=stylesheet href=./assets/pygments/default.css><link rel=stylesheet href=./assets/jquery/jquery-ui.min.css><script src=./assets/jquery/jquery-3.0.0.min.js></script><script src=./assets/jquery/jquery-ui.min.js></script><script src=nedoc.js></script></head><body><div id=layout class=pure-g><div class="sidebar pure-u-1 pure-u-md-1-4"><div class=header><h1 class=brand-title>Django</h1> 1.0 </div><div id=sbox><input id=search style="color: black;" placeholder="search ..."></div><div class=tree><ul><li><a href=django.html>&#9662; django</a> </li><li><ul><li><a href=django.__main__.html>&#9656; __main__</a> </li><li><a href=django.apps.html>&#9656; apps</a> </li><li><a href=django.bin.html>&#9656; bin</a> </li><li><a href=django.conf.html>&#9656; conf</a> </li><li><a href=django.contrib.html>&#9656; contrib</a> </li><li><a href=django.core.html>&#9656; core</a> </li><li><a href=django.db.html>&#9656; db</a> </li><li><a href=django.dispatch.html>&#9656; dispatch</a> </li><li><a href=django.forms.html>&#9656; forms</a> </li><li><a href=django.http.html>&#9656; http</a> </li><li><a href=django.middleware.html>&#9656; middleware</a> </li><li><a href=django.shortcuts.html>&#9656; shortcuts</a> </li><li><a href=django.template.html>&#9656; template</a> </li><li><a href=django.templatetags.html>&#9656; templatetags</a> </li><li><a href=django.test.html>&#9656; test</a> </li><li><a href=django.urls.html>&#9656; urls</a> </li><li><a href=django.utils.html>&#9662; utils</a> </li><li><ul><li><a href=django.utils.archive.html>&#9656; archive</a> </li><li><a href=django.utils.asyncio.html>&#9656; asyncio</a> </li><li><a href=django.utils.autoreload.html>&#9656; autoreload</a> </li><li><a href=django.utils.baseconv.html>&#9656; baseconv</a> </li><li><a href=django.utils.cache.html>&#9656; cache</a> </li><li><a href=django.utils.crypto.html>&#9656; crypto</a> </li><li><a href=django.utils.datastructures.html>&#9656; datastructures</a> </li><li><a href=django.utils.dateformat.html>&#9656; dateformat</a> </li><li><a href=django.utils.dateparse.html>&#9656; dateparse</a> </li><li><a href=django.utils.dates.html>&#9656; dates</a> </li><li><a href=django.utils.datetime_safe.html>&#9656; datetime_safe</a> </li><li><a href=django.utils.deconstruct.html>&#9656; deconstruct</a> </li><li><a href=django.utils.decorators.html>&#9656; decorators</a> </li><li><a href=django.utils.deprecation.html>&#9656; deprecation</a> </li><li><a href=django.utils.duration.html>&#9656; duration</a> </li><li><a href=django.utils.encoding.html>&#9656; encoding</a> </li><li><a href=django.utils.feedgenerator.html>&#9656; feedgenerator</a> </li><li><div class=select><a href=django.utils.formats.html>&#9662; formats</a> </div></li><li><a href=django.utils.functional.html>&#9656; functional</a> </li><li><a href=django.utils.hashable.html>&#9656; hashable</a> </li><li><a href=django.utils.html.html>&#9656; html</a> </li><li><a href=django.utils.http.html>&#9656; http</a> </li><li><a href=django.utils.inspect.html>&#9656; inspect</a> </li><li><a href=django.utils.ipv6.html>&#9656; ipv6</a> </li><li><a href=django.utils.itercompat.html>&#9656; itercompat</a> </li><li><a href=django.utils.jslex.html>&#9656; jslex</a> </li><li><a href=django.utils.log.html>&#9656; log</a> </li><li><a href=django.utils.lorem_ipsum.html>&#9656; lorem_ipsum</a> </li><li><a href=django.utils.module_loading.html>&#9656; module_loading</a> </li><li><a href=django.utils.numberformat.html>&#9656; numberformat</a> </li><li><a href=django.utils.regex_helper.html>&#9656; regex_helper</a> </li><li><a href=django.utils.safestring.html>&#9656; safestring</a> </li><li><a href=django.utils.termcolors.html>&#9656; termcolors</a> </li><li><a href=django.utils.text.html>&#9656; text</a> </li><li><a href=django.utils.timesince.html>&#9656; timesince</a> </li><li><a href=django.utils.timezone.html>&#9656; timezone</a> </li><li><a href=django.utils.topological_sort.html>&#9656; topological_sort</a> </li><li><a href=django.utils.translation.html>&#9656; translation</a> </li><li><a href=django.utils.tree.html>&#9656; tree</a> </li><li><a href=django.utils.version.html>&#9656; version</a> </li><li><a href=django.utils.xmlutils.html>&#9656; xmlutils</a> </li></ul></li><li><a href=django.views.html>&#9656; views</a> </li></ul></ul></div></div><div class="content pure-u-1 pure-u-md-3-4"><h1>Source code django/utils/formats.py</h1><div id=path><a class=symbol href=django.html>django</a>.<a class=symbol href=django.utils.html>utils</a>.<a class=symbol href=django.utils.formats.html>formats</a></div><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259</pre></div></td><td class=code><div class=highlight><pre><span></span><a name=line-1></a><span class=kn>import</span> <span class=nn>datetime</span>
<a name=line-2></a><span class=kn>import</span> <span class=nn>decimal</span>
<a name=line-3></a><span class=kn>import</span> <span class=nn>unicodedata</span>
<a name=line-4></a><span class=kn>from</span> <span class=nn>importlib</span> <span class=kn>import</span> <span class=n>import_module</span>
<a name=line-5></a>
<a name=line-6></a><span class=kn>from</span> <span class=nn>django.conf</span> <span class=kn>import</span> <span class=n>settings</span>
<a name=line-7></a><span class=kn>from</span> <span class=nn>django.utils</span> <span class=kn>import</span> <span class=n>dateformat</span><span class=p>,</span> <span class=n>datetime_safe</span><span class=p>,</span> <span class=n>numberformat</span>
<a name=line-8></a><span class=kn>from</span> <span class=nn>django.utils.functional</span> <span class=kn>import</span> <span class=n>lazy</span>
<a name=line-9></a><span class=kn>from</span> <span class=nn>django.utils.translation</span> <span class=kn>import</span> <span class=p>(</span>
<a name=line-10></a>    <span class=n>check_for_language</span><span class=p>,</span> <span class=n>get_language</span><span class=p>,</span> <span class=n>to_locale</span><span class=p>,</span>
<a name=line-11></a><span class=p>)</span>
<a name=line-12></a>
<a name=line-13></a><span class=c1># format_cache is a mapping from (format_type, lang) to the format string.</span>
<a name=line-14></a><span class=c1># By using the cache, it is possible to avoid running get_format_modules</span>
<a name=line-15></a><span class=c1># repeatedly.</span>
<a name=line-16></a><span class=n>_format_cache</span> <span class=o>=</span> <span class=p>{}</span>
<a name=line-17></a><span class=n>_format_modules_cache</span> <span class=o>=</span> <span class=p>{}</span>
<a name=line-18></a>
<a name=line-19></a><span class=n>ISO_INPUT_FORMATS</span> <span class=o>=</span> <span class=p>{</span>
<a name=line-20></a>    <span class=s1>&#39;DATE_INPUT_FORMATS&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>],</span>
<a name=line-21></a>    <span class=s1>&#39;TIME_INPUT_FORMATS&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;%H:%M:%S&#39;</span><span class=p>,</span> <span class=s1>&#39;%H:%M:%S.</span><span class=si>%f</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;%H:%M&#39;</span><span class=p>],</span>
<a name=line-22></a>    <span class=s1>&#39;DATETIME_INPUT_FORMATS&#39;</span><span class=p>:</span> <span class=p>[</span>
<a name=line-23></a>        <span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1> %H:%M:%S&#39;</span><span class=p>,</span>
<a name=line-24></a>        <span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1> %H:%M:%S.</span><span class=si>%f</span><span class=s1>&#39;</span><span class=p>,</span>
<a name=line-25></a>        <span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1> %H:%M&#39;</span><span class=p>,</span>
<a name=line-26></a>        <span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1>&#39;</span>
<a name=line-27></a>    <span class=p>],</span>
<a name=line-28></a><span class=p>}</span>
<a name=line-29></a>
<a name=line-30></a>
<a name=line-31></a><span class=n>FORMAT_SETTINGS</span> <span class=o>=</span> <span class=nb>frozenset</span><span class=p>([</span>
<a name=line-32></a>    <span class=s1>&#39;DECIMAL_SEPARATOR&#39;</span><span class=p>,</span>
<a name=line-33></a>    <span class=s1>&#39;THOUSAND_SEPARATOR&#39;</span><span class=p>,</span>
<a name=line-34></a>    <span class=s1>&#39;NUMBER_GROUPING&#39;</span><span class=p>,</span>
<a name=line-35></a>    <span class=s1>&#39;FIRST_DAY_OF_WEEK&#39;</span><span class=p>,</span>
<a name=line-36></a>    <span class=s1>&#39;MONTH_DAY_FORMAT&#39;</span><span class=p>,</span>
<a name=line-37></a>    <span class=s1>&#39;TIME_FORMAT&#39;</span><span class=p>,</span>
<a name=line-38></a>    <span class=s1>&#39;DATE_FORMAT&#39;</span><span class=p>,</span>
<a name=line-39></a>    <span class=s1>&#39;DATETIME_FORMAT&#39;</span><span class=p>,</span>
<a name=line-40></a>    <span class=s1>&#39;SHORT_DATE_FORMAT&#39;</span><span class=p>,</span>
<a name=line-41></a>    <span class=s1>&#39;SHORT_DATETIME_FORMAT&#39;</span><span class=p>,</span>
<a name=line-42></a>    <span class=s1>&#39;YEAR_MONTH_FORMAT&#39;</span><span class=p>,</span>
<a name=line-43></a>    <span class=s1>&#39;DATE_INPUT_FORMATS&#39;</span><span class=p>,</span>
<a name=line-44></a>    <span class=s1>&#39;TIME_INPUT_FORMATS&#39;</span><span class=p>,</span>
<a name=line-45></a>    <span class=s1>&#39;DATETIME_INPUT_FORMATS&#39;</span><span class=p>,</span>
<a name=line-46></a><span class=p>])</span>
<a name=line-47></a>
<a name=line-48></a>
<a name=line-49></a><span class=k>def</span> <span class=nf>reset_format_cache</span><span class=p>():</span>
<a name=line-50></a>    <span class=sd>&quot;&quot;&quot;Clear any cached formats.</span>
<a name=line-51></a>
<a name=line-52></a><span class=sd>    This method is provided primarily for testing purposes,</span>
<a name=line-53></a><span class=sd>    so that the effects of cached formats can be removed.</span>
<a name=line-54></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-55></a>    <span class=k>global</span> <span class=n>_format_cache</span><span class=p>,</span> <span class=n>_format_modules_cache</span>
<a name=line-56></a>    <span class=n>_format_cache</span> <span class=o>=</span> <span class=p>{}</span>
<a name=line-57></a>    <span class=n>_format_modules_cache</span> <span class=o>=</span> <span class=p>{}</span>
<a name=line-58></a>
<a name=line-59></a>
<a name=line-60></a><span class=k>def</span> <span class=nf>iter_format_modules</span><span class=p>(</span><span class=n>lang</span><span class=p>,</span> <span class=n>format_module_path</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a name=line-61></a>    <span class=sd>&quot;&quot;&quot;Find format modules.&quot;&quot;&quot;</span>
<a name=line-62></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>check_for_language</span><span class=p>(</span><span class=n>lang</span><span class=p>):</span>
<a name=line-63></a>        <span class=k>return</span>
<a name=line-64></a>
<a name=line-65></a>    <span class=k>if</span> <span class=n>format_module_path</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-66></a>        <span class=n>format_module_path</span> <span class=o>=</span> <span class=n>settings</span><span class=o>.</span><span class=n>FORMAT_MODULE_PATH</span>
<a name=line-67></a>
<a name=line-68></a>    <span class=n>format_locations</span> <span class=o>=</span> <span class=p>[]</span>
<a name=line-69></a>    <span class=k>if</span> <span class=n>format_module_path</span><span class=p>:</span>
<a name=line-70></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>format_module_path</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
<a name=line-71></a>            <span class=n>format_module_path</span> <span class=o>=</span> <span class=p>[</span><span class=n>format_module_path</span><span class=p>]</span>
<a name=line-72></a>        <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>format_module_path</span><span class=p>:</span>
<a name=line-73></a>            <span class=n>format_locations</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>path</span> <span class=o>+</span> <span class=s1>&#39;.</span><span class=si>%s</span><span class=s1>&#39;</span><span class=p>)</span>
<a name=line-74></a>    <span class=n>format_locations</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;django.conf.locale.</span><span class=si>%s</span><span class=s1>&#39;</span><span class=p>)</span>
<a name=line-75></a>    <span class=n>locale</span> <span class=o>=</span> <span class=n>to_locale</span><span class=p>(</span><span class=n>lang</span><span class=p>)</span>
<a name=line-76></a>    <span class=n>locales</span> <span class=o>=</span> <span class=p>[</span><span class=n>locale</span><span class=p>]</span>
<a name=line-77></a>    <span class=k>if</span> <span class=s1>&#39;_&#39;</span> <span class=ow>in</span> <span class=n>locale</span><span class=p>:</span>
<a name=line-78></a>        <span class=n>locales</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>locale</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;_&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>])</span>
<a name=line-79></a>    <span class=k>for</span> <span class=n>location</span> <span class=ow>in</span> <span class=n>format_locations</span><span class=p>:</span>
<a name=line-80></a>        <span class=k>for</span> <span class=n>loc</span> <span class=ow>in</span> <span class=n>locales</span><span class=p>:</span>
<a name=line-81></a>            <span class=k>try</span><span class=p>:</span>
<a name=line-82></a>                <span class=k>yield</span> <span class=n>import_module</span><span class=p>(</span><span class=s1>&#39;</span><span class=si>%s</span><span class=s1>.formats&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>location</span> <span class=o>%</span> <span class=n>loc</span><span class=p>))</span>
<a name=line-83></a>            <span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
<a name=line-84></a>                <span class=k>pass</span>
<a name=line-85></a>
<a name=line-86></a>
<a name=line-87></a><span class=k>def</span> <span class=nf>get_format_modules</span><span class=p>(</span><span class=n>lang</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<a name=line-88></a>    <span class=sd>&quot;&quot;&quot;Return a list of the format modules found.&quot;&quot;&quot;</span>
<a name=line-89></a>    <span class=k>if</span> <span class=n>lang</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-90></a>        <span class=n>lang</span> <span class=o>=</span> <span class=n>get_language</span><span class=p>()</span>
<a name=line-91></a>    <span class=k>if</span> <span class=n>lang</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>_format_modules_cache</span><span class=p>:</span>
<a name=line-92></a>        <span class=n>_format_modules_cache</span><span class=p>[</span><span class=n>lang</span><span class=p>]</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>iter_format_modules</span><span class=p>(</span><span class=n>lang</span><span class=p>,</span> <span class=n>settings</span><span class=o>.</span><span class=n>FORMAT_MODULE_PATH</span><span class=p>))</span>
<a name=line-93></a>    <span class=n>modules</span> <span class=o>=</span> <span class=n>_format_modules_cache</span><span class=p>[</span><span class=n>lang</span><span class=p>]</span>
<a name=line-94></a>    <span class=k>if</span> <span class=n>reverse</span><span class=p>:</span>
<a name=line-95></a>        <span class=k>return</span> <span class=nb>list</span><span class=p>(</span><span class=nb>reversed</span><span class=p>(</span><span class=n>modules</span><span class=p>))</span>
<a name=line-96></a>    <span class=k>return</span> <span class=n>modules</span>
<a name=line-97></a>
<a name=line-98></a>
<a name=line-99></a><span class=k>def</span> <span class=nf>get_format</span><span class=p>(</span><span class=n>format_type</span><span class=p>,</span> <span class=n>lang</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>use_l10n</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a name=line-100></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-101></a><span class=sd>    For a specific format type, return the format for the current</span>
<a name=line-102></a><span class=sd>    language (locale). Default to the format in the settings.</span>
<a name=line-103></a><span class=sd>    format_type is the name of the format, e.g. &#39;DATE_FORMAT&#39;.</span>
<a name=line-104></a>
<a name=line-105></a><span class=sd>    If use_l10n is provided and is not None, it forces the value to</span>
<a name=line-106></a><span class=sd>    be localized (or not), overriding the value of settings.USE_L10N.</span>
<a name=line-107></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-108></a>    <span class=n>use_l10n</span> <span class=o>=</span> <span class=n>use_l10n</span> <span class=ow>or</span> <span class=p>(</span><span class=n>use_l10n</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>settings</span><span class=o>.</span><span class=n>USE_L10N</span><span class=p>)</span>
<a name=line-109></a>    <span class=k>if</span> <span class=n>use_l10n</span> <span class=ow>and</span> <span class=n>lang</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-110></a>        <span class=n>lang</span> <span class=o>=</span> <span class=n>get_language</span><span class=p>()</span>
<a name=line-111></a>    <span class=n>cache_key</span> <span class=o>=</span> <span class=p>(</span><span class=n>format_type</span><span class=p>,</span> <span class=n>lang</span><span class=p>)</span>
<a name=line-112></a>    <span class=k>try</span><span class=p>:</span>
<a name=line-113></a>        <span class=k>return</span> <span class=n>_format_cache</span><span class=p>[</span><span class=n>cache_key</span><span class=p>]</span>
<a name=line-114></a>    <span class=k>except</span> <span class=ne>KeyError</span><span class=p>:</span>
<a name=line-115></a>        <span class=k>pass</span>
<a name=line-116></a>
<a name=line-117></a>    <span class=c1># The requested format_type has not been cached yet. Try to find it in any</span>
<a name=line-118></a>    <span class=c1># of the format_modules for the given lang if l10n is enabled. If it&#39;s not</span>
<a name=line-119></a>    <span class=c1># there or if l10n is disabled, fall back to the project settings.</span>
<a name=line-120></a>    <span class=n>val</span> <span class=o>=</span> <span class=kc>None</span>
<a name=line-121></a>    <span class=k>if</span> <span class=n>use_l10n</span><span class=p>:</span>
<a name=line-122></a>        <span class=k>for</span> <span class=n>module</span> <span class=ow>in</span> <span class=n>get_format_modules</span><span class=p>(</span><span class=n>lang</span><span class=p>):</span>
<a name=line-123></a>            <span class=n>val</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>module</span><span class=p>,</span> <span class=n>format_type</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
<a name=line-124></a>            <span class=k>if</span> <span class=n>val</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-125></a>                <span class=k>break</span>
<a name=line-126></a>    <span class=k>if</span> <span class=n>val</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-127></a>        <span class=k>if</span> <span class=n>format_type</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>FORMAT_SETTINGS</span><span class=p>:</span>
<a name=line-128></a>            <span class=k>return</span> <span class=n>format_type</span>
<a name=line-129></a>        <span class=n>val</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>settings</span><span class=p>,</span> <span class=n>format_type</span><span class=p>)</span>
<a name=line-130></a>    <span class=k>elif</span> <span class=n>format_type</span> <span class=ow>in</span> <span class=n>ISO_INPUT_FORMATS</span><span class=p>:</span>
<a name=line-131></a>        <span class=c1># If a list of input formats from one of the format_modules was</span>
<a name=line-132></a>        <span class=c1># retrieved, make sure the ISO_INPUT_FORMATS are in this list.</span>
<a name=line-133></a>        <span class=n>val</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>val</span><span class=p>)</span>
<a name=line-134></a>        <span class=k>for</span> <span class=n>iso_input</span> <span class=ow>in</span> <span class=n>ISO_INPUT_FORMATS</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>format_type</span><span class=p>,</span> <span class=p>()):</span>
<a name=line-135></a>            <span class=k>if</span> <span class=n>iso_input</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>val</span><span class=p>:</span>
<a name=line-136></a>                <span class=n>val</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>iso_input</span><span class=p>)</span>
<a name=line-137></a>    <span class=n>_format_cache</span><span class=p>[</span><span class=n>cache_key</span><span class=p>]</span> <span class=o>=</span> <span class=n>val</span>
<a name=line-138></a>    <span class=k>return</span> <span class=n>val</span>
<a name=line-139></a>
<a name=line-140></a>
<a name=line-141></a><span class=n>get_format_lazy</span> <span class=o>=</span> <span class=n>lazy</span><span class=p>(</span><span class=n>get_format</span><span class=p>,</span> <span class=nb>str</span><span class=p>,</span> <span class=nb>list</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>)</span>
<a name=line-142></a>
<a name=line-143></a>
<a name=line-144></a><span class=k>def</span> <span class=nf>date_format</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>format</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>use_l10n</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a name=line-145></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-146></a><span class=sd>    Format a datetime.date or datetime.datetime object using a</span>
<a name=line-147></a><span class=sd>    localizable format.</span>
<a name=line-148></a>
<a name=line-149></a><span class=sd>    If use_l10n is provided and is not None, that will force the value to</span>
<a name=line-150></a><span class=sd>    be localized (or not), overriding the value of settings.USE_L10N.</span>
<a name=line-151></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-152></a>    <span class=k>return</span> <span class=n>dateformat</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>get_format</span><span class=p>(</span><span class=nb>format</span> <span class=ow>or</span> <span class=s1>&#39;DATE_FORMAT&#39;</span><span class=p>,</span> <span class=n>use_l10n</span><span class=o>=</span><span class=n>use_l10n</span><span class=p>))</span>
<a name=line-153></a>
<a name=line-154></a>
<a name=line-155></a><span class=k>def</span> <span class=nf>time_format</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>format</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>use_l10n</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a name=line-156></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-157></a><span class=sd>    Format a datetime.time object using a localizable format.</span>
<a name=line-158></a>
<a name=line-159></a><span class=sd>    If use_l10n is provided and is not None, it forces the value to</span>
<a name=line-160></a><span class=sd>    be localized (or not), overriding the value of settings.USE_L10N.</span>
<a name=line-161></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-162></a>    <span class=k>return</span> <span class=n>dateformat</span><span class=o>.</span><span class=n>time_format</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>get_format</span><span class=p>(</span><span class=nb>format</span> <span class=ow>or</span> <span class=s1>&#39;TIME_FORMAT&#39;</span><span class=p>,</span> <span class=n>use_l10n</span><span class=o>=</span><span class=n>use_l10n</span><span class=p>))</span>
<a name=line-163></a>
<a name=line-164></a>
<a name=line-165></a><span class=k>def</span> <span class=nf>number_format</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>decimal_pos</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>use_l10n</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>force_grouping</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<a name=line-166></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-167></a><span class=sd>    Format a numeric value using localization settings.</span>
<a name=line-168></a>
<a name=line-169></a><span class=sd>    If use_l10n is provided and is not None, it forces the value to</span>
<a name=line-170></a><span class=sd>    be localized (or not), overriding the value of settings.USE_L10N.</span>
<a name=line-171></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-172></a>    <span class=k>if</span> <span class=n>use_l10n</span> <span class=ow>or</span> <span class=p>(</span><span class=n>use_l10n</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>settings</span><span class=o>.</span><span class=n>USE_L10N</span><span class=p>):</span>
<a name=line-173></a>        <span class=n>lang</span> <span class=o>=</span> <span class=n>get_language</span><span class=p>()</span>
<a name=line-174></a>    <span class=k>else</span><span class=p>:</span>
<a name=line-175></a>        <span class=n>lang</span> <span class=o>=</span> <span class=kc>None</span>
<a name=line-176></a>    <span class=k>return</span> <span class=n>numberformat</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
<a name=line-177></a>        <span class=n>value</span><span class=p>,</span>
<a name=line-178></a>        <span class=n>get_format</span><span class=p>(</span><span class=s1>&#39;DECIMAL_SEPARATOR&#39;</span><span class=p>,</span> <span class=n>lang</span><span class=p>,</span> <span class=n>use_l10n</span><span class=o>=</span><span class=n>use_l10n</span><span class=p>),</span>
<a name=line-179></a>        <span class=n>decimal_pos</span><span class=p>,</span>
<a name=line-180></a>        <span class=n>get_format</span><span class=p>(</span><span class=s1>&#39;NUMBER_GROUPING&#39;</span><span class=p>,</span> <span class=n>lang</span><span class=p>,</span> <span class=n>use_l10n</span><span class=o>=</span><span class=n>use_l10n</span><span class=p>),</span>
<a name=line-181></a>        <span class=n>get_format</span><span class=p>(</span><span class=s1>&#39;THOUSAND_SEPARATOR&#39;</span><span class=p>,</span> <span class=n>lang</span><span class=p>,</span> <span class=n>use_l10n</span><span class=o>=</span><span class=n>use_l10n</span><span class=p>),</span>
<a name=line-182></a>        <span class=n>force_grouping</span><span class=o>=</span><span class=n>force_grouping</span><span class=p>,</span>
<a name=line-183></a>        <span class=n>use_l10n</span><span class=o>=</span><span class=n>use_l10n</span><span class=p>,</span>
<a name=line-184></a>    <span class=p>)</span>
<a name=line-185></a>
<a name=line-186></a>
<a name=line-187></a><span class=k>def</span> <span class=nf>localize</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>use_l10n</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a name=line-188></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-189></a><span class=sd>    Check if value is a localizable type (date, number...) and return it</span>
<a name=line-190></a><span class=sd>    formatted as a string using current locale format.</span>
<a name=line-191></a>
<a name=line-192></a><span class=sd>    If use_l10n is provided and is not None, it forces the value to</span>
<a name=line-193></a><span class=sd>    be localized (or not), overriding the value of settings.USE_L10N.</span>
<a name=line-194></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-195></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>  <span class=c1># Handle strings first for performance reasons.</span>
<a name=line-196></a>        <span class=k>return</span> <span class=n>value</span>
<a name=line-197></a>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>bool</span><span class=p>):</span>  <span class=c1># Make sure booleans don&#39;t get treated as numbers</span>
<a name=line-198></a>        <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<a name=line-199></a>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=p>(</span><span class=n>decimal</span><span class=o>.</span><span class=n>Decimal</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>int</span><span class=p>)):</span>
<a name=line-200></a>        <span class=k>if</span> <span class=n>use_l10n</span> <span class=ow>is</span> <span class=kc>False</span><span class=p>:</span>
<a name=line-201></a>            <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<a name=line-202></a>        <span class=k>return</span> <span class=n>number_format</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>use_l10n</span><span class=o>=</span><span class=n>use_l10n</span><span class=p>)</span>
<a name=line-203></a>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>):</span>
<a name=line-204></a>        <span class=k>return</span> <span class=n>date_format</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=s1>&#39;DATETIME_FORMAT&#39;</span><span class=p>,</span> <span class=n>use_l10n</span><span class=o>=</span><span class=n>use_l10n</span><span class=p>)</span>
<a name=line-205></a>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>datetime</span><span class=o>.</span><span class=n>date</span><span class=p>):</span>
<a name=line-206></a>        <span class=k>return</span> <span class=n>date_format</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>use_l10n</span><span class=o>=</span><span class=n>use_l10n</span><span class=p>)</span>
<a name=line-207></a>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>datetime</span><span class=o>.</span><span class=n>time</span><span class=p>):</span>
<a name=line-208></a>        <span class=k>return</span> <span class=n>time_format</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=s1>&#39;TIME_FORMAT&#39;</span><span class=p>,</span> <span class=n>use_l10n</span><span class=o>=</span><span class=n>use_l10n</span><span class=p>)</span>
<a name=line-209></a>    <span class=k>return</span> <span class=n>value</span>
<a name=line-210></a>
<a name=line-211></a>
<a name=line-212></a><span class=k>def</span> <span class=nf>localize_input</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a name=line-213></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-214></a><span class=sd>    Check if an input value is a localizable type and return it</span>
<a name=line-215></a><span class=sd>    formatted with the appropriate formatting string of the current locale.</span>
<a name=line-216></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-217></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>  <span class=c1># Handle strings first for performance reasons.</span>
<a name=line-218></a>        <span class=k>return</span> <span class=n>value</span>
<a name=line-219></a>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>bool</span><span class=p>):</span>  <span class=c1># Don&#39;t treat booleans as numbers.</span>
<a name=line-220></a>        <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<a name=line-221></a>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=p>(</span><span class=n>decimal</span><span class=o>.</span><span class=n>Decimal</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>int</span><span class=p>)):</span>
<a name=line-222></a>        <span class=k>return</span> <span class=n>number_format</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<a name=line-223></a>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>):</span>
<a name=line-224></a>        <span class=n>value</span> <span class=o>=</span> <span class=n>datetime_safe</span><span class=o>.</span><span class=n>new_datetime</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<a name=line-225></a>        <span class=nb>format</span> <span class=o>=</span> <span class=n>default</span> <span class=ow>or</span> <span class=n>get_format</span><span class=p>(</span><span class=s1>&#39;DATETIME_INPUT_FORMATS&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
<a name=line-226></a>        <span class=k>return</span> <span class=n>value</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=nb>format</span><span class=p>)</span>
<a name=line-227></a>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>datetime</span><span class=o>.</span><span class=n>date</span><span class=p>):</span>
<a name=line-228></a>        <span class=n>value</span> <span class=o>=</span> <span class=n>datetime_safe</span><span class=o>.</span><span class=n>new_date</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<a name=line-229></a>        <span class=nb>format</span> <span class=o>=</span> <span class=n>default</span> <span class=ow>or</span> <span class=n>get_format</span><span class=p>(</span><span class=s1>&#39;DATE_INPUT_FORMATS&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
<a name=line-230></a>        <span class=k>return</span> <span class=n>value</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=nb>format</span><span class=p>)</span>
<a name=line-231></a>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>datetime</span><span class=o>.</span><span class=n>time</span><span class=p>):</span>
<a name=line-232></a>        <span class=nb>format</span> <span class=o>=</span> <span class=n>default</span> <span class=ow>or</span> <span class=n>get_format</span><span class=p>(</span><span class=s1>&#39;TIME_INPUT_FORMATS&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
<a name=line-233></a>        <span class=k>return</span> <span class=n>value</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=nb>format</span><span class=p>)</span>
<a name=line-234></a>    <span class=k>return</span> <span class=n>value</span>
<a name=line-235></a>
<a name=line-236></a>
<a name=line-237></a><span class=k>def</span> <span class=nf>sanitize_separators</span><span class=p>(</span><span class=n>value</span><span class=p>):</span>
<a name=line-238></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-239></a><span class=sd>    Sanitize a value according to the current decimal and</span>
<a name=line-240></a><span class=sd>    thousand separator setting. Used with form field input.</span>
<a name=line-241></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-242></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
<a name=line-243></a>        <span class=n>parts</span> <span class=o>=</span> <span class=p>[]</span>
<a name=line-244></a>        <span class=n>decimal_separator</span> <span class=o>=</span> <span class=n>get_format</span><span class=p>(</span><span class=s1>&#39;DECIMAL_SEPARATOR&#39;</span><span class=p>)</span>
<a name=line-245></a>        <span class=k>if</span> <span class=n>decimal_separator</span> <span class=ow>in</span> <span class=n>value</span><span class=p>:</span>
<a name=line-246></a>            <span class=n>value</span><span class=p>,</span> <span class=n>decimals</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>decimal_separator</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
<a name=line-247></a>            <span class=n>parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>decimals</span><span class=p>)</span>
<a name=line-248></a>        <span class=k>if</span> <span class=n>settings</span><span class=o>.</span><span class=n>USE_THOUSAND_SEPARATOR</span><span class=p>:</span>
<a name=line-249></a>            <span class=n>thousand_sep</span> <span class=o>=</span> <span class=n>get_format</span><span class=p>(</span><span class=s1>&#39;THOUSAND_SEPARATOR&#39;</span><span class=p>)</span>
<a name=line-250></a>            <span class=k>if</span> <span class=n>thousand_sep</span> <span class=o>==</span> <span class=s1>&#39;.&#39;</span> <span class=ow>and</span> <span class=n>value</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>value</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span> <span class=o>!=</span> <span class=mi>3</span><span class=p>:</span>
<a name=line-251></a>                <span class=c1># Special case where we suspect a dot meant decimal separator (see #22171)</span>
<a name=line-252></a>                <span class=k>pass</span>
<a name=line-253></a>            <span class=k>else</span><span class=p>:</span>
<a name=line-254></a>                <span class=k>for</span> <span class=n>replacement</span> <span class=ow>in</span> <span class=p>{</span>
<a name=line-255></a>                        <span class=n>thousand_sep</span><span class=p>,</span> <span class=n>unicodedata</span><span class=o>.</span><span class=n>normalize</span><span class=p>(</span><span class=s1>&#39;NFKD&#39;</span><span class=p>,</span> <span class=n>thousand_sep</span><span class=p>)}:</span>
<a name=line-256></a>                    <span class=n>value</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>replacement</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
<a name=line-257></a>        <span class=n>parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
<a name=line-258></a>        <span class=n>value</span> <span class=o>=</span> <span class=s1>&#39;.&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>reversed</span><span class=p>(</span><span class=n>parts</span><span class=p>))</span>
<a name=line-259></a>    <span class=k>return</span> <span class=n>value</span>
</pre></div></td></tr></table><p class=footer> Generated by <a href=https://github.com/spirali/nedoc>nedoc</a> v0.9 at 2020-12-29 14:05 </p></div></div></body></html>