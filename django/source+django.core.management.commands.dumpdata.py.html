<!DOCTYPE html><html><head><meta charset=utf-8><title>django.core.management.commands.dumpdata</title><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=stylesheet href=./assets/purecss/pure-min.css><link rel=stylesheet href=./assets/purecss/grids-responsive-min.css><link rel=stylesheet href=./assets/style.css><link rel=stylesheet href=./assets/pygments/default.css><link rel=stylesheet href=./assets/jquery/jquery-ui.min.css><script src=./assets/jquery/jquery-3.0.0.min.js></script><script src=./assets/jquery/jquery-ui.min.js></script><script src=nedoc.js></script></head><body><div id=layout class=pure-g><div class="sidebar pure-u-1 pure-u-md-1-4"><div class=header><h1 class=brand-title>Django</h1> 1.0 </div><div id=sbox><input id=search style="color: black;" placeholder="search ..."></div><div class=tree><ul><li><a href=django.html>&#9662; django</a> </li><li><ul><li><a href=django.__main__.html>&#9656; __main__</a> </li><li><a href=django.apps.html>&#9656; apps</a> </li><li><a href=django.bin.html>&#9656; bin</a> </li><li><a href=django.conf.html>&#9656; conf</a> </li><li><a href=django.contrib.html>&#9656; contrib</a> </li><li><a href=django.core.html>&#9662; core</a> </li><li><ul><li><a href=django.core.asgi.html>&#9656; asgi</a> </li><li><a href=django.core.cache.html>&#9656; cache</a> </li><li><a href=django.core.checks.html>&#9656; checks</a> </li><li><a href=django.core.exceptions.html>&#9656; exceptions</a> </li><li><a href=django.core.files.html>&#9656; files</a> </li><li><a href=django.core.handlers.html>&#9656; handlers</a> </li><li><a href=django.core.mail.html>&#9656; mail</a> </li><li><a href=django.core.management.html>&#9662; management</a> </li><li><ul><li><a href=django.core.management.base.html>&#9656; base</a> </li><li><a href=django.core.management.color.html>&#9656; color</a> </li><li><a href=django.core.management.commands.html>&#9662; commands</a> </li><li><ul><li><a href=django.core.management.commands.check.html>&#9656; check</a> </li><li><a href=django.core.management.commands.compilemessages.html>&#9656; compilemessages</a> </li><li><a href=django.core.management.commands.createcachetable.html>&#9656; createcachetable</a> </li><li><a href=django.core.management.commands.dbshell.html>&#9656; dbshell</a> </li><li><a href=django.core.management.commands.diffsettings.html>&#9656; diffsettings</a> </li><li><div class=select><a href=django.core.management.commands.dumpdata.html>&#9662; dumpdata</a> </div></li><li><ul><li><a href=django.core.management.commands.dumpdata.Command.html> <i>class</i> Command</a> </li><li><a href=django.core.management.commands.dumpdata.ProxyModelWarning.html> <i>class</i> ProxyModelWarning</a> </li></ul></li><li><a href=django.core.management.commands.flush.html>&#9656; flush</a> </li><li><a href=django.core.management.commands.inspectdb.html>&#9656; inspectdb</a> </li><li><a href=django.core.management.commands.loaddata.html>&#9656; loaddata</a> </li><li><a href=django.core.management.commands.makemessages.html>&#9656; makemessages</a> </li><li><a href=django.core.management.commands.makemigrations.html>&#9656; makemigrations</a> </li><li><a href=django.core.management.commands.migrate.html>&#9656; migrate</a> </li><li><a href=django.core.management.commands.runserver.html>&#9656; runserver</a> </li><li><a href=django.core.management.commands.sendtestemail.html>&#9656; sendtestemail</a> </li><li><a href=django.core.management.commands.shell.html>&#9656; shell</a> </li><li><a href=django.core.management.commands.showmigrations.html>&#9656; showmigrations</a> </li><li><a href=django.core.management.commands.sqlflush.html>&#9656; sqlflush</a> </li><li><a href=django.core.management.commands.sqlmigrate.html>&#9656; sqlmigrate</a> </li><li><a href=django.core.management.commands.sqlsequencereset.html>&#9656; sqlsequencereset</a> </li><li><a href=django.core.management.commands.squashmigrations.html>&#9656; squashmigrations</a> </li><li><a href=django.core.management.commands.startapp.html>&#9656; startapp</a> </li><li><a href=django.core.management.commands.startproject.html>&#9656; startproject</a> </li><li><a href=django.core.management.commands.test.html>&#9656; test</a> </li><li><a href=django.core.management.commands.testserver.html>&#9656; testserver</a> </li></ul></li><li><a href=django.core.management.sql.html>&#9656; sql</a> </li><li><a href=django.core.management.templates.html>&#9656; templates</a> </li><li><a href=django.core.management.utils.html>&#9656; utils</a> </li><li><a href=django.core.management.ManagementUtility.html> <i>class</i> ManagementUtility</a> </li></ul></li><li><a href=django.core.paginator.html>&#9656; paginator</a> </li><li><a href=django.core.serializers.html>&#9656; serializers</a> </li><li><a href=django.core.servers.html>&#9656; servers</a> </li><li><a href=django.core.signals.html>&#9656; signals</a> </li><li><a href=django.core.signing.html>&#9656; signing</a> </li><li><a href=django.core.validators.html>&#9656; validators</a> </li><li><a href=django.core.wsgi.html>&#9656; wsgi</a> </li></ul></li><li><a href=django.db.html>&#9656; db</a> </li><li><a href=django.dispatch.html>&#9656; dispatch</a> </li><li><a href=django.forms.html>&#9656; forms</a> </li><li><a href=django.http.html>&#9656; http</a> </li><li><a href=django.middleware.html>&#9656; middleware</a> </li><li><a href=django.shortcuts.html>&#9656; shortcuts</a> </li><li><a href=django.template.html>&#9656; template</a> </li><li><a href=django.templatetags.html>&#9656; templatetags</a> </li><li><a href=django.test.html>&#9656; test</a> </li><li><a href=django.urls.html>&#9656; urls</a> </li><li><a href=django.utils.html>&#9656; utils</a> </li><li><a href=django.views.html>&#9656; views</a> </li></ul></ul></div></div><div class="content pure-u-1 pure-u-md-3-4"><h1>Source code django/core/management/commands/dumpdata.py</h1><div id=path><a class=symbol href=django.html>django</a>.<a class=symbol href=django.core.html>core</a>.<a class=symbol href=django.core.management.html>management</a>.<a class=symbol href=django.core.management.commands.html>commands</a>.<a class=symbol href=django.core.management.commands.dumpdata.html>dumpdata</a></div><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202</pre></div></td><td class=code><div class=highlight><pre><span></span><a name=line-1></a><span class=kn>import</span> <span class=nn>warnings</span>
<a name=line-2></a>
<a name=line-3></a><span class=kn>from</span> <span class=nn>django.apps</span> <span class=kn>import</span> <span class=n>apps</span>
<a name=line-4></a><span class=kn>from</span> <span class=nn>django.core</span> <span class=kn>import</span> <span class=n>serializers</span>
<a name=line-5></a><span class=kn>from</span> <span class=nn>django.core.management.base</span> <span class=kn>import</span> <span class=n>BaseCommand</span><span class=p>,</span> <span class=n>CommandError</span>
<a name=line-6></a><span class=kn>from</span> <span class=nn>django.core.management.utils</span> <span class=kn>import</span> <span class=n>parse_apps_and_model_labels</span>
<a name=line-7></a><span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>DEFAULT_DB_ALIAS</span><span class=p>,</span> <span class=n>router</span>
<a name=line-8></a>
<a name=line-9></a>
<a name=line-10></a><span class=k>class</span> <span class=nc>ProxyModelWarning</span><span class=p>(</span><span class=ne>Warning</span><span class=p>):</span>
<a name=line-11></a>    <span class=k>pass</span>
<a name=line-12></a>
<a name=line-13></a>
<a name=line-14></a><span class=k>class</span> <span class=nc>Command</span><span class=p>(</span><span class=n>BaseCommand</span><span class=p>):</span>
<a name=line-15></a>    <span class=n>help</span> <span class=o>=</span> <span class=p>(</span>
<a name=line-16></a>        <span class=s2>&quot;Output the contents of the database as a fixture of the given format &quot;</span>
<a name=line-17></a>        <span class=s2>&quot;(using each model&#39;s default manager unless --all is specified).&quot;</span>
<a name=line-18></a>    <span class=p>)</span>
<a name=line-19></a>
<a name=line-20></a>    <span class=k>def</span> <span class=nf>add_arguments</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>parser</span><span class=p>):</span>
<a name=line-21></a>        <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span>
<a name=line-22></a>            <span class=s1>&#39;args&#39;</span><span class=p>,</span> <span class=n>metavar</span><span class=o>=</span><span class=s1>&#39;app_label[.ModelName]&#39;</span><span class=p>,</span> <span class=n>nargs</span><span class=o>=</span><span class=s1>&#39;*&#39;</span><span class=p>,</span>
<a name=line-23></a>            <span class=n>help</span><span class=o>=</span><span class=s1>&#39;Restricts dumped data to the specified app_label or app_label.ModelName.&#39;</span><span class=p>,</span>
<a name=line-24></a>        <span class=p>)</span>
<a name=line-25></a>        <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span>
<a name=line-26></a>            <span class=s1>&#39;--format&#39;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=s1>&#39;json&#39;</span><span class=p>,</span>
<a name=line-27></a>            <span class=n>help</span><span class=o>=</span><span class=s1>&#39;Specifies the output serialization format for fixtures.&#39;</span><span class=p>,</span>
<a name=line-28></a>        <span class=p>)</span>
<a name=line-29></a>        <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span>
<a name=line-30></a>            <span class=s1>&#39;--indent&#39;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>int</span><span class=p>,</span>
<a name=line-31></a>            <span class=n>help</span><span class=o>=</span><span class=s1>&#39;Specifies the indent level to use when pretty-printing output.&#39;</span><span class=p>,</span>
<a name=line-32></a>        <span class=p>)</span>
<a name=line-33></a>        <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span>
<a name=line-34></a>            <span class=s1>&#39;--database&#39;</span><span class=p>,</span>
<a name=line-35></a>            <span class=n>default</span><span class=o>=</span><span class=n>DEFAULT_DB_ALIAS</span><span class=p>,</span>
<a name=line-36></a>            <span class=n>help</span><span class=o>=</span><span class=s1>&#39;Nominates a specific database to dump fixtures from. &#39;</span>
<a name=line-37></a>                 <span class=s1>&#39;Defaults to the &quot;default&quot; database.&#39;</span><span class=p>,</span>
<a name=line-38></a>        <span class=p>)</span>
<a name=line-39></a>        <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span>
<a name=line-40></a>            <span class=s1>&#39;-e&#39;</span><span class=p>,</span> <span class=s1>&#39;--exclude&#39;</span><span class=p>,</span> <span class=n>action</span><span class=o>=</span><span class=s1>&#39;append&#39;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=p>[],</span>
<a name=line-41></a>            <span class=n>help</span><span class=o>=</span><span class=s1>&#39;An app_label or app_label.ModelName to exclude &#39;</span>
<a name=line-42></a>                 <span class=s1>&#39;(use multiple --exclude to exclude multiple apps/models).&#39;</span><span class=p>,</span>
<a name=line-43></a>        <span class=p>)</span>
<a name=line-44></a>        <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span>
<a name=line-45></a>            <span class=s1>&#39;--natural-foreign&#39;</span><span class=p>,</span> <span class=n>action</span><span class=o>=</span><span class=s1>&#39;store_true&#39;</span><span class=p>,</span> <span class=n>dest</span><span class=o>=</span><span class=s1>&#39;use_natural_foreign_keys&#39;</span><span class=p>,</span>
<a name=line-46></a>            <span class=n>help</span><span class=o>=</span><span class=s1>&#39;Use natural foreign keys if they are available.&#39;</span><span class=p>,</span>
<a name=line-47></a>        <span class=p>)</span>
<a name=line-48></a>        <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span>
<a name=line-49></a>            <span class=s1>&#39;--natural-primary&#39;</span><span class=p>,</span> <span class=n>action</span><span class=o>=</span><span class=s1>&#39;store_true&#39;</span><span class=p>,</span> <span class=n>dest</span><span class=o>=</span><span class=s1>&#39;use_natural_primary_keys&#39;</span><span class=p>,</span>
<a name=line-50></a>            <span class=n>help</span><span class=o>=</span><span class=s1>&#39;Use natural primary keys if they are available.&#39;</span><span class=p>,</span>
<a name=line-51></a>        <span class=p>)</span>
<a name=line-52></a>        <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span>
<a name=line-53></a>            <span class=s1>&#39;-a&#39;</span><span class=p>,</span> <span class=s1>&#39;--all&#39;</span><span class=p>,</span> <span class=n>action</span><span class=o>=</span><span class=s1>&#39;store_true&#39;</span><span class=p>,</span> <span class=n>dest</span><span class=o>=</span><span class=s1>&#39;use_base_manager&#39;</span><span class=p>,</span>
<a name=line-54></a>            <span class=n>help</span><span class=o>=</span><span class=s2>&quot;Use Django&#39;s base manager to dump all models stored in the database, &quot;</span>
<a name=line-55></a>                 <span class=s2>&quot;including those that would otherwise be filtered or modified by a custom manager.&quot;</span><span class=p>,</span>
<a name=line-56></a>        <span class=p>)</span>
<a name=line-57></a>        <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span>
<a name=line-58></a>            <span class=s1>&#39;--pks&#39;</span><span class=p>,</span> <span class=n>dest</span><span class=o>=</span><span class=s1>&#39;primary_keys&#39;</span><span class=p>,</span>
<a name=line-59></a>            <span class=n>help</span><span class=o>=</span><span class=s2>&quot;Only dump objects with given primary keys. Accepts a comma-separated &quot;</span>
<a name=line-60></a>                 <span class=s2>&quot;list of keys. This option only works when you specify one model.&quot;</span><span class=p>,</span>
<a name=line-61></a>        <span class=p>)</span>
<a name=line-62></a>        <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span>
<a name=line-63></a>            <span class=s1>&#39;-o&#39;</span><span class=p>,</span> <span class=s1>&#39;--output&#39;</span><span class=p>,</span>
<a name=line-64></a>            <span class=n>help</span><span class=o>=</span><span class=s1>&#39;Specifies file to which the output is written.&#39;</span>
<a name=line-65></a>        <span class=p>)</span>
<a name=line-66></a>
<a name=line-67></a>    <span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>app_labels</span><span class=p>,</span> <span class=o>**</span><span class=n>options</span><span class=p>):</span>
<a name=line-68></a>        <span class=nb>format</span> <span class=o>=</span> <span class=n>options</span><span class=p>[</span><span class=s1>&#39;format&#39;</span><span class=p>]</span>
<a name=line-69></a>        <span class=n>indent</span> <span class=o>=</span> <span class=n>options</span><span class=p>[</span><span class=s1>&#39;indent&#39;</span><span class=p>]</span>
<a name=line-70></a>        <span class=n>using</span> <span class=o>=</span> <span class=n>options</span><span class=p>[</span><span class=s1>&#39;database&#39;</span><span class=p>]</span>
<a name=line-71></a>        <span class=n>excludes</span> <span class=o>=</span> <span class=n>options</span><span class=p>[</span><span class=s1>&#39;exclude&#39;</span><span class=p>]</span>
<a name=line-72></a>        <span class=n>output</span> <span class=o>=</span> <span class=n>options</span><span class=p>[</span><span class=s1>&#39;output&#39;</span><span class=p>]</span>
<a name=line-73></a>        <span class=n>show_traceback</span> <span class=o>=</span> <span class=n>options</span><span class=p>[</span><span class=s1>&#39;traceback&#39;</span><span class=p>]</span>
<a name=line-74></a>        <span class=n>use_natural_foreign_keys</span> <span class=o>=</span> <span class=n>options</span><span class=p>[</span><span class=s1>&#39;use_natural_foreign_keys&#39;</span><span class=p>]</span>
<a name=line-75></a>        <span class=n>use_natural_primary_keys</span> <span class=o>=</span> <span class=n>options</span><span class=p>[</span><span class=s1>&#39;use_natural_primary_keys&#39;</span><span class=p>]</span>
<a name=line-76></a>        <span class=n>use_base_manager</span> <span class=o>=</span> <span class=n>options</span><span class=p>[</span><span class=s1>&#39;use_base_manager&#39;</span><span class=p>]</span>
<a name=line-77></a>        <span class=n>pks</span> <span class=o>=</span> <span class=n>options</span><span class=p>[</span><span class=s1>&#39;primary_keys&#39;</span><span class=p>]</span>
<a name=line-78></a>
<a name=line-79></a>        <span class=k>if</span> <span class=n>pks</span><span class=p>:</span>
<a name=line-80></a>            <span class=n>primary_keys</span> <span class=o>=</span> <span class=p>[</span><span class=n>pk</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=k>for</span> <span class=n>pk</span> <span class=ow>in</span> <span class=n>pks</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)]</span>
<a name=line-81></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-82></a>            <span class=n>primary_keys</span> <span class=o>=</span> <span class=p>[]</span>
<a name=line-83></a>
<a name=line-84></a>        <span class=n>excluded_models</span><span class=p>,</span> <span class=n>excluded_apps</span> <span class=o>=</span> <span class=n>parse_apps_and_model_labels</span><span class=p>(</span><span class=n>excludes</span><span class=p>)</span>
<a name=line-85></a>
<a name=line-86></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>app_labels</span><span class=p>:</span>
<a name=line-87></a>            <span class=k>if</span> <span class=n>primary_keys</span><span class=p>:</span>
<a name=line-88></a>                <span class=k>raise</span> <span class=n>CommandError</span><span class=p>(</span><span class=s2>&quot;You can only use --pks option with one model&quot;</span><span class=p>)</span>
<a name=line-89></a>            <span class=n>app_list</span> <span class=o>=</span> <span class=nb>dict</span><span class=o>.</span><span class=n>fromkeys</span><span class=p>(</span>
<a name=line-90></a>                <span class=n>app_config</span> <span class=k>for</span> <span class=n>app_config</span> <span class=ow>in</span> <span class=n>apps</span><span class=o>.</span><span class=n>get_app_configs</span><span class=p>()</span>
<a name=line-91></a>                <span class=k>if</span> <span class=n>app_config</span><span class=o>.</span><span class=n>models_module</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>app_config</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>excluded_apps</span>
<a name=line-92></a>            <span class=p>)</span>
<a name=line-93></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-94></a>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>app_labels</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=ow>and</span> <span class=n>primary_keys</span><span class=p>:</span>
<a name=line-95></a>                <span class=k>raise</span> <span class=n>CommandError</span><span class=p>(</span><span class=s2>&quot;You can only use --pks option with one model&quot;</span><span class=p>)</span>
<a name=line-96></a>            <span class=n>app_list</span> <span class=o>=</span> <span class=p>{}</span>
<a name=line-97></a>            <span class=k>for</span> <span class=n>label</span> <span class=ow>in</span> <span class=n>app_labels</span><span class=p>:</span>
<a name=line-98></a>                <span class=k>try</span><span class=p>:</span>
<a name=line-99></a>                    <span class=n>app_label</span><span class=p>,</span> <span class=n>model_label</span> <span class=o>=</span> <span class=n>label</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)</span>
<a name=line-100></a>                    <span class=k>try</span><span class=p>:</span>
<a name=line-101></a>                        <span class=n>app_config</span> <span class=o>=</span> <span class=n>apps</span><span class=o>.</span><span class=n>get_app_config</span><span class=p>(</span><span class=n>app_label</span><span class=p>)</span>
<a name=line-102></a>                    <span class=k>except</span> <span class=ne>LookupError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a name=line-103></a>                        <span class=k>raise</span> <span class=n>CommandError</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
<a name=line-104></a>                    <span class=k>if</span> <span class=n>app_config</span><span class=o>.</span><span class=n>models_module</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>app_config</span> <span class=ow>in</span> <span class=n>excluded_apps</span><span class=p>:</span>
<a name=line-105></a>                        <span class=k>continue</span>
<a name=line-106></a>                    <span class=k>try</span><span class=p>:</span>
<a name=line-107></a>                        <span class=n>model</span> <span class=o>=</span> <span class=n>app_config</span><span class=o>.</span><span class=n>get_model</span><span class=p>(</span><span class=n>model_label</span><span class=p>)</span>
<a name=line-108></a>                    <span class=k>except</span> <span class=ne>LookupError</span><span class=p>:</span>
<a name=line-109></a>                        <span class=k>raise</span> <span class=n>CommandError</span><span class=p>(</span><span class=s2>&quot;Unknown model: </span><span class=si>%s</span><span class=s2>.</span><span class=si>%s</span><span class=s2>&quot;</span> <span class=o>%</span> <span class=p>(</span><span class=n>app_label</span><span class=p>,</span> <span class=n>model_label</span><span class=p>))</span>
<a name=line-110></a>
<a name=line-111></a>                    <span class=n>app_list_value</span> <span class=o>=</span> <span class=n>app_list</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=n>app_config</span><span class=p>,</span> <span class=p>[])</span>
<a name=line-112></a>
<a name=line-113></a>                    <span class=c1># We may have previously seen an &quot;all-models&quot; request for</span>
<a name=line-114></a>                    <span class=c1># this app (no model qualifier was given). In this case</span>
<a name=line-115></a>                    <span class=c1># there is no need adding specific models to the list.</span>
<a name=line-116></a>                    <span class=k>if</span> <span class=n>app_list_value</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>model</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>app_list_value</span><span class=p>:</span>
<a name=line-117></a>                        <span class=n>app_list_value</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
<a name=line-118></a>                <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
<a name=line-119></a>                    <span class=k>if</span> <span class=n>primary_keys</span><span class=p>:</span>
<a name=line-120></a>                        <span class=k>raise</span> <span class=n>CommandError</span><span class=p>(</span><span class=s2>&quot;You can only use --pks option with one model&quot;</span><span class=p>)</span>
<a name=line-121></a>                    <span class=c1># This is just an app - no model qualifier</span>
<a name=line-122></a>                    <span class=n>app_label</span> <span class=o>=</span> <span class=n>label</span>
<a name=line-123></a>                    <span class=k>try</span><span class=p>:</span>
<a name=line-124></a>                        <span class=n>app_config</span> <span class=o>=</span> <span class=n>apps</span><span class=o>.</span><span class=n>get_app_config</span><span class=p>(</span><span class=n>app_label</span><span class=p>)</span>
<a name=line-125></a>                    <span class=k>except</span> <span class=ne>LookupError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a name=line-126></a>                        <span class=k>raise</span> <span class=n>CommandError</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
<a name=line-127></a>                    <span class=k>if</span> <span class=n>app_config</span><span class=o>.</span><span class=n>models_module</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>app_config</span> <span class=ow>in</span> <span class=n>excluded_apps</span><span class=p>:</span>
<a name=line-128></a>                        <span class=k>continue</span>
<a name=line-129></a>                    <span class=n>app_list</span><span class=p>[</span><span class=n>app_config</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<a name=line-130></a>
<a name=line-131></a>        <span class=c1># Check that the serialization format exists; this is a shortcut to</span>
<a name=line-132></a>        <span class=c1># avoid collating all the objects and _then_ failing.</span>
<a name=line-133></a>        <span class=k>if</span> <span class=nb>format</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>serializers</span><span class=o>.</span><span class=n>get_public_serializer_formats</span><span class=p>():</span>
<a name=line-134></a>            <span class=k>try</span><span class=p>:</span>
<a name=line-135></a>                <span class=n>serializers</span><span class=o>.</span><span class=n>get_serializer</span><span class=p>(</span><span class=nb>format</span><span class=p>)</span>
<a name=line-136></a>            <span class=k>except</span> <span class=n>serializers</span><span class=o>.</span><span class=n>SerializerDoesNotExist</span><span class=p>:</span>
<a name=line-137></a>                <span class=k>pass</span>
<a name=line-138></a>
<a name=line-139></a>            <span class=k>raise</span> <span class=n>CommandError</span><span class=p>(</span><span class=s2>&quot;Unknown serialization format: </span><span class=si>%s</span><span class=s2>&quot;</span> <span class=o>%</span> <span class=nb>format</span><span class=p>)</span>
<a name=line-140></a>
<a name=line-141></a>        <span class=k>def</span> <span class=nf>get_objects</span><span class=p>(</span><span class=n>count_only</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
<a name=line-142></a>            <span class=sd>&quot;&quot;&quot;</span>
<a name=line-143></a><span class=sd>            Collate the objects to be serialized. If count_only is True, just</span>
<a name=line-144></a><span class=sd>            count the number of objects to be serialized.</span>
<a name=line-145></a><span class=sd>            &quot;&quot;&quot;</span>
<a name=line-146></a>            <span class=k>if</span> <span class=n>use_natural_foreign_keys</span><span class=p>:</span>
<a name=line-147></a>                <span class=n>models</span> <span class=o>=</span> <span class=n>serializers</span><span class=o>.</span><span class=n>sort_dependencies</span><span class=p>(</span><span class=n>app_list</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span> <span class=n>allow_cycles</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<a name=line-148></a>            <span class=k>else</span><span class=p>:</span>
<a name=line-149></a>                <span class=c1># There is no need to sort dependencies when natural foreign</span>
<a name=line-150></a>                <span class=c1># keys are not used.</span>
<a name=line-151></a>                <span class=n>models</span> <span class=o>=</span> <span class=p>[]</span>
<a name=line-152></a>                <span class=k>for</span> <span class=p>(</span><span class=n>app_config</span><span class=p>,</span> <span class=n>model_list</span><span class=p>)</span> <span class=ow>in</span> <span class=n>app_list</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a name=line-153></a>                    <span class=k>if</span> <span class=n>model_list</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-154></a>                        <span class=n>models</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>app_config</span><span class=o>.</span><span class=n>get_models</span><span class=p>())</span>
<a name=line-155></a>                    <span class=k>else</span><span class=p>:</span>
<a name=line-156></a>                        <span class=n>models</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>model_list</span><span class=p>)</span>
<a name=line-157></a>            <span class=k>for</span> <span class=n>model</span> <span class=ow>in</span> <span class=n>models</span><span class=p>:</span>
<a name=line-158></a>                <span class=k>if</span> <span class=n>model</span> <span class=ow>in</span> <span class=n>excluded_models</span><span class=p>:</span>
<a name=line-159></a>                    <span class=k>continue</span>
<a name=line-160></a>                <span class=k>if</span> <span class=n>model</span><span class=o>.</span><span class=n>_meta</span><span class=o>.</span><span class=n>proxy</span> <span class=ow>and</span> <span class=n>model</span><span class=o>.</span><span class=n>_meta</span><span class=o>.</span><span class=n>proxy_for_model</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>models</span><span class=p>:</span>
<a name=line-161></a>                    <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span>
<a name=line-162></a>                        <span class=s2>&quot;</span><span class=si>%s</span><span class=s2> is a proxy model and won&#39;t be serialized.&quot;</span> <span class=o>%</span> <span class=n>model</span><span class=o>.</span><span class=n>_meta</span><span class=o>.</span><span class=n>label</span><span class=p>,</span>
<a name=line-163></a>                        <span class=n>category</span><span class=o>=</span><span class=n>ProxyModelWarning</span><span class=p>,</span>
<a name=line-164></a>                    <span class=p>)</span>
<a name=line-165></a>                <span class=k>if</span> <span class=ow>not</span> <span class=n>model</span><span class=o>.</span><span class=n>_meta</span><span class=o>.</span><span class=n>proxy</span> <span class=ow>and</span> <span class=n>router</span><span class=o>.</span><span class=n>allow_migrate_model</span><span class=p>(</span><span class=n>using</span><span class=p>,</span> <span class=n>model</span><span class=p>):</span>
<a name=line-166></a>                    <span class=k>if</span> <span class=n>use_base_manager</span><span class=p>:</span>
<a name=line-167></a>                        <span class=n>objects</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>_base_manager</span>
<a name=line-168></a>                    <span class=k>else</span><span class=p>:</span>
<a name=line-169></a>                        <span class=n>objects</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>_default_manager</span>
<a name=line-170></a>
<a name=line-171></a>                    <span class=n>queryset</span> <span class=o>=</span> <span class=n>objects</span><span class=o>.</span><span class=n>using</span><span class=p>(</span><span class=n>using</span><span class=p>)</span><span class=o>.</span><span class=n>order_by</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>_meta</span><span class=o>.</span><span class=n>pk</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
<a name=line-172></a>                    <span class=k>if</span> <span class=n>primary_keys</span><span class=p>:</span>
<a name=line-173></a>                        <span class=n>queryset</span> <span class=o>=</span> <span class=n>queryset</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>pk__in</span><span class=o>=</span><span class=n>primary_keys</span><span class=p>)</span>
<a name=line-174></a>                    <span class=k>if</span> <span class=n>count_only</span><span class=p>:</span>
<a name=line-175></a>                        <span class=k>yield</span> <span class=n>queryset</span><span class=o>.</span><span class=n>order_by</span><span class=p>()</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
<a name=line-176></a>                    <span class=k>else</span><span class=p>:</span>
<a name=line-177></a>                        <span class=k>yield from</span> <span class=n>queryset</span><span class=o>.</span><span class=n>iterator</span><span class=p>()</span>
<a name=line-178></a>
<a name=line-179></a>        <span class=k>try</span><span class=p>:</span>
<a name=line-180></a>            <span class=bp>self</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>ending</span> <span class=o>=</span> <span class=kc>None</span>
<a name=line-181></a>            <span class=n>progress_output</span> <span class=o>=</span> <span class=kc>None</span>
<a name=line-182></a>            <span class=n>object_count</span> <span class=o>=</span> <span class=mi>0</span>
<a name=line-183></a>            <span class=c1># If dumpdata is outputting to stdout, there is no way to display progress</span>
<a name=line-184></a>            <span class=k>if</span> <span class=n>output</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>isatty</span><span class=p>()</span> <span class=ow>and</span> <span class=n>options</span><span class=p>[</span><span class=s1>&#39;verbosity&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
<a name=line-185></a>                <span class=n>progress_output</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>stdout</span>
<a name=line-186></a>                <span class=n>object_count</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=n>get_objects</span><span class=p>(</span><span class=n>count_only</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
<a name=line-187></a>            <span class=n>stream</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=n>output</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>)</span> <span class=k>if</span> <span class=n>output</span> <span class=k>else</span> <span class=kc>None</span>
<a name=line-188></a>            <span class=k>try</span><span class=p>:</span>
<a name=line-189></a>                <span class=n>serializers</span><span class=o>.</span><span class=n>serialize</span><span class=p>(</span>
<a name=line-190></a>                    <span class=nb>format</span><span class=p>,</span> <span class=n>get_objects</span><span class=p>(),</span> <span class=n>indent</span><span class=o>=</span><span class=n>indent</span><span class=p>,</span>
<a name=line-191></a>                    <span class=n>use_natural_foreign_keys</span><span class=o>=</span><span class=n>use_natural_foreign_keys</span><span class=p>,</span>
<a name=line-192></a>                    <span class=n>use_natural_primary_keys</span><span class=o>=</span><span class=n>use_natural_primary_keys</span><span class=p>,</span>
<a name=line-193></a>                    <span class=n>stream</span><span class=o>=</span><span class=n>stream</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>stdout</span><span class=p>,</span> <span class=n>progress_output</span><span class=o>=</span><span class=n>progress_output</span><span class=p>,</span>
<a name=line-194></a>                    <span class=n>object_count</span><span class=o>=</span><span class=n>object_count</span><span class=p>,</span>
<a name=line-195></a>                <span class=p>)</span>
<a name=line-196></a>            <span class=k>finally</span><span class=p>:</span>
<a name=line-197></a>                <span class=k>if</span> <span class=n>stream</span><span class=p>:</span>
<a name=line-198></a>                    <span class=n>stream</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
<a name=line-199></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a name=line-200></a>            <span class=k>if</span> <span class=n>show_traceback</span><span class=p>:</span>
<a name=line-201></a>                <span class=k>raise</span>
<a name=line-202></a>            <span class=k>raise</span> <span class=n>CommandError</span><span class=p>(</span><span class=s2>&quot;Unable to serialize database: </span><span class=si>%s</span><span class=s2>&quot;</span> <span class=o>%</span> <span class=n>e</span><span class=p>)</span>
</pre></div></td></tr></table><p class=footer> Generated by <a href=https://github.com/spirali/nedoc>nedoc</a> v0.9 at 2020-12-29 14:04 </p></div></div></body></html>