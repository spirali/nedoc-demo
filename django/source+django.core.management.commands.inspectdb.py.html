<!DOCTYPE html><html><head><meta charset=utf-8><title>django.core.management.commands.inspectdb</title><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=stylesheet href=./assets/purecss/pure-min.css><link rel=stylesheet href=./assets/purecss/grids-responsive-min.css><link rel=stylesheet href=./assets/style.css><link rel=stylesheet href=./assets/pygments/default.css><link rel=stylesheet href=./assets/jquery/jquery-ui.min.css><script src=./assets/jquery/jquery-3.0.0.min.js></script><script src=./assets/jquery/jquery-ui.min.js></script><script src=nedoc.js></script></head><body><div id=layout class=pure-g><div class="sidebar pure-u-1 pure-u-md-1-4"><div class=header><h1 class=brand-title>Django</h1> 1.0 </div><div id=sbox><input id=search style="color: black;" placeholder="search ..."></div><div class=tree><ul><li><a href=django.html>&#9662; django</a> </li><li><ul><li><a href=django.__main__.html>&#9656; __main__</a> </li><li><a href=django.apps.html>&#9656; apps</a> </li><li><a href=django.bin.html>&#9656; bin</a> </li><li><a href=django.conf.html>&#9656; conf</a> </li><li><a href=django.contrib.html>&#9656; contrib</a> </li><li><a href=django.core.html>&#9662; core</a> </li><li><ul><li><a href=django.core.asgi.html>&#9656; asgi</a> </li><li><a href=django.core.cache.html>&#9656; cache</a> </li><li><a href=django.core.checks.html>&#9656; checks</a> </li><li><a href=django.core.exceptions.html>&#9656; exceptions</a> </li><li><a href=django.core.files.html>&#9656; files</a> </li><li><a href=django.core.handlers.html>&#9656; handlers</a> </li><li><a href=django.core.mail.html>&#9656; mail</a> </li><li><a href=django.core.management.html>&#9662; management</a> </li><li><ul><li><a href=django.core.management.base.html>&#9656; base</a> </li><li><a href=django.core.management.color.html>&#9656; color</a> </li><li><a href=django.core.management.commands.html>&#9662; commands</a> </li><li><ul><li><a href=django.core.management.commands.check.html>&#9656; check</a> </li><li><a href=django.core.management.commands.compilemessages.html>&#9656; compilemessages</a> </li><li><a href=django.core.management.commands.createcachetable.html>&#9656; createcachetable</a> </li><li><a href=django.core.management.commands.dbshell.html>&#9656; dbshell</a> </li><li><a href=django.core.management.commands.diffsettings.html>&#9656; diffsettings</a> </li><li><a href=django.core.management.commands.dumpdata.html>&#9656; dumpdata</a> </li><li><a href=django.core.management.commands.flush.html>&#9656; flush</a> </li><li><div class=select><a href=django.core.management.commands.inspectdb.html>&#9662; inspectdb</a> </div></li><li><ul><li><a href=django.core.management.commands.inspectdb.Command.html> <i>class</i> Command</a> </li></ul></li><li><a href=django.core.management.commands.loaddata.html>&#9656; loaddata</a> </li><li><a href=django.core.management.commands.makemessages.html>&#9656; makemessages</a> </li><li><a href=django.core.management.commands.makemigrations.html>&#9656; makemigrations</a> </li><li><a href=django.core.management.commands.migrate.html>&#9656; migrate</a> </li><li><a href=django.core.management.commands.runserver.html>&#9656; runserver</a> </li><li><a href=django.core.management.commands.sendtestemail.html>&#9656; sendtestemail</a> </li><li><a href=django.core.management.commands.shell.html>&#9656; shell</a> </li><li><a href=django.core.management.commands.showmigrations.html>&#9656; showmigrations</a> </li><li><a href=django.core.management.commands.sqlflush.html>&#9656; sqlflush</a> </li><li><a href=django.core.management.commands.sqlmigrate.html>&#9656; sqlmigrate</a> </li><li><a href=django.core.management.commands.sqlsequencereset.html>&#9656; sqlsequencereset</a> </li><li><a href=django.core.management.commands.squashmigrations.html>&#9656; squashmigrations</a> </li><li><a href=django.core.management.commands.startapp.html>&#9656; startapp</a> </li><li><a href=django.core.management.commands.startproject.html>&#9656; startproject</a> </li><li><a href=django.core.management.commands.test.html>&#9656; test</a> </li><li><a href=django.core.management.commands.testserver.html>&#9656; testserver</a> </li></ul></li><li><a href=django.core.management.sql.html>&#9656; sql</a> </li><li><a href=django.core.management.templates.html>&#9656; templates</a> </li><li><a href=django.core.management.utils.html>&#9656; utils</a> </li><li><a href=django.core.management.ManagementUtility.html> <i>class</i> ManagementUtility</a> </li></ul></li><li><a href=django.core.paginator.html>&#9656; paginator</a> </li><li><a href=django.core.serializers.html>&#9656; serializers</a> </li><li><a href=django.core.servers.html>&#9656; servers</a> </li><li><a href=django.core.signals.html>&#9656; signals</a> </li><li><a href=django.core.signing.html>&#9656; signing</a> </li><li><a href=django.core.validators.html>&#9656; validators</a> </li><li><a href=django.core.wsgi.html>&#9656; wsgi</a> </li></ul></li><li><a href=django.db.html>&#9656; db</a> </li><li><a href=django.dispatch.html>&#9656; dispatch</a> </li><li><a href=django.forms.html>&#9656; forms</a> </li><li><a href=django.http.html>&#9656; http</a> </li><li><a href=django.middleware.html>&#9656; middleware</a> </li><li><a href=django.shortcuts.html>&#9656; shortcuts</a> </li><li><a href=django.template.html>&#9656; template</a> </li><li><a href=django.templatetags.html>&#9656; templatetags</a> </li><li><a href=django.test.html>&#9656; test</a> </li><li><a href=django.urls.html>&#9656; urls</a> </li><li><a href=django.utils.html>&#9656; utils</a> </li><li><a href=django.views.html>&#9656; views</a> </li></ul></ul></div></div><div class="content pure-u-1 pure-u-md-3-4"><h1>Source code django/core/management/commands/inspectdb.py</h1><div id=path><a class=symbol href=django.html>django</a>.<a class=symbol href=django.core.html>core</a>.<a class=symbol href=django.core.management.html>management</a>.<a class=symbol href=django.core.management.commands.html>commands</a>.<a class=symbol href=django.core.management.commands.inspectdb.html>inspectdb</a></div><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299</pre></div></td><td class=code><div class=highlight><pre><span></span><a name=line-1></a><span class=kn>import</span> <span class=nn>keyword</span>
<a name=line-2></a><span class=kn>import</span> <span class=nn>re</span>
<a name=line-3></a>
<a name=line-4></a><span class=kn>from</span> <span class=nn>django.core.management.base</span> <span class=kn>import</span> <span class=n>BaseCommand</span><span class=p>,</span> <span class=n>CommandError</span>
<a name=line-5></a><span class=kn>from</span> <span class=nn>django.db</span> <span class=kn>import</span> <span class=n>DEFAULT_DB_ALIAS</span><span class=p>,</span> <span class=n>connections</span>
<a name=line-6></a><span class=kn>from</span> <span class=nn>django.db.models.constants</span> <span class=kn>import</span> <span class=n>LOOKUP_SEP</span>
<a name=line-7></a>
<a name=line-8></a>
<a name=line-9></a><span class=k>class</span> <span class=nc>Command</span><span class=p>(</span><span class=n>BaseCommand</span><span class=p>):</span>
<a name=line-10></a>    <span class=n>help</span> <span class=o>=</span> <span class=s2>&quot;Introspects the database tables in the given database and outputs a Django model module.&quot;</span>
<a name=line-11></a>    <span class=n>requires_system_checks</span> <span class=o>=</span> <span class=p>[]</span>
<a name=line-12></a>    <span class=n>stealth_options</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;table_name_filter&#39;</span><span class=p>,)</span>
<a name=line-13></a>    <span class=n>db_module</span> <span class=o>=</span> <span class=s1>&#39;django.db&#39;</span>
<a name=line-14></a>
<a name=line-15></a>    <span class=k>def</span> <span class=nf>add_arguments</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>parser</span><span class=p>):</span>
<a name=line-16></a>        <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span>
<a name=line-17></a>            <span class=s1>&#39;table&#39;</span><span class=p>,</span> <span class=n>nargs</span><span class=o>=</span><span class=s1>&#39;*&#39;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span>
<a name=line-18></a>            <span class=n>help</span><span class=o>=</span><span class=s1>&#39;Selects what tables or views should be introspected.&#39;</span><span class=p>,</span>
<a name=line-19></a>        <span class=p>)</span>
<a name=line-20></a>        <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span>
<a name=line-21></a>            <span class=s1>&#39;--database&#39;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=n>DEFAULT_DB_ALIAS</span><span class=p>,</span>
<a name=line-22></a>            <span class=n>help</span><span class=o>=</span><span class=s1>&#39;Nominates a database to introspect. Defaults to using the &quot;default&quot; database.&#39;</span><span class=p>,</span>
<a name=line-23></a>        <span class=p>)</span>
<a name=line-24></a>        <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span>
<a name=line-25></a>            <span class=s1>&#39;--include-partitions&#39;</span><span class=p>,</span> <span class=n>action</span><span class=o>=</span><span class=s1>&#39;store_true&#39;</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s1>&#39;Also output models for partition tables.&#39;</span><span class=p>,</span>
<a name=line-26></a>        <span class=p>)</span>
<a name=line-27></a>        <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span>
<a name=line-28></a>            <span class=s1>&#39;--include-views&#39;</span><span class=p>,</span> <span class=n>action</span><span class=o>=</span><span class=s1>&#39;store_true&#39;</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s1>&#39;Also output models for database views.&#39;</span><span class=p>,</span>
<a name=line-29></a>        <span class=p>)</span>
<a name=line-30></a>
<a name=line-31></a>    <span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>**</span><span class=n>options</span><span class=p>):</span>
<a name=line-32></a>        <span class=k>try</span><span class=p>:</span>
<a name=line-33></a>            <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>handle_inspection</span><span class=p>(</span><span class=n>options</span><span class=p>):</span>
<a name=line-34></a>                <span class=bp>self</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
<a name=line-35></a>        <span class=k>except</span> <span class=ne>NotImplementedError</span><span class=p>:</span>
<a name=line-36></a>            <span class=k>raise</span> <span class=n>CommandError</span><span class=p>(</span><span class=s2>&quot;Database inspection isn&#39;t supported for the currently selected database backend.&quot;</span><span class=p>)</span>
<a name=line-37></a>
<a name=line-38></a>    <span class=k>def</span> <span class=nf>handle_inspection</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>options</span><span class=p>):</span>
<a name=line-39></a>        <span class=n>connection</span> <span class=o>=</span> <span class=n>connections</span><span class=p>[</span><span class=n>options</span><span class=p>[</span><span class=s1>&#39;database&#39;</span><span class=p>]]</span>
<a name=line-40></a>        <span class=c1># &#39;table_name_filter&#39; is a stealth option</span>
<a name=line-41></a>        <span class=n>table_name_filter</span> <span class=o>=</span> <span class=n>options</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;table_name_filter&#39;</span><span class=p>)</span>
<a name=line-42></a>
<a name=line-43></a>        <span class=k>def</span> <span class=nf>table2model</span><span class=p>(</span><span class=n>table_name</span><span class=p>):</span>
<a name=line-44></a>            <span class=k>return</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;[^a-zA-Z0-9]&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>table_name</span><span class=o>.</span><span class=n>title</span><span class=p>())</span>
<a name=line-45></a>
<a name=line-46></a>        <span class=k>with</span> <span class=n>connection</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span> <span class=k>as</span> <span class=n>cursor</span><span class=p>:</span>
<a name=line-47></a>            <span class=k>yield</span> <span class=s2>&quot;# This is an auto-generated Django model module.&quot;</span>
<a name=line-48></a>            <span class=k>yield</span> <span class=s2>&quot;# You&#39;ll have to do the following manually to clean this up:&quot;</span>
<a name=line-49></a>            <span class=k>yield</span> <span class=s2>&quot;#   * Rearrange models&#39; order&quot;</span>
<a name=line-50></a>            <span class=k>yield</span> <span class=s2>&quot;#   * Make sure each model has one field with primary_key=True&quot;</span>
<a name=line-51></a>            <span class=k>yield</span> <span class=s2>&quot;#   * Make sure each ForeignKey and OneToOneField has `on_delete` set to the desired behavior&quot;</span>
<a name=line-52></a>            <span class=k>yield</span> <span class=p>(</span>
<a name=line-53></a>                <span class=s2>&quot;#   * Remove `managed = False` lines if you wish to allow &quot;</span>
<a name=line-54></a>                <span class=s2>&quot;Django to create, modify, and delete the table&quot;</span>
<a name=line-55></a>            <span class=p>)</span>
<a name=line-56></a>            <span class=k>yield</span> <span class=s2>&quot;# Feel free to rename the models, but don&#39;t rename db_table values or field names.&quot;</span>
<a name=line-57></a>            <span class=k>yield</span> <span class=s1>&#39;from </span><span class=si>%s</span><span class=s1> import models&#39;</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_module</span>
<a name=line-58></a>            <span class=n>known_models</span> <span class=o>=</span> <span class=p>[]</span>
<a name=line-59></a>            <span class=n>table_info</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>introspection</span><span class=o>.</span><span class=n>get_table_list</span><span class=p>(</span><span class=n>cursor</span><span class=p>)</span>
<a name=line-60></a>
<a name=line-61></a>            <span class=c1># Determine types of tables and/or views to be introspected.</span>
<a name=line-62></a>            <span class=n>types</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;t&#39;</span><span class=p>}</span>
<a name=line-63></a>            <span class=k>if</span> <span class=n>options</span><span class=p>[</span><span class=s1>&#39;include_partitions&#39;</span><span class=p>]:</span>
<a name=line-64></a>                <span class=n>types</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s1>&#39;p&#39;</span><span class=p>)</span>
<a name=line-65></a>            <span class=k>if</span> <span class=n>options</span><span class=p>[</span><span class=s1>&#39;include_views&#39;</span><span class=p>]:</span>
<a name=line-66></a>                <span class=n>types</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s1>&#39;v&#39;</span><span class=p>)</span>
<a name=line-67></a>
<a name=line-68></a>            <span class=k>for</span> <span class=n>table_name</span> <span class=ow>in</span> <span class=p>(</span><span class=n>options</span><span class=p>[</span><span class=s1>&#39;table&#39;</span><span class=p>]</span> <span class=ow>or</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>info</span><span class=o>.</span><span class=n>name</span> <span class=k>for</span> <span class=n>info</span> <span class=ow>in</span> <span class=n>table_info</span> <span class=k>if</span> <span class=n>info</span><span class=o>.</span><span class=n>type</span> <span class=ow>in</span> <span class=n>types</span><span class=p>)):</span>
<a name=line-69></a>                <span class=k>if</span> <span class=n>table_name_filter</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>callable</span><span class=p>(</span><span class=n>table_name_filter</span><span class=p>):</span>
<a name=line-70></a>                    <span class=k>if</span> <span class=ow>not</span> <span class=n>table_name_filter</span><span class=p>(</span><span class=n>table_name</span><span class=p>):</span>
<a name=line-71></a>                        <span class=k>continue</span>
<a name=line-72></a>                <span class=k>try</span><span class=p>:</span>
<a name=line-73></a>                    <span class=k>try</span><span class=p>:</span>
<a name=line-74></a>                        <span class=n>relations</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>introspection</span><span class=o>.</span><span class=n>get_relations</span><span class=p>(</span><span class=n>cursor</span><span class=p>,</span> <span class=n>table_name</span><span class=p>)</span>
<a name=line-75></a>                    <span class=k>except</span> <span class=ne>NotImplementedError</span><span class=p>:</span>
<a name=line-76></a>                        <span class=n>relations</span> <span class=o>=</span> <span class=p>{}</span>
<a name=line-77></a>                    <span class=k>try</span><span class=p>:</span>
<a name=line-78></a>                        <span class=n>constraints</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>introspection</span><span class=o>.</span><span class=n>get_constraints</span><span class=p>(</span><span class=n>cursor</span><span class=p>,</span> <span class=n>table_name</span><span class=p>)</span>
<a name=line-79></a>                    <span class=k>except</span> <span class=ne>NotImplementedError</span><span class=p>:</span>
<a name=line-80></a>                        <span class=n>constraints</span> <span class=o>=</span> <span class=p>{}</span>
<a name=line-81></a>                    <span class=n>primary_key_column</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>introspection</span><span class=o>.</span><span class=n>get_primary_key_column</span><span class=p>(</span><span class=n>cursor</span><span class=p>,</span> <span class=n>table_name</span><span class=p>)</span>
<a name=line-82></a>                    <span class=n>unique_columns</span> <span class=o>=</span> <span class=p>[</span>
<a name=line-83></a>                        <span class=n>c</span><span class=p>[</span><span class=s1>&#39;columns&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>constraints</span><span class=o>.</span><span class=n>values</span><span class=p>()</span>
<a name=line-84></a>                        <span class=k>if</span> <span class=n>c</span><span class=p>[</span><span class=s1>&#39;unique&#39;</span><span class=p>]</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=s1>&#39;columns&#39;</span><span class=p>])</span> <span class=o>==</span> <span class=mi>1</span>
<a name=line-85></a>                    <span class=p>]</span>
<a name=line-86></a>                    <span class=n>table_description</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>introspection</span><span class=o>.</span><span class=n>get_table_description</span><span class=p>(</span><span class=n>cursor</span><span class=p>,</span> <span class=n>table_name</span><span class=p>)</span>
<a name=line-87></a>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a name=line-88></a>                    <span class=k>yield</span> <span class=s2>&quot;# Unable to inspect table &#39;</span><span class=si>%s</span><span class=s2>&#39;&quot;</span> <span class=o>%</span> <span class=n>table_name</span>
<a name=line-89></a>                    <span class=k>yield</span> <span class=s2>&quot;# The error was: </span><span class=si>%s</span><span class=s2>&quot;</span> <span class=o>%</span> <span class=n>e</span>
<a name=line-90></a>                    <span class=k>continue</span>
<a name=line-91></a>
<a name=line-92></a>                <span class=k>yield</span> <span class=s1>&#39;&#39;</span>
<a name=line-93></a>                <span class=k>yield</span> <span class=s1>&#39;&#39;</span>
<a name=line-94></a>                <span class=k>yield</span> <span class=s1>&#39;class </span><span class=si>%s</span><span class=s1>(models.Model):&#39;</span> <span class=o>%</span> <span class=n>table2model</span><span class=p>(</span><span class=n>table_name</span><span class=p>)</span>
<a name=line-95></a>                <span class=n>known_models</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>table2model</span><span class=p>(</span><span class=n>table_name</span><span class=p>))</span>
<a name=line-96></a>                <span class=n>used_column_names</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># Holds column names used in the table so far</span>
<a name=line-97></a>                <span class=n>column_to_field_name</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># Maps column names to names of model fields</span>
<a name=line-98></a>                <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>table_description</span><span class=p>:</span>
<a name=line-99></a>                    <span class=n>comment_notes</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># Holds Field notes, to be displayed in a Python comment.</span>
<a name=line-100></a>                    <span class=n>extra_params</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># Holds Field parameters such as &#39;db_column&#39;.</span>
<a name=line-101></a>                    <span class=n>column_name</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>name</span>
<a name=line-102></a>                    <span class=n>is_relation</span> <span class=o>=</span> <span class=n>column_name</span> <span class=ow>in</span> <span class=n>relations</span>
<a name=line-103></a>
<a name=line-104></a>                    <span class=n>att_name</span><span class=p>,</span> <span class=n>params</span><span class=p>,</span> <span class=n>notes</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>normalize_col_name</span><span class=p>(</span>
<a name=line-105></a>                        <span class=n>column_name</span><span class=p>,</span> <span class=n>used_column_names</span><span class=p>,</span> <span class=n>is_relation</span><span class=p>)</span>
<a name=line-106></a>                    <span class=n>extra_params</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
<a name=line-107></a>                    <span class=n>comment_notes</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>notes</span><span class=p>)</span>
<a name=line-108></a>
<a name=line-109></a>                    <span class=n>used_column_names</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>att_name</span><span class=p>)</span>
<a name=line-110></a>                    <span class=n>column_to_field_name</span><span class=p>[</span><span class=n>column_name</span><span class=p>]</span> <span class=o>=</span> <span class=n>att_name</span>
<a name=line-111></a>
<a name=line-112></a>                    <span class=c1># Add primary_key and unique, if necessary.</span>
<a name=line-113></a>                    <span class=k>if</span> <span class=n>column_name</span> <span class=o>==</span> <span class=n>primary_key_column</span><span class=p>:</span>
<a name=line-114></a>                        <span class=n>extra_params</span><span class=p>[</span><span class=s1>&#39;primary_key&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
<a name=line-115></a>                    <span class=k>elif</span> <span class=n>column_name</span> <span class=ow>in</span> <span class=n>unique_columns</span><span class=p>:</span>
<a name=line-116></a>                        <span class=n>extra_params</span><span class=p>[</span><span class=s1>&#39;unique&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
<a name=line-117></a>
<a name=line-118></a>                    <span class=k>if</span> <span class=n>is_relation</span><span class=p>:</span>
<a name=line-119></a>                        <span class=k>if</span> <span class=n>extra_params</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s1>&#39;unique&#39;</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span> <span class=ow>or</span> <span class=n>extra_params</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;primary_key&#39;</span><span class=p>):</span>
<a name=line-120></a>                            <span class=n>rel_type</span> <span class=o>=</span> <span class=s1>&#39;OneToOneField&#39;</span>
<a name=line-121></a>                        <span class=k>else</span><span class=p>:</span>
<a name=line-122></a>                            <span class=n>rel_type</span> <span class=o>=</span> <span class=s1>&#39;ForeignKey&#39;</span>
<a name=line-123></a>                        <span class=n>rel_to</span> <span class=o>=</span> <span class=p>(</span>
<a name=line-124></a>                            <span class=s2>&quot;self&quot;</span> <span class=k>if</span> <span class=n>relations</span><span class=p>[</span><span class=n>column_name</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=n>table_name</span>
<a name=line-125></a>                            <span class=k>else</span> <span class=n>table2model</span><span class=p>(</span><span class=n>relations</span><span class=p>[</span><span class=n>column_name</span><span class=p>][</span><span class=mi>1</span><span class=p>])</span>
<a name=line-126></a>                        <span class=p>)</span>
<a name=line-127></a>                        <span class=k>if</span> <span class=n>rel_to</span> <span class=ow>in</span> <span class=n>known_models</span><span class=p>:</span>
<a name=line-128></a>                            <span class=n>field_type</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>%s</span><span class=s1>(</span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>rel_type</span><span class=p>,</span> <span class=n>rel_to</span><span class=p>)</span>
<a name=line-129></a>                        <span class=k>else</span><span class=p>:</span>
<a name=line-130></a>                            <span class=n>field_type</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>%s</span><span class=s2>(&#39;</span><span class=si>%s</span><span class=s2>&#39;&quot;</span> <span class=o>%</span> <span class=p>(</span><span class=n>rel_type</span><span class=p>,</span> <span class=n>rel_to</span><span class=p>)</span>
<a name=line-131></a>                    <span class=k>else</span><span class=p>:</span>
<a name=line-132></a>                        <span class=c1># Calling `get_field_type` to get the field type string and any</span>
<a name=line-133></a>                        <span class=c1># additional parameters and notes.</span>
<a name=line-134></a>                        <span class=n>field_type</span><span class=p>,</span> <span class=n>field_params</span><span class=p>,</span> <span class=n>field_notes</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_field_type</span><span class=p>(</span><span class=n>connection</span><span class=p>,</span> <span class=n>table_name</span><span class=p>,</span> <span class=n>row</span><span class=p>)</span>
<a name=line-135></a>                        <span class=n>extra_params</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>field_params</span><span class=p>)</span>
<a name=line-136></a>                        <span class=n>comment_notes</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>field_notes</span><span class=p>)</span>
<a name=line-137></a>
<a name=line-138></a>                        <span class=n>field_type</span> <span class=o>+=</span> <span class=s1>&#39;(&#39;</span>
<a name=line-139></a>
<a name=line-140></a>                    <span class=c1># Don&#39;t output &#39;id = meta.AutoField(primary_key=True)&#39;, because</span>
<a name=line-141></a>                    <span class=c1># that&#39;s assumed if it doesn&#39;t exist.</span>
<a name=line-142></a>                    <span class=k>if</span> <span class=n>att_name</span> <span class=o>==</span> <span class=s1>&#39;id&#39;</span> <span class=ow>and</span> <span class=n>extra_params</span> <span class=o>==</span> <span class=p>{</span><span class=s1>&#39;primary_key&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>}:</span>
<a name=line-143></a>                        <span class=k>if</span> <span class=n>field_type</span> <span class=o>==</span> <span class=s1>&#39;AutoField(&#39;</span><span class=p>:</span>
<a name=line-144></a>                            <span class=k>continue</span>
<a name=line-145></a>                        <span class=k>elif</span> <span class=n>field_type</span> <span class=o>==</span> <span class=n>connection</span><span class=o>.</span><span class=n>features</span><span class=o>.</span><span class=n>introspected_field_types</span><span class=p>[</span><span class=s1>&#39;AutoField&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=s1>&#39;(&#39;</span><span class=p>:</span>
<a name=line-146></a>                            <span class=n>comment_notes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;AutoField?&#39;</span><span class=p>)</span>
<a name=line-147></a>
<a name=line-148></a>                    <span class=c1># Add &#39;null&#39; and &#39;blank&#39;, if the &#39;null_ok&#39; flag was present in the</span>
<a name=line-149></a>                    <span class=c1># table description.</span>
<a name=line-150></a>                    <span class=k>if</span> <span class=n>row</span><span class=o>.</span><span class=n>null_ok</span><span class=p>:</span>  <span class=c1># If it&#39;s NULL...</span>
<a name=line-151></a>                        <span class=n>extra_params</span><span class=p>[</span><span class=s1>&#39;blank&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
<a name=line-152></a>                        <span class=n>extra_params</span><span class=p>[</span><span class=s1>&#39;null&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
<a name=line-153></a>
<a name=line-154></a>                    <span class=n>field_desc</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>%s</span><span class=s1> = </span><span class=si>%s%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=p>(</span>
<a name=line-155></a>                        <span class=n>att_name</span><span class=p>,</span>
<a name=line-156></a>                        <span class=c1># Custom fields will have a dotted path</span>
<a name=line-157></a>                        <span class=s1>&#39;&#39;</span> <span class=k>if</span> <span class=s1>&#39;.&#39;</span> <span class=ow>in</span> <span class=n>field_type</span> <span class=k>else</span> <span class=s1>&#39;models.&#39;</span><span class=p>,</span>
<a name=line-158></a>                        <span class=n>field_type</span><span class=p>,</span>
<a name=line-159></a>                    <span class=p>)</span>
<a name=line-160></a>                    <span class=k>if</span> <span class=n>field_type</span><span class=o>.</span><span class=n>startswith</span><span class=p>((</span><span class=s1>&#39;ForeignKey(&#39;</span><span class=p>,</span> <span class=s1>&#39;OneToOneField(&#39;</span><span class=p>)):</span>
<a name=line-161></a>                        <span class=n>field_desc</span> <span class=o>+=</span> <span class=s1>&#39;, models.DO_NOTHING&#39;</span>
<a name=line-162></a>
<a name=line-163></a>                    <span class=k>if</span> <span class=n>extra_params</span><span class=p>:</span>
<a name=line-164></a>                        <span class=k>if</span> <span class=ow>not</span> <span class=n>field_desc</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s1>&#39;(&#39;</span><span class=p>):</span>
<a name=line-165></a>                            <span class=n>field_desc</span> <span class=o>+=</span> <span class=s1>&#39;, &#39;</span>
<a name=line-166></a>                        <span class=n>field_desc</span> <span class=o>+=</span> <span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=s1>&#39;</span><span class=si>%s</span><span class=s1>=</span><span class=si>%r</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span> <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>extra_params</span><span class=o>.</span><span class=n>items</span><span class=p>())</span>
<a name=line-167></a>                    <span class=n>field_desc</span> <span class=o>+=</span> <span class=s1>&#39;)&#39;</span>
<a name=line-168></a>                    <span class=k>if</span> <span class=n>comment_notes</span><span class=p>:</span>
<a name=line-169></a>                        <span class=n>field_desc</span> <span class=o>+=</span> <span class=s1>&#39;  # &#39;</span> <span class=o>+</span> <span class=s1>&#39; &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>comment_notes</span><span class=p>)</span>
<a name=line-170></a>                    <span class=k>yield</span> <span class=s1>&#39;    </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>field_desc</span>
<a name=line-171></a>                <span class=n>is_view</span> <span class=o>=</span> <span class=nb>any</span><span class=p>(</span><span class=n>info</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=n>table_name</span> <span class=ow>and</span> <span class=n>info</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s1>&#39;v&#39;</span> <span class=k>for</span> <span class=n>info</span> <span class=ow>in</span> <span class=n>table_info</span><span class=p>)</span>
<a name=line-172></a>                <span class=n>is_partition</span> <span class=o>=</span> <span class=nb>any</span><span class=p>(</span><span class=n>info</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=n>table_name</span> <span class=ow>and</span> <span class=n>info</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s1>&#39;p&#39;</span> <span class=k>for</span> <span class=n>info</span> <span class=ow>in</span> <span class=n>table_info</span><span class=p>)</span>
<a name=line-173></a>                <span class=k>yield from</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_meta</span><span class=p>(</span><span class=n>table_name</span><span class=p>,</span> <span class=n>constraints</span><span class=p>,</span> <span class=n>column_to_field_name</span><span class=p>,</span> <span class=n>is_view</span><span class=p>,</span> <span class=n>is_partition</span><span class=p>)</span>
<a name=line-174></a>
<a name=line-175></a>    <span class=k>def</span> <span class=nf>normalize_col_name</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>col_name</span><span class=p>,</span> <span class=n>used_column_names</span><span class=p>,</span> <span class=n>is_relation</span><span class=p>):</span>
<a name=line-176></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-177></a><span class=sd>        Modify the column name to make it Python-compatible as a field name</span>
<a name=line-178></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-179></a>        <span class=n>field_params</span> <span class=o>=</span> <span class=p>{}</span>
<a name=line-180></a>        <span class=n>field_notes</span> <span class=o>=</span> <span class=p>[]</span>
<a name=line-181></a>
<a name=line-182></a>        <span class=n>new_name</span> <span class=o>=</span> <span class=n>col_name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
<a name=line-183></a>        <span class=k>if</span> <span class=n>new_name</span> <span class=o>!=</span> <span class=n>col_name</span><span class=p>:</span>
<a name=line-184></a>            <span class=n>field_notes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;Field name made lowercase.&#39;</span><span class=p>)</span>
<a name=line-185></a>
<a name=line-186></a>        <span class=k>if</span> <span class=n>is_relation</span><span class=p>:</span>
<a name=line-187></a>            <span class=k>if</span> <span class=n>new_name</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s1>&#39;_id&#39;</span><span class=p>):</span>
<a name=line-188></a>                <span class=n>new_name</span> <span class=o>=</span> <span class=n>new_name</span><span class=p>[:</span><span class=o>-</span><span class=mi>3</span><span class=p>]</span>
<a name=line-189></a>            <span class=k>else</span><span class=p>:</span>
<a name=line-190></a>                <span class=n>field_params</span><span class=p>[</span><span class=s1>&#39;db_column&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>col_name</span>
<a name=line-191></a>
<a name=line-192></a>        <span class=n>new_name</span><span class=p>,</span> <span class=n>num_repl</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>subn</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;\W&#39;</span><span class=p>,</span> <span class=s1>&#39;_&#39;</span><span class=p>,</span> <span class=n>new_name</span><span class=p>)</span>
<a name=line-193></a>        <span class=k>if</span> <span class=n>num_repl</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
<a name=line-194></a>            <span class=n>field_notes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;Field renamed to remove unsuitable characters.&#39;</span><span class=p>)</span>
<a name=line-195></a>
<a name=line-196></a>        <span class=k>if</span> <span class=n>new_name</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=n>LOOKUP_SEP</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>:</span>
<a name=line-197></a>            <span class=k>while</span> <span class=n>new_name</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=n>LOOKUP_SEP</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>:</span>
<a name=line-198></a>                <span class=n>new_name</span> <span class=o>=</span> <span class=n>new_name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>LOOKUP_SEP</span><span class=p>,</span> <span class=s1>&#39;_&#39;</span><span class=p>)</span>
<a name=line-199></a>            <span class=k>if</span> <span class=n>col_name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=n>LOOKUP_SEP</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>:</span>
<a name=line-200></a>                <span class=c1># Only add the comment if the double underscore was in the original name</span>
<a name=line-201></a>                <span class=n>field_notes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;Field renamed because it contained more than one &#39;_&#39; in a row.&quot;</span><span class=p>)</span>
<a name=line-202></a>
<a name=line-203></a>        <span class=k>if</span> <span class=n>new_name</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;_&#39;</span><span class=p>):</span>
<a name=line-204></a>            <span class=n>new_name</span> <span class=o>=</span> <span class=s1>&#39;field</span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>new_name</span>
<a name=line-205></a>            <span class=n>field_notes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;Field renamed because it started with &#39;_&#39;.&quot;</span><span class=p>)</span>
<a name=line-206></a>
<a name=line-207></a>        <span class=k>if</span> <span class=n>new_name</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s1>&#39;_&#39;</span><span class=p>):</span>
<a name=line-208></a>            <span class=n>new_name</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>%s</span><span class=s1>field&#39;</span> <span class=o>%</span> <span class=n>new_name</span>
<a name=line-209></a>            <span class=n>field_notes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;Field renamed because it ended with &#39;_&#39;.&quot;</span><span class=p>)</span>
<a name=line-210></a>
<a name=line-211></a>        <span class=k>if</span> <span class=n>keyword</span><span class=o>.</span><span class=n>iskeyword</span><span class=p>(</span><span class=n>new_name</span><span class=p>):</span>
<a name=line-212></a>            <span class=n>new_name</span> <span class=o>+=</span> <span class=s1>&#39;_field&#39;</span>
<a name=line-213></a>            <span class=n>field_notes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;Field renamed because it was a Python reserved word.&#39;</span><span class=p>)</span>
<a name=line-214></a>
<a name=line-215></a>        <span class=k>if</span> <span class=n>new_name</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>isdigit</span><span class=p>():</span>
<a name=line-216></a>            <span class=n>new_name</span> <span class=o>=</span> <span class=s1>&#39;number_</span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>new_name</span>
<a name=line-217></a>            <span class=n>field_notes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;Field renamed because it wasn&#39;t a valid Python identifier.&quot;</span><span class=p>)</span>
<a name=line-218></a>
<a name=line-219></a>        <span class=k>if</span> <span class=n>new_name</span> <span class=ow>in</span> <span class=n>used_column_names</span><span class=p>:</span>
<a name=line-220></a>            <span class=n>num</span> <span class=o>=</span> <span class=mi>0</span>
<a name=line-221></a>            <span class=k>while</span> <span class=s1>&#39;</span><span class=si>%s</span><span class=s1>_</span><span class=si>%d</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>new_name</span><span class=p>,</span> <span class=n>num</span><span class=p>)</span> <span class=ow>in</span> <span class=n>used_column_names</span><span class=p>:</span>
<a name=line-222></a>                <span class=n>num</span> <span class=o>+=</span> <span class=mi>1</span>
<a name=line-223></a>            <span class=n>new_name</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>%s</span><span class=s1>_</span><span class=si>%d</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>new_name</span><span class=p>,</span> <span class=n>num</span><span class=p>)</span>
<a name=line-224></a>            <span class=n>field_notes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;Field renamed because of name conflict.&#39;</span><span class=p>)</span>
<a name=line-225></a>
<a name=line-226></a>        <span class=k>if</span> <span class=n>col_name</span> <span class=o>!=</span> <span class=n>new_name</span> <span class=ow>and</span> <span class=n>field_notes</span><span class=p>:</span>
<a name=line-227></a>            <span class=n>field_params</span><span class=p>[</span><span class=s1>&#39;db_column&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>col_name</span>
<a name=line-228></a>
<a name=line-229></a>        <span class=k>return</span> <span class=n>new_name</span><span class=p>,</span> <span class=n>field_params</span><span class=p>,</span> <span class=n>field_notes</span>
<a name=line-230></a>
<a name=line-231></a>    <span class=k>def</span> <span class=nf>get_field_type</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=n>table_name</span><span class=p>,</span> <span class=n>row</span><span class=p>):</span>
<a name=line-232></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-233></a><span class=sd>        Given the database connection, the table name, and the cursor row</span>
<a name=line-234></a><span class=sd>        description, this routine will return the given field type name, as</span>
<a name=line-235></a><span class=sd>        well as any additional keyword parameters and notes for the field.</span>
<a name=line-236></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-237></a>        <span class=n>field_params</span> <span class=o>=</span> <span class=p>{}</span>
<a name=line-238></a>        <span class=n>field_notes</span> <span class=o>=</span> <span class=p>[]</span>
<a name=line-239></a>
<a name=line-240></a>        <span class=k>try</span><span class=p>:</span>
<a name=line-241></a>            <span class=n>field_type</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>introspection</span><span class=o>.</span><span class=n>get_field_type</span><span class=p>(</span><span class=n>row</span><span class=o>.</span><span class=n>type_code</span><span class=p>,</span> <span class=n>row</span><span class=p>)</span>
<a name=line-242></a>        <span class=k>except</span> <span class=ne>KeyError</span><span class=p>:</span>
<a name=line-243></a>            <span class=n>field_type</span> <span class=o>=</span> <span class=s1>&#39;TextField&#39;</span>
<a name=line-244></a>            <span class=n>field_notes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;This field type is a guess.&#39;</span><span class=p>)</span>
<a name=line-245></a>
<a name=line-246></a>        <span class=c1># Add max_length for all CharFields.</span>
<a name=line-247></a>        <span class=k>if</span> <span class=n>field_type</span> <span class=o>==</span> <span class=s1>&#39;CharField&#39;</span> <span class=ow>and</span> <span class=n>row</span><span class=o>.</span><span class=n>internal_size</span><span class=p>:</span>
<a name=line-248></a>            <span class=n>field_params</span><span class=p>[</span><span class=s1>&#39;max_length&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>row</span><span class=o>.</span><span class=n>internal_size</span><span class=p>)</span>
<a name=line-249></a>
<a name=line-250></a>        <span class=k>if</span> <span class=n>field_type</span> <span class=ow>in</span> <span class=p>{</span><span class=s1>&#39;CharField&#39;</span><span class=p>,</span> <span class=s1>&#39;TextField&#39;</span><span class=p>}</span> <span class=ow>and</span> <span class=n>row</span><span class=o>.</span><span class=n>collation</span><span class=p>:</span>
<a name=line-251></a>            <span class=n>field_params</span><span class=p>[</span><span class=s1>&#39;db_collation&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>collation</span>
<a name=line-252></a>
<a name=line-253></a>        <span class=k>if</span> <span class=n>field_type</span> <span class=o>==</span> <span class=s1>&#39;DecimalField&#39;</span><span class=p>:</span>
<a name=line-254></a>            <span class=k>if</span> <span class=n>row</span><span class=o>.</span><span class=n>precision</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>row</span><span class=o>.</span><span class=n>scale</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-255></a>                <span class=n>field_notes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
<a name=line-256></a>                    <span class=s1>&#39;max_digits and decimal_places have been guessed, as this &#39;</span>
<a name=line-257></a>                    <span class=s1>&#39;database handles decimal fields as float&#39;</span><span class=p>)</span>
<a name=line-258></a>                <span class=n>field_params</span><span class=p>[</span><span class=s1>&#39;max_digits&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>precision</span> <span class=k>if</span> <span class=n>row</span><span class=o>.</span><span class=n>precision</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=k>else</span> <span class=mi>10</span>
<a name=line-259></a>                <span class=n>field_params</span><span class=p>[</span><span class=s1>&#39;decimal_places&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>scale</span> <span class=k>if</span> <span class=n>row</span><span class=o>.</span><span class=n>scale</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=k>else</span> <span class=mi>5</span>
<a name=line-260></a>            <span class=k>else</span><span class=p>:</span>
<a name=line-261></a>                <span class=n>field_params</span><span class=p>[</span><span class=s1>&#39;max_digits&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>precision</span>
<a name=line-262></a>                <span class=n>field_params</span><span class=p>[</span><span class=s1>&#39;decimal_places&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>scale</span>
<a name=line-263></a>
<a name=line-264></a>        <span class=k>return</span> <span class=n>field_type</span><span class=p>,</span> <span class=n>field_params</span><span class=p>,</span> <span class=n>field_notes</span>
<a name=line-265></a>
<a name=line-266></a>    <span class=k>def</span> <span class=nf>get_meta</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>table_name</span><span class=p>,</span> <span class=n>constraints</span><span class=p>,</span> <span class=n>column_to_field_name</span><span class=p>,</span> <span class=n>is_view</span><span class=p>,</span> <span class=n>is_partition</span><span class=p>):</span>
<a name=line-267></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-268></a><span class=sd>        Return a sequence comprising the lines of code necessary</span>
<a name=line-269></a><span class=sd>        to construct the inner Meta class for the model corresponding</span>
<a name=line-270></a><span class=sd>        to the given database table name.</span>
<a name=line-271></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-272></a>        <span class=n>unique_together</span> <span class=o>=</span> <span class=p>[]</span>
<a name=line-273></a>        <span class=n>has_unsupported_constraint</span> <span class=o>=</span> <span class=kc>False</span>
<a name=line-274></a>        <span class=k>for</span> <span class=n>params</span> <span class=ow>in</span> <span class=n>constraints</span><span class=o>.</span><span class=n>values</span><span class=p>():</span>
<a name=line-275></a>            <span class=k>if</span> <span class=n>params</span><span class=p>[</span><span class=s1>&#39;unique&#39;</span><span class=p>]:</span>
<a name=line-276></a>                <span class=n>columns</span> <span class=o>=</span> <span class=n>params</span><span class=p>[</span><span class=s1>&#39;columns&#39;</span><span class=p>]</span>
<a name=line-277></a>                <span class=k>if</span> <span class=kc>None</span> <span class=ow>in</span> <span class=n>columns</span><span class=p>:</span>
<a name=line-278></a>                    <span class=n>has_unsupported_constraint</span> <span class=o>=</span> <span class=kc>True</span>
<a name=line-279></a>                <span class=n>columns</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>columns</span> <span class=k>if</span> <span class=n>x</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>]</span>
<a name=line-280></a>                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>columns</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
<a name=line-281></a>                    <span class=n>unique_together</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=nb>tuple</span><span class=p>(</span><span class=n>column_to_field_name</span><span class=p>[</span><span class=n>c</span><span class=p>]</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>columns</span><span class=p>)))</span>
<a name=line-282></a>        <span class=k>if</span> <span class=n>is_view</span><span class=p>:</span>
<a name=line-283></a>            <span class=n>managed_comment</span> <span class=o>=</span> <span class=s2>&quot;  # Created from a view. Don&#39;t remove.&quot;</span>
<a name=line-284></a>        <span class=k>elif</span> <span class=n>is_partition</span><span class=p>:</span>
<a name=line-285></a>            <span class=n>managed_comment</span> <span class=o>=</span> <span class=s2>&quot;  # Created from a partition. Don&#39;t remove.&quot;</span>
<a name=line-286></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-287></a>            <span class=n>managed_comment</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
<a name=line-288></a>        <span class=n>meta</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;&#39;</span><span class=p>]</span>
<a name=line-289></a>        <span class=k>if</span> <span class=n>has_unsupported_constraint</span><span class=p>:</span>
<a name=line-290></a>            <span class=n>meta</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;    # A unique constraint could not be introspected.&#39;</span><span class=p>)</span>
<a name=line-291></a>        <span class=n>meta</span> <span class=o>+=</span> <span class=p>[</span>
<a name=line-292></a>            <span class=s1>&#39;    class Meta:&#39;</span><span class=p>,</span>
<a name=line-293></a>            <span class=s1>&#39;        managed = False</span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>managed_comment</span><span class=p>,</span>
<a name=line-294></a>            <span class=s1>&#39;        db_table = </span><span class=si>%r</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>table_name</span>
<a name=line-295></a>        <span class=p>]</span>
<a name=line-296></a>        <span class=k>if</span> <span class=n>unique_together</span><span class=p>:</span>
<a name=line-297></a>            <span class=n>tup</span> <span class=o>=</span> <span class=s1>&#39;(&#39;</span> <span class=o>+</span> <span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>unique_together</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;,)&#39;</span>
<a name=line-298></a>            <span class=n>meta</span> <span class=o>+=</span> <span class=p>[</span><span class=s2>&quot;        unique_together = </span><span class=si>%s</span><span class=s2>&quot;</span> <span class=o>%</span> <span class=n>tup</span><span class=p>]</span>
<a name=line-299></a>        <span class=k>return</span> <span class=n>meta</span>
</pre></div></td></tr></table><p class=footer> Generated by <a href=https://github.com/spirali/nedoc>nedoc</a> v0.9 at 2020-12-29 14:04 </p></div></div></body></html>