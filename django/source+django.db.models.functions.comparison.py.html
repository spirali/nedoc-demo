<!DOCTYPE html><html><head><meta charset=utf-8><title>django.db.models.functions.comparison</title><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=stylesheet href=./assets/purecss/pure-min.css><link rel=stylesheet href=./assets/purecss/grids-responsive-min.css><link rel=stylesheet href=./assets/style.css><link rel=stylesheet href=./assets/pygments/default.css><link rel=stylesheet href=./assets/jquery/jquery-ui.min.css><script src=./assets/jquery/jquery-3.0.0.min.js></script><script src=./assets/jquery/jquery-ui.min.js></script><script src=nedoc.js></script></head><body><div id=layout class=pure-g><div class="sidebar pure-u-1 pure-u-md-1-4"><div class=header><h1 class=brand-title>Django</h1> 1.0 </div><div id=sbox><input id=search style="color: black;" placeholder="search ..."></div><div class=tree><ul><li><a href=django.html>&#9662; django</a> </li><li><ul><li><a href=django.__main__.html>&#9656; __main__</a> </li><li><a href=django.apps.html>&#9656; apps</a> </li><li><a href=django.bin.html>&#9656; bin</a> </li><li><a href=django.conf.html>&#9656; conf</a> </li><li><a href=django.contrib.html>&#9656; contrib</a> </li><li><a href=django.core.html>&#9656; core</a> </li><li><a href=django.db.html>&#9662; db</a> </li><li><ul><li><a href=django.db.backends.html>&#9656; backends</a> </li><li><a href=django.db.migrations.html>&#9656; migrations</a> </li><li><a href=django.db.models.html>&#9662; models</a> </li><li><ul><li><a href=django.db.models.aggregates.html>&#9656; aggregates</a> </li><li><a href=django.db.models.base.html>&#9656; base</a> </li><li><a href=django.db.models.constants.html>&#9656; constants</a> </li><li><a href=django.db.models.constraints.html>&#9656; constraints</a> </li><li><a href=django.db.models.deletion.html>&#9656; deletion</a> </li><li><a href=django.db.models.enums.html>&#9656; enums</a> </li><li><a href=django.db.models.expressions.html>&#9656; expressions</a> </li><li><a href=django.db.models.fields.html>&#9656; fields</a> </li><li><a href=django.db.models.functions.html>&#9662; functions</a> </li><li><ul><li><div class=select><a href=django.db.models.functions.comparison.html>&#9662; comparison</a> </div></li><li><ul><li><a href=django.db.models.functions.comparison.Cast.html> <i>class</i> Cast</a> </li><li><a href=django.db.models.functions.comparison.Coalesce.html> <i>class</i> Coalesce</a> </li><li><a href=django.db.models.functions.comparison.Collate.html> <i>class</i> Collate</a> </li><li><a href=django.db.models.functions.comparison.Greatest.html> <i>class</i> Greatest</a> </li><li><a href=django.db.models.functions.comparison.Least.html> <i>class</i> Least</a> </li><li><a href=django.db.models.functions.comparison.NullIf.html> <i>class</i> NullIf</a> </li></ul></li><li><a href=django.db.models.functions.datetime.html>&#9656; datetime</a> </li><li><a href=django.db.models.functions.math.html>&#9656; math</a> </li><li><a href=django.db.models.functions.mixins.html>&#9656; mixins</a> </li><li><a href=django.db.models.functions.text.html>&#9656; text</a> </li><li><a href=django.db.models.functions.window.html>&#9656; window</a> </li></ul></li><li><a href=django.db.models.indexes.html>&#9656; indexes</a> </li><li><a href=django.db.models.lookups.html>&#9656; lookups</a> </li><li><a href=django.db.models.manager.html>&#9656; manager</a> </li><li><a href=django.db.models.options.html>&#9656; options</a> </li><li><a href=django.db.models.query.html>&#9656; query</a> </li><li><a href=django.db.models.query_utils.html>&#9656; query_utils</a> </li><li><a href=django.db.models.signals.html>&#9656; signals</a> </li><li><a href=django.db.models.sql.html>&#9656; sql</a> </li><li><a href=django.db.models.utils.html>&#9656; utils</a> </li></ul></li><li><a href=django.db.transaction.html>&#9656; transaction</a> </li><li><a href=django.db.utils.html>&#9656; utils</a> </li><li><a href=django.db.DefaultConnectionProxy.html> <i>class</i> DefaultConnectionProxy</a> </li></ul></li><li><a href=django.dispatch.html>&#9656; dispatch</a> </li><li><a href=django.forms.html>&#9656; forms</a> </li><li><a href=django.http.html>&#9656; http</a> </li><li><a href=django.middleware.html>&#9656; middleware</a> </li><li><a href=django.shortcuts.html>&#9656; shortcuts</a> </li><li><a href=django.template.html>&#9656; template</a> </li><li><a href=django.templatetags.html>&#9656; templatetags</a> </li><li><a href=django.test.html>&#9656; test</a> </li><li><a href=django.urls.html>&#9656; urls</a> </li><li><a href=django.utils.html>&#9656; utils</a> </li><li><a href=django.views.html>&#9656; views</a> </li></ul></ul></div></div><div class="content pure-u-1 pure-u-md-3-4"><h1>Source code django/db/models/functions/comparison.py</h1><div id=path><a class=symbol href=django.html>django</a>.<a class=symbol href=django.db.html>db</a>.<a class=symbol href=django.db.models.html>models</a>.<a class=symbol href=django.db.models.functions.html>functions</a>.<a class=symbol href=django.db.models.functions.comparison.html>comparison</a></div><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143</pre></div></td><td class=code><div class=highlight><pre><span></span><a name=line-1></a><span class=sd>&quot;&quot;&quot;Database functions that do comparisons or type conversions.&quot;&quot;&quot;</span>
<a name=line-2></a><span class=kn>from</span> <span class=nn>django.db.models.expressions</span> <span class=kn>import</span> <span class=n>Func</span><span class=p>,</span> <span class=n>Value</span>
<a name=line-3></a><span class=kn>from</span> <span class=nn>django.utils.regex_helper</span> <span class=kn>import</span> <span class=n>_lazy_re_compile</span>
<a name=line-4></a>
<a name=line-5></a>
<a name=line-6></a><span class=k>class</span> <span class=nc>Cast</span><span class=p>(</span><span class=n>Func</span><span class=p>):</span>
<a name=line-7></a>    <span class=sd>&quot;&quot;&quot;Coerce an expression to a new field type.&quot;&quot;&quot;</span>
<a name=line-8></a>    <span class=n>function</span> <span class=o>=</span> <span class=s1>&#39;CAST&#39;</span>
<a name=line-9></a>    <span class=n>template</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>%(function)s</span><span class=s1>(</span><span class=si>%(expressions)s</span><span class=s1> AS </span><span class=si>%(db_type)s</span><span class=s1>)&#39;</span>
<a name=line-10></a>
<a name=line-11></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>expression</span><span class=p>,</span> <span class=n>output_field</span><span class=p>):</span>
<a name=line-12></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>expression</span><span class=p>,</span> <span class=n>output_field</span><span class=o>=</span><span class=n>output_field</span><span class=p>)</span>
<a name=line-13></a>
<a name=line-14></a>    <span class=k>def</span> <span class=nf>as_sql</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>):</span>
<a name=line-15></a>        <span class=n>extra_context</span><span class=p>[</span><span class=s1>&#39;db_type&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>output_field</span><span class=o>.</span><span class=n>cast_db_type</span><span class=p>(</span><span class=n>connection</span><span class=p>)</span>
<a name=line-16></a>        <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>as_sql</span><span class=p>(</span><span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>)</span>
<a name=line-17></a>
<a name=line-18></a>    <span class=k>def</span> <span class=nf>as_sqlite</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>):</span>
<a name=line-19></a>        <span class=n>db_type</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>output_field</span><span class=o>.</span><span class=n>db_type</span><span class=p>(</span><span class=n>connection</span><span class=p>)</span>
<a name=line-20></a>        <span class=k>if</span> <span class=n>db_type</span> <span class=ow>in</span> <span class=p>{</span><span class=s1>&#39;datetime&#39;</span><span class=p>,</span> <span class=s1>&#39;time&#39;</span><span class=p>}:</span>
<a name=line-21></a>            <span class=c1># Use strftime as datetime/time don&#39;t keep fractional seconds.</span>
<a name=line-22></a>            <span class=n>template</span> <span class=o>=</span> <span class=s1>&#39;strftime(</span><span class=si>%%</span><span class=s1>s, </span><span class=si>%(expressions)s</span><span class=s1>)&#39;</span>
<a name=line-23></a>            <span class=n>sql</span><span class=p>,</span> <span class=n>params</span> <span class=o>=</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>as_sql</span><span class=p>(</span><span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=n>template</span><span class=o>=</span><span class=n>template</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>)</span>
<a name=line-24></a>            <span class=n>format_string</span> <span class=o>=</span> <span class=s1>&#39;%H:%M:</span><span class=si>%f</span><span class=s1>&#39;</span> <span class=k>if</span> <span class=n>db_type</span> <span class=o>==</span> <span class=s1>&#39;time&#39;</span> <span class=k>else</span> <span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1> %H:%M:</span><span class=si>%f</span><span class=s1>&#39;</span>
<a name=line-25></a>            <span class=n>params</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>format_string</span><span class=p>)</span>
<a name=line-26></a>            <span class=k>return</span> <span class=n>sql</span><span class=p>,</span> <span class=n>params</span>
<a name=line-27></a>        <span class=k>elif</span> <span class=n>db_type</span> <span class=o>==</span> <span class=s1>&#39;date&#39;</span><span class=p>:</span>
<a name=line-28></a>            <span class=n>template</span> <span class=o>=</span> <span class=s1>&#39;date(</span><span class=si>%(expressions)s</span><span class=s1>)&#39;</span>
<a name=line-29></a>            <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>as_sql</span><span class=p>(</span><span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=n>template</span><span class=o>=</span><span class=n>template</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>)</span>
<a name=line-30></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>as_sql</span><span class=p>(</span><span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>)</span>
<a name=line-31></a>
<a name=line-32></a>    <span class=k>def</span> <span class=nf>as_mysql</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>):</span>
<a name=line-33></a>        <span class=n>template</span> <span class=o>=</span> <span class=kc>None</span>
<a name=line-34></a>        <span class=n>output_type</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>output_field</span><span class=o>.</span><span class=n>get_internal_type</span><span class=p>()</span>
<a name=line-35></a>        <span class=c1># MySQL doesn&#39;t support explicit cast to float.</span>
<a name=line-36></a>        <span class=k>if</span> <span class=n>output_type</span> <span class=o>==</span> <span class=s1>&#39;FloatField&#39;</span><span class=p>:</span>
<a name=line-37></a>            <span class=n>template</span> <span class=o>=</span> <span class=s1>&#39;(</span><span class=si>%(expressions)s</span><span class=s1> + 0.0)&#39;</span>
<a name=line-38></a>        <span class=c1># MariaDB doesn&#39;t support explicit cast to JSON.</span>
<a name=line-39></a>        <span class=k>elif</span> <span class=n>output_type</span> <span class=o>==</span> <span class=s1>&#39;JSONField&#39;</span> <span class=ow>and</span> <span class=n>connection</span><span class=o>.</span><span class=n>mysql_is_mariadb</span><span class=p>:</span>
<a name=line-40></a>            <span class=n>template</span> <span class=o>=</span> <span class=s2>&quot;JSON_EXTRACT(</span><span class=si>%(expressions)s</span><span class=s2>, &#39;$&#39;)&quot;</span>
<a name=line-41></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>as_sql</span><span class=p>(</span><span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=n>template</span><span class=o>=</span><span class=n>template</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>)</span>
<a name=line-42></a>
<a name=line-43></a>    <span class=k>def</span> <span class=nf>as_postgresql</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>):</span>
<a name=line-44></a>        <span class=c1># CAST would be valid too, but the :: shortcut syntax is more readable.</span>
<a name=line-45></a>        <span class=c1># &#39;expressions&#39; is wrapped in parentheses in case it&#39;s a complex</span>
<a name=line-46></a>        <span class=c1># expression.</span>
<a name=line-47></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>as_sql</span><span class=p>(</span><span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=n>template</span><span class=o>=</span><span class=s1>&#39;(</span><span class=si>%(expressions)s</span><span class=s1>)::</span><span class=si>%(db_type)s</span><span class=s1>&#39;</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>)</span>
<a name=line-48></a>
<a name=line-49></a>    <span class=k>def</span> <span class=nf>as_oracle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>):</span>
<a name=line-50></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>output_field</span><span class=o>.</span><span class=n>get_internal_type</span><span class=p>()</span> <span class=o>==</span> <span class=s1>&#39;JSONField&#39;</span><span class=p>:</span>
<a name=line-51></a>            <span class=c1># Oracle doesn&#39;t support explicit cast to JSON.</span>
<a name=line-52></a>            <span class=n>template</span> <span class=o>=</span> <span class=s2>&quot;JSON_QUERY(</span><span class=si>%(expressions)s</span><span class=s2>, &#39;$&#39;)&quot;</span>
<a name=line-53></a>            <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>as_sql</span><span class=p>(</span><span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=n>template</span><span class=o>=</span><span class=n>template</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>)</span>
<a name=line-54></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>as_sql</span><span class=p>(</span><span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>)</span>
<a name=line-55></a>
<a name=line-56></a>
<a name=line-57></a><span class=k>class</span> <span class=nc>Coalesce</span><span class=p>(</span><span class=n>Func</span><span class=p>):</span>
<a name=line-58></a>    <span class=sd>&quot;&quot;&quot;Return, from left to right, the first non-null expression.&quot;&quot;&quot;</span>
<a name=line-59></a>    <span class=n>function</span> <span class=o>=</span> <span class=s1>&#39;COALESCE&#39;</span>
<a name=line-60></a>
<a name=line-61></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>expressions</span><span class=p>,</span> <span class=o>**</span><span class=n>extra</span><span class=p>):</span>
<a name=line-62></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>expressions</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>:</span>
<a name=line-63></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;Coalesce must take at least two expressions&#39;</span><span class=p>)</span>
<a name=line-64></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=o>*</span><span class=n>expressions</span><span class=p>,</span> <span class=o>**</span><span class=n>extra</span><span class=p>)</span>
<a name=line-65></a>
<a name=line-66></a>    <span class=k>def</span> <span class=nf>as_oracle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>):</span>
<a name=line-67></a>        <span class=c1># Oracle prohibits mixing TextField (NCLOB) and CharField (NVARCHAR2),</span>
<a name=line-68></a>        <span class=c1># so convert all fields to NCLOB when that type is expected.</span>
<a name=line-69></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>output_field</span><span class=o>.</span><span class=n>get_internal_type</span><span class=p>()</span> <span class=o>==</span> <span class=s1>&#39;TextField&#39;</span><span class=p>:</span>
<a name=line-70></a>            <span class=n>clone</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
<a name=line-71></a>            <span class=n>clone</span><span class=o>.</span><span class=n>set_source_expressions</span><span class=p>([</span>
<a name=line-72></a>                <span class=n>Func</span><span class=p>(</span><span class=n>expression</span><span class=p>,</span> <span class=n>function</span><span class=o>=</span><span class=s1>&#39;TO_NCLOB&#39;</span><span class=p>)</span> <span class=k>for</span> <span class=n>expression</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_source_expressions</span><span class=p>()</span>
<a name=line-73></a>            <span class=p>])</span>
<a name=line-74></a>            <span class=k>return</span> <span class=nb>super</span><span class=p>(</span><span class=n>Coalesce</span><span class=p>,</span> <span class=n>clone</span><span class=p>)</span><span class=o>.</span><span class=n>as_sql</span><span class=p>(</span><span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>)</span>
<a name=line-75></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>as_sql</span><span class=p>(</span><span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>)</span>
<a name=line-76></a>
<a name=line-77></a>
<a name=line-78></a><span class=k>class</span> <span class=nc>Collate</span><span class=p>(</span><span class=n>Func</span><span class=p>):</span>
<a name=line-79></a>    <span class=n>function</span> <span class=o>=</span> <span class=s1>&#39;COLLATE&#39;</span>
<a name=line-80></a>    <span class=n>template</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>%(expressions)s</span><span class=s1> </span><span class=si>%(function)s</span><span class=s1> </span><span class=si>%(collation)s</span><span class=s1>&#39;</span>
<a name=line-81></a>    <span class=c1># Inspired from https://www.postgresql.org/docs/current/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS</span>
<a name=line-82></a>    <span class=n>collation_re</span> <span class=o>=</span> <span class=n>_lazy_re_compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;^[\w\-]+$&#39;</span><span class=p>)</span>
<a name=line-83></a>
<a name=line-84></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>expression</span><span class=p>,</span> <span class=n>collation</span><span class=p>):</span>
<a name=line-85></a>        <span class=k>if</span> <span class=ow>not</span> <span class=p>(</span><span class=n>collation</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>collation_re</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=n>collation</span><span class=p>)):</span>
<a name=line-86></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;Invalid collation name: </span><span class=si>%r</span><span class=s1>.&#39;</span> <span class=o>%</span> <span class=n>collation</span><span class=p>)</span>
<a name=line-87></a>        <span class=bp>self</span><span class=o>.</span><span class=n>collation</span> <span class=o>=</span> <span class=n>collation</span>
<a name=line-88></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>expression</span><span class=p>)</span>
<a name=line-89></a>
<a name=line-90></a>    <span class=k>def</span> <span class=nf>as_sql</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>):</span>
<a name=line-91></a>        <span class=n>extra_context</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=s1>&#39;collation&#39;</span><span class=p>,</span> <span class=n>connection</span><span class=o>.</span><span class=n>ops</span><span class=o>.</span><span class=n>quote_name</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>collation</span><span class=p>))</span>
<a name=line-92></a>        <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>as_sql</span><span class=p>(</span><span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>)</span>
<a name=line-93></a>
<a name=line-94></a>
<a name=line-95></a><span class=k>class</span> <span class=nc>Greatest</span><span class=p>(</span><span class=n>Func</span><span class=p>):</span>
<a name=line-96></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-97></a><span class=sd>    Return the maximum expression.</span>
<a name=line-98></a>
<a name=line-99></a><span class=sd>    If any expression is null the return value is database-specific:</span>
<a name=line-100></a><span class=sd>    On PostgreSQL, the maximum not-null expression is returned.</span>
<a name=line-101></a><span class=sd>    On MySQL, Oracle, and SQLite, if any expression is null, null is returned.</span>
<a name=line-102></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-103></a>    <span class=n>function</span> <span class=o>=</span> <span class=s1>&#39;GREATEST&#39;</span>
<a name=line-104></a>
<a name=line-105></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>expressions</span><span class=p>,</span> <span class=o>**</span><span class=n>extra</span><span class=p>):</span>
<a name=line-106></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>expressions</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>:</span>
<a name=line-107></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;Greatest must take at least two expressions&#39;</span><span class=p>)</span>
<a name=line-108></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=o>*</span><span class=n>expressions</span><span class=p>,</span> <span class=o>**</span><span class=n>extra</span><span class=p>)</span>
<a name=line-109></a>
<a name=line-110></a>    <span class=k>def</span> <span class=nf>as_sqlite</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>):</span>
<a name=line-111></a>        <span class=sd>&quot;&quot;&quot;Use the MAX function on SQLite.&quot;&quot;&quot;</span>
<a name=line-112></a>        <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>as_sqlite</span><span class=p>(</span><span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=n>function</span><span class=o>=</span><span class=s1>&#39;MAX&#39;</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>)</span>
<a name=line-113></a>
<a name=line-114></a>
<a name=line-115></a><span class=k>class</span> <span class=nc>Least</span><span class=p>(</span><span class=n>Func</span><span class=p>):</span>
<a name=line-116></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-117></a><span class=sd>    Return the minimum expression.</span>
<a name=line-118></a>
<a name=line-119></a><span class=sd>    If any expression is null the return value is database-specific:</span>
<a name=line-120></a><span class=sd>    On PostgreSQL, return the minimum not-null expression.</span>
<a name=line-121></a><span class=sd>    On MySQL, Oracle, and SQLite, if any expression is null, return null.</span>
<a name=line-122></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-123></a>    <span class=n>function</span> <span class=o>=</span> <span class=s1>&#39;LEAST&#39;</span>
<a name=line-124></a>
<a name=line-125></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>expressions</span><span class=p>,</span> <span class=o>**</span><span class=n>extra</span><span class=p>):</span>
<a name=line-126></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>expressions</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>:</span>
<a name=line-127></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;Least must take at least two expressions&#39;</span><span class=p>)</span>
<a name=line-128></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=o>*</span><span class=n>expressions</span><span class=p>,</span> <span class=o>**</span><span class=n>extra</span><span class=p>)</span>
<a name=line-129></a>
<a name=line-130></a>    <span class=k>def</span> <span class=nf>as_sqlite</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>):</span>
<a name=line-131></a>        <span class=sd>&quot;&quot;&quot;Use the MIN function on SQLite.&quot;&quot;&quot;</span>
<a name=line-132></a>        <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>as_sqlite</span><span class=p>(</span><span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=n>function</span><span class=o>=</span><span class=s1>&#39;MIN&#39;</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>)</span>
<a name=line-133></a>
<a name=line-134></a>
<a name=line-135></a><span class=k>class</span> <span class=nc>NullIf</span><span class=p>(</span><span class=n>Func</span><span class=p>):</span>
<a name=line-136></a>    <span class=n>function</span> <span class=o>=</span> <span class=s1>&#39;NULLIF&#39;</span>
<a name=line-137></a>    <span class=n>arity</span> <span class=o>=</span> <span class=mi>2</span>
<a name=line-138></a>
<a name=line-139></a>    <span class=k>def</span> <span class=nf>as_oracle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>):</span>
<a name=line-140></a>        <span class=n>expression1</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_source_expressions</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
<a name=line-141></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>expression1</span><span class=p>,</span> <span class=n>Value</span><span class=p>)</span> <span class=ow>and</span> <span class=n>expression1</span><span class=o>.</span><span class=n>value</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-142></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;Oracle does not allow Value(None) for expression1.&#39;</span><span class=p>)</span>
<a name=line-143></a>        <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>as_sql</span><span class=p>(</span><span class=n>compiler</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=o>**</span><span class=n>extra_context</span><span class=p>)</span>
</pre></div></td></tr></table><p class=footer> Generated by <a href=https://github.com/spirali/nedoc>nedoc</a> v0.9 at 2020-12-29 14:04 </p></div></div></body></html>