<!DOCTYPE html><html><head><meta charset=utf-8><title>distributed.profile</title><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=stylesheet href=./assets/purecss/pure-min.css><link rel=stylesheet href=./assets/purecss/grids-responsive-min.css><link rel=stylesheet href=./assets/style.css><link rel=stylesheet href=./assets/pygments/default.css><link rel=stylesheet href=./assets/jquery/jquery-ui.min.css><script src=./assets/jquery/jquery-3.0.0.min.js></script><script src=./assets/jquery/jquery-ui.min.js></script><script src=nedoc.js></script></head><body><div id=layout class=pure-g><div class="sidebar pure-u-1 pure-u-md-1-4"><div class=header><h1 class=brand-title>Distributed</h1> 1.0 </div><div id=sbox><input id=search style="color: black;" placeholder="search ..."></div><div class=tree><ul><li><a href=distributed.html>&#9662; distributed</a> </li><li><ul><li><a href=distributed.actor.html>&#9656; actor</a> </li><li><a href=distributed.asyncio.html>&#9656; asyncio</a> </li><li><a href=distributed.batched.html>&#9656; batched</a> </li><li><a href=distributed.bokeh.html>&#9656; bokeh</a> </li><li><a href=distributed.cfexecutor.html>&#9656; cfexecutor</a> </li><li><a href=distributed.cli.html>&#9656; cli</a> </li><li><a href=distributed.client.html>&#9656; client</a> </li><li><a href=distributed.comm.html>&#9656; comm</a> </li><li><a href=distributed.compatibility.html>&#9656; compatibility</a> </li><li><a href=distributed.config.html>&#9656; config</a> </li><li><a href=distributed.core.html>&#9656; core</a> </li><li><a href=distributed.counter.html>&#9656; counter</a> </li><li><a href=distributed.dashboard.html>&#9656; dashboard</a> </li><li><a href=distributed.deploy.html>&#9656; deploy</a> </li><li><a href=distributed.diagnostics.html>&#9656; diagnostics</a> </li><li><a href=distributed.diskutils.html>&#9656; diskutils</a> </li><li><a href=distributed.event.html>&#9656; event</a> </li><li><a href=distributed.http.html>&#9656; http</a> </li><li><a href=distributed.lock.html>&#9656; lock</a> </li><li><a href=distributed.locket.html>&#9656; locket</a> </li><li><a href=distributed.metrics.html>&#9656; metrics</a> </li><li><a href=distributed.nanny.html>&#9656; nanny</a> </li><li><a href=distributed.node.html>&#9656; node</a> </li><li><a href=distributed.preloading.html>&#9656; preloading</a> </li><li><a href=distributed.process.html>&#9656; process</a> </li><li><a href=distributed.proctitle.html>&#9656; proctitle</a> </li><li><div class=select><a href=distributed.profile.html>&#9662; profile</a> </div></li><li><a href=distributed.protocol.html>&#9656; protocol</a> </li><li><a href=distributed.publish.html>&#9656; publish</a> </li><li><a href=distributed.pubsub.html>&#9656; pubsub</a> </li><li><a href=distributed.pytest_resourceleaks.html>&#9656; pytest_resourceleaks</a> </li><li><a href=distributed.queues.html>&#9656; queues</a> </li><li><a href=distributed.recreate_exceptions.html>&#9656; recreate_exceptions</a> </li><li><a href=distributed.scheduler.html>&#9656; scheduler</a> </li><li><a href=distributed.security.html>&#9656; security</a> </li><li><a href=distributed.semaphore.html>&#9656; semaphore</a> </li><li><a href=distributed.sizeof.html>&#9656; sizeof</a> </li><li><a href=distributed.stealing.html>&#9656; stealing</a> </li><li><a href=distributed.system.html>&#9656; system</a> </li><li><a href=distributed.system_monitor.html>&#9656; system_monitor</a> </li><li><a href=distributed.tests.html>&#9656; tests</a> </li><li><a href=distributed.threadpoolexecutor.html>&#9656; threadpoolexecutor</a> </li><li><a href=distributed.utils.html>&#9656; utils</a> </li><li><a href=distributed.utils_comm.html>&#9656; utils_comm</a> </li><li><a href=distributed.utils_perf.html>&#9656; utils_perf</a> </li><li><a href=distributed.utils_test.html>&#9656; utils_test</a> </li><li><a href=distributed.variable.html>&#9656; variable</a> </li><li><a href=distributed.versions.html>&#9656; versions</a> </li><li><a href=distributed.worker.html>&#9656; worker</a> </li><li><a href=distributed.worker_client.html>&#9656; worker_client</a> </li></ul></ul></div></div><div class="content pure-u-1 pure-u-md-3-4"><h1>Module profile</h1><div id=path><a class=symbol href=distributed.html>distributed</a>.<a class=symbol href=distributed.profile.html>profile</a></div><div class=docline> This module contains utility functions to construct and manipulate counting data structures for frames. </div><pre>When performing statistical profiling we obtain many call stacks.  We aggregate
these call stacks into data structures that maintain counts of how many times
each function in that call stack has been called.  Because these stacks will
overlap this aggregation counting structure forms a tree, such as is commonly
visualized by profiling tools.

We represent this tree as a nested dictionary with the following form:

    {
     &#39;identifier&#39;: &#39;root&#39;,
     &#39;description&#39;: &#39;A long description of the line of code being run.&#39;,
     &#39;count&#39;: 10  # the number of times we have seen this line
     &#39;children&#39;: {  # callers of this line. Recursive dicts
         &#39;ident-b&#39;: {&#39;description&#39;: ...
                   &#39;identifier&#39;: &#39;ident-a&#39;,
                   &#39;count&#39;: ...
                   &#39;children&#39;: {...}},
         &#39;ident-b&#39;: {&#39;description&#39;: ...
                   &#39;identifier&#39;: &#39;ident-b&#39;,
                   &#39;count&#39;: ...
                   &#39;children&#39;: {...}}}
    }</pre><a class=sourcelink href=source+distributed.profile.py.html>source</a> <a class=sourcelink href=distributed.profile.html>link</a><h2>Functions</h2><ul class=deflst><li><div class=fn><a id=f_call_stack></a><div class=fshort><span class=def><span class=ftoggle>&#9654;</span> def <a class="fexpand symbol" href=distributed.profile.html#f_call_stack>call_stack</a>(<span class=args>frame</span>) </span><div class=docline> Create a call text stack from a frame </div></div><div class=fdetail id=fn_call_stack><div class=idnt><a class=sourcelink href=source+distributed.profile.py.html#line-158>source</a> <a class=sourcelink href=distributed.profile.html#f_call_stack>link</a></div><h3>Returns</h3><ul class=params><li> list of strings </li></ul><h3>Reexports</h3><ul class=deflst2><li> Imported in <a class=symbol href=distributed.tests.test_profile.html>distributed.tests.test_profile</a>. </li></ul></div></div></li><li><div class=fn><a id=f_create></a><div class=fshort><span class=def><span class=ftoggle>&#9654;</span> def <a class="fexpand symbol-no-doc" href=distributed.profile.html#f_create>create</a>(<span class=args></span>) </span></div><div class=fdetail id=fn_create><div class=idnt><a class=sourcelink href=source+distributed.profile.py.html#line-149>source</a> <a class=sourcelink href=distributed.profile.html#f_create>link</a></div><h3>Reexports</h3><ul class=deflst2><li> Imported in <a class=symbol href=distributed.tests.test_profile.html>distributed.tests.test_profile</a>. </li></ul></div></div></li><li><div class=fn><a id=f_get_profile></a><div class=fshort><span class=def><span class=ftoggle>&#9654;</span> def <a class="fexpand symbol" href=distributed.profile.html#f_get_profile>get_profile</a>(<span class=args>history, recent=None, start=None, stop=None, key=None</span>) </span><div class=docline> Collect profile information from a sequence of profile states </div></div><div class=fdetail id=fn_get_profile><div class=idnt><a class=sourcelink href=source+distributed.profile.py.html#line-325>source</a> <a class=sourcelink href=distributed.profile.html#f_get_profile>link</a></div><h3>Parameters</h3><ul class=params><li><strong>history</strong> : Sequence[Tuple[time, Dict]] <br><pre>A list or deque of profile states</pre></li><li><strong>recent</strong> : dict <br><pre>The most recent accumulating state</pre></li><li><strong>start</strong> : time </li><li><strong>stop</strong> : time </li></ul></div></div></li><li><div class=fn><a id=f_identifier></a><div class=fshort><span class=def><span class=ftoggle>&#9654;</span> def <a class="fexpand symbol" href=distributed.profile.html#f_identifier>identifier</a>(<span class=args>frame</span>) </span><div class=docline> A string identifier from a frame </div></div><div class=fdetail id=fn_identifier><div class=idnt><a class=sourcelink href=source+distributed.profile.py.html#line-39>source</a> <a class=sourcelink href=distributed.profile.html#f_identifier>link</a></div><pre>Strings are cheaper to use as indexes into dicts than tuples or dicts</pre><h3>Reexports</h3><ul class=deflst2><li> Imported in <a class=symbol href=distributed.tests.test_profile.html>distributed.tests.test_profile</a>. </li></ul></div></div></li><li><div class=fn><a id=f_info_frame></a><div class=fshort><span class=def><span class=ftoggle-empty>&#9655;</span> def <a class="fexpand symbol-no-doc" href=distributed.profile.html#f_info_frame>info_frame</a>(<span class=args>frame</span>) </span></div><div class=fdetail id=fn_info_frame><div class=idnt><a class=sourcelink href=source+distributed.profile.py.html#line-64>source</a> <a class=sourcelink href=distributed.profile.html#f_info_frame>link</a></div></div></div></li><li><div class=fn><a id=f_ll_get_stack></a><div class=fshort><span class=def><span class=ftoggle>&#9654;</span> def <a class="fexpand symbol" href=distributed.profile.html#f_ll_get_stack>ll_get_stack</a>(<span class=args>tid</span>) </span><div class=docline> Collect low level stack information from thread id </div></div><div class=fdetail id=fn_ll_get_stack><div class=idnt><a class=sourcelink href=source+distributed.profile.py.html#line-491>source</a> <a class=sourcelink href=distributed.profile.html#f_ll_get_stack>link</a></div><h3>Reexports</h3><ul class=deflst2><li> Imported in <a class=symbol href=distributed.tests.test_profile.html>distributed.tests.test_profile</a>. </li></ul></div></div></li><li><div class=fn><a id=f_llprocess></a><div class=fshort><span class=def><span class=ftoggle>&#9654;</span> def <a class="fexpand symbol" href=distributed.profile.html#f_llprocess>llprocess</a>(<span class=args>frames, child, state</span>) </span><div class=docline> Add counts from low level profile information onto existing state </div></div><div class=fdetail id=fn_llprocess><div class=idnt><a class=sourcelink href=source+distributed.profile.py.html#line-445>source</a> <a class=sourcelink href=distributed.profile.html#f_llprocess>link</a></div><pre>This uses the ``stacktrace`` module to collect low level stack trace
information and place it onto the given sttate.

It is configured with the ``distributed.worker.profile.low-level`` config
entry.</pre><h3>See also</h3><pre>process
ll_get_stack</pre><h3>Reexports</h3><ul class=deflst2><li> Imported in <a class=symbol href=distributed.tests.test_profile.html>distributed.tests.test_profile</a>. </li></ul></div></div></li><li><div class=fn><a id=f_merge></a><div class=fshort><span class=def><span class=ftoggle>&#9654;</span> def <a class="fexpand symbol" href=distributed.profile.html#f_merge>merge</a>(<span class=args>*args</span>) </span><div class=docline> Merge multiple frame states together </div></div><div class=fdetail id=fn_merge><div class=idnt><a class=sourcelink href=source+distributed.profile.py.html#line-127>source</a> <a class=sourcelink href=distributed.profile.html#f_merge>link</a></div><h3>Reexports</h3><ul class=deflst2><li> Imported in <a class=symbol href=distributed.tests.test_profile.html>distributed.tests.test_profile</a>. </li></ul></div></div></li><li><div class=fn><a id=f_plot_data></a><div class=fshort><span class=def><span class=ftoggle>&#9654;</span> def <a class="fexpand symbol" href=distributed.profile.html#f_plot_data>plot_data</a>(<span class=args>state, profile_interval=0.010</span>) </span><div class=docline> Convert a profile state into data useful by Bokeh </div></div><div class=fdetail id=fn_plot_data><div class=idnt><a class=sourcelink href=source+distributed.profile.py.html#line-172>source</a> <a class=sourcelink href=distributed.profile.html#f_plot_data>link</a></div><h3>See also</h3><pre>plot_figure
distributed.bokeh.components.ProfilePlot</pre><h3>Reexports</h3><ul class=deflst2><li> Imported in <a class=symbol href=distributed.tests.test_profile.html>distributed.tests.test_profile</a>. </li></ul></div></div></li><li><div class=fn><a id=f_plot_figure></a><div class=fshort><span class=def><span class=ftoggle>&#9654;</span> def <a class="fexpand symbol" href=distributed.profile.html#f_plot_figure>plot_figure</a>(<span class=args>data, **kwargs</span>) </span><div class=docline> Plot profile data using Bokeh </div></div><div class=fdetail id=fn_plot_figure><div class=idnt><a class=sourcelink href=source+distributed.profile.py.html#line-367>source</a> <a class=sourcelink href=distributed.profile.html#f_plot_figure>link</a></div><pre>This takes the output from the function ``plot_data`` and produces a Bokeh
figure</pre><h3>See also</h3><pre>plot_data</pre></div></div></li><li><div class=fn><a id=f_process></a><div class=fshort><span class=def><span class=ftoggle>&#9654;</span> def <a class="fexpand symbol" href=distributed.profile.html#f_process>process</a>(<span class=args>frame, child, state, stop=None, omit=None</span>) </span><div class=docline> Add counts from a frame stack onto existing state </div></div><div class=fdetail id=fn_process><div class=idnt><a class=sourcelink href=source+distributed.profile.py.html#line-75>source</a> <a class=sourcelink href=distributed.profile.html#f_process>link</a></div><pre>This recursively adds counts to the existing state dictionary and creates
new entries for new functions.</pre><h3>Examples</h3><pre>&gt;&gt;&gt; import sys, threading
&gt;&gt;&gt; ident = threading.get_ident()  # replace with your thread of interest
&gt;&gt;&gt; frame = sys._current_frames()[ident]
&gt;&gt;&gt; state = {&#39;children&#39;: {}, &#39;count&#39;: 0, &#39;description&#39;: &#39;root&#39;,
...          &#39;identifier&#39;: &#39;root&#39;}
&gt;&gt;&gt; process(frame, None, state)
&gt;&gt;&gt; state
{&#39;count&#39;: 1,
 &#39;identifier&#39;: &#39;root&#39;,
 &#39;description&#39;: &#39;root&#39;,
 &#39;children&#39;: {&#39;...&#39;}}</pre><h3>Reexports</h3><ul class=deflst2><li> Imported in <a class=symbol href=distributed.tests.test_profile.html>distributed.tests.test_profile</a>. </li></ul></div></div></li><li><div class=fn><a id=f_repr_frame></a><div class=fshort><span class=def><span class=ftoggle-empty>&#9655;</span> def <a class="fexpand symbol" href=distributed.profile.html#f_repr_frame>repr_frame</a>(<span class=args>frame</span>) </span><div class=docline> Render a frame as a line for inclusion into a text traceback </div></div><div class=fdetail id=fn_repr_frame><div class=idnt><a class=sourcelink href=source+distributed.profile.py.html#line-56>source</a> <a class=sourcelink href=distributed.profile.html#f_repr_frame>link</a></div></div></div></li><li><div class=fn><a id=f_watch></a><div class=fshort><span class=def><span class=ftoggle>&#9654;</span> def <a class="fexpand symbol" href=distributed.profile.html#f_watch>watch</a>(<span class=args>thread_id=None, interval=&#34;20ms&#34;, cycle=&#34;2s&#34;, maxlen=1000, omit=None, ...</span>) </span><div class=docline> Gather profile information on a particular thread </div></div><div class=fdetail id=fn_watch><div class=decl><div class=def><span class=kw>def</span> watch( <div class=args style="padding-left: 2em">thread_id=<i>None</i>,</div><div class=args style="padding-left: 2em">interval=<i>"20ms"</i>,</div><div class=args style="padding-left: 2em">cycle=<i>"2s"</i>,</div><div class=args style="padding-left: 2em">maxlen=<i>1000</i>,</div><div class=args style="padding-left: 2em">omit=<i>None</i>,</div><div class=args style="padding-left: 2em">stop=<i>lambda: False</i>,</div> ) </div></div><div class=idnt><a class=sourcelink href=source+distributed.profile.py.html#line-271>source</a> <a class=sourcelink href=distributed.profile.html#f_watch>link</a></div><pre>This starts a new thread to watch a particular thread and returns a deque
that holds periodic profile information.</pre><h3>Parameters</h3><ul class=params><li><strong>thread_id</strong> : int </li><li><strong>interval</strong> : str <br><pre>Time per sample</pre></li><li><strong>cycle</strong> : str <br><pre>Time per refreshing to a new profile state</pre></li><li><strong>maxlen</strong> : int <br><pre>Passed onto deque, maximum number of periods</pre></li><li><strong>omit</strong> : str <br><pre>Don&#39;t include entries that start with this filename</pre></li><li><strong>stop</strong> : callable <br><pre>Function to call to see if we should stop</pre></li></ul><h3>Returns</h3><ul class=params><li> deque </li></ul><h3>Reexports</h3><ul class=deflst2><li> Imported in <a class=symbol href=distributed.tests.test_profile.html>distributed.tests.test_profile</a>. </li></ul></div></div></li></ul><p class=footer> Generated by <a href=https://github.com/spirali/nedoc>nedoc</a> v0.9 at 2020-12-29 14:05 </p></div></div></body></html>