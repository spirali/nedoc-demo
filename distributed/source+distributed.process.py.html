<!DOCTYPE html><html><head><meta charset=utf-8><title>distributed.process</title><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=stylesheet href=./assets/purecss/pure-min.css><link rel=stylesheet href=./assets/purecss/grids-responsive-min.css><link rel=stylesheet href=./assets/style.css><link rel=stylesheet href=./assets/pygments/default.css><link rel=stylesheet href=./assets/jquery/jquery-ui.min.css><script src=./assets/jquery/jquery-3.0.0.min.js></script><script src=./assets/jquery/jquery-ui.min.js></script><script src=nedoc.js></script></head><body><div id=layout class=pure-g><div class="sidebar pure-u-1 pure-u-md-1-4"><div class=header><h1 class=brand-title>Distributed</h1> 1.0 </div><div id=sbox><input id=search style="color: black;" placeholder="search ..."></div><div class=tree><ul><li><a href=distributed.html>&#9662; distributed</a> </li><li><ul><li><a href=distributed.actor.html>&#9656; actor</a> </li><li><a href=distributed.asyncio.html>&#9656; asyncio</a> </li><li><a href=distributed.batched.html>&#9656; batched</a> </li><li><a href=distributed.bokeh.html>&#9656; bokeh</a> </li><li><a href=distributed.cfexecutor.html>&#9656; cfexecutor</a> </li><li><a href=distributed.cli.html>&#9656; cli</a> </li><li><a href=distributed.client.html>&#9656; client</a> </li><li><a href=distributed.comm.html>&#9656; comm</a> </li><li><a href=distributed.compatibility.html>&#9656; compatibility</a> </li><li><a href=distributed.config.html>&#9656; config</a> </li><li><a href=distributed.core.html>&#9656; core</a> </li><li><a href=distributed.counter.html>&#9656; counter</a> </li><li><a href=distributed.dashboard.html>&#9656; dashboard</a> </li><li><a href=distributed.deploy.html>&#9656; deploy</a> </li><li><a href=distributed.diagnostics.html>&#9656; diagnostics</a> </li><li><a href=distributed.diskutils.html>&#9656; diskutils</a> </li><li><a href=distributed.event.html>&#9656; event</a> </li><li><a href=distributed.http.html>&#9656; http</a> </li><li><a href=distributed.lock.html>&#9656; lock</a> </li><li><a href=distributed.locket.html>&#9656; locket</a> </li><li><a href=distributed.metrics.html>&#9656; metrics</a> </li><li><a href=distributed.nanny.html>&#9656; nanny</a> </li><li><a href=distributed.node.html>&#9656; node</a> </li><li><a href=distributed.preloading.html>&#9656; preloading</a> </li><li><div class=select><a href=distributed.process.html>&#9662; process</a> </div></li><li><ul><li><a href=distributed.process.AsyncProcess.html> <i>class</i> AsyncProcess</a> </li></ul></li><li><a href=distributed.proctitle.html>&#9656; proctitle</a> </li><li><a href=distributed.profile.html>&#9656; profile</a> </li><li><a href=distributed.protocol.html>&#9656; protocol</a> </li><li><a href=distributed.publish.html>&#9656; publish</a> </li><li><a href=distributed.pubsub.html>&#9656; pubsub</a> </li><li><a href=distributed.pytest_resourceleaks.html>&#9656; pytest_resourceleaks</a> </li><li><a href=distributed.queues.html>&#9656; queues</a> </li><li><a href=distributed.recreate_exceptions.html>&#9656; recreate_exceptions</a> </li><li><a href=distributed.scheduler.html>&#9656; scheduler</a> </li><li><a href=distributed.security.html>&#9656; security</a> </li><li><a href=distributed.semaphore.html>&#9656; semaphore</a> </li><li><a href=distributed.sizeof.html>&#9656; sizeof</a> </li><li><a href=distributed.stealing.html>&#9656; stealing</a> </li><li><a href=distributed.system.html>&#9656; system</a> </li><li><a href=distributed.system_monitor.html>&#9656; system_monitor</a> </li><li><a href=distributed.tests.html>&#9656; tests</a> </li><li><a href=distributed.threadpoolexecutor.html>&#9656; threadpoolexecutor</a> </li><li><a href=distributed.utils.html>&#9656; utils</a> </li><li><a href=distributed.utils_comm.html>&#9656; utils_comm</a> </li><li><a href=distributed.utils_perf.html>&#9656; utils_perf</a> </li><li><a href=distributed.utils_test.html>&#9656; utils_test</a> </li><li><a href=distributed.variable.html>&#9656; variable</a> </li><li><a href=distributed.versions.html>&#9656; versions</a> </li><li><a href=distributed.worker.html>&#9656; worker</a> </li><li><a href=distributed.worker_client.html>&#9656; worker_client</a> </li></ul></ul></div></div><div class="content pure-u-1 pure-u-md-3-4"><h1>Source code distributed/process.py</h1><div id=path><a class=symbol href=distributed.html>distributed</a>.<a class=symbol href=distributed.process.html>process</a></div><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344</pre></div></td><td class=code><div class=highlight><pre><span></span><a name=line-1></a><span class=kn>import</span> <span class=nn>logging</span>
<a name=line-2></a><span class=kn>import</span> <span class=nn>os</span>
<a name=line-3></a><span class=kn>from</span> <span class=nn>queue</span> <span class=kn>import</span> <span class=n>Queue</span> <span class=k>as</span> <span class=n>PyQueue</span>
<a name=line-4></a><span class=kn>import</span> <span class=nn>re</span>
<a name=line-5></a><span class=kn>import</span> <span class=nn>threading</span>
<a name=line-6></a><span class=kn>import</span> <span class=nn>weakref</span>
<a name=line-7></a><span class=kn>import</span> <span class=nn>asyncio</span>
<a name=line-8></a><span class=kn>import</span> <span class=nn>dask</span>
<a name=line-9></a>
<a name=line-10></a><span class=kn>from</span> <span class=nn>.utils</span> <span class=kn>import</span> <span class=n>mp_context</span><span class=p>,</span> <span class=ne>TimeoutError</span>
<a name=line-11></a>
<a name=line-12></a><span class=kn>from</span> <span class=nn>tornado</span> <span class=kn>import</span> <span class=n>gen</span>
<a name=line-13></a><span class=kn>from</span> <span class=nn>tornado.concurrent</span> <span class=kn>import</span> <span class=n>Future</span>
<a name=line-14></a><span class=kn>from</span> <span class=nn>tornado.ioloop</span> <span class=kn>import</span> <span class=n>IOLoop</span>
<a name=line-15></a>
<a name=line-16></a>
<a name=line-17></a><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
<a name=line-18></a>
<a name=line-19></a>
<a name=line-20></a><span class=k>def</span> <span class=nf>_loop_add_callback</span><span class=p>(</span><span class=n>loop</span><span class=p>,</span> <span class=n>func</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>):</span>
<a name=line-21></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-22></a><span class=sd>    Helper to silence &quot;IOLoop is closing&quot; exception on IOLoop.add_callback.</span>
<a name=line-23></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-24></a>    <span class=k>try</span><span class=p>:</span>
<a name=line-25></a>        <span class=n>loop</span><span class=o>.</span><span class=n>add_callback</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>)</span>
<a name=line-26></a>    <span class=k>except</span> <span class=ne>RuntimeError</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
<a name=line-27></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s2>&quot;IOLoop is clos(ed|ing)&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>exc</span><span class=p>)):</span>
<a name=line-28></a>            <span class=k>raise</span>
<a name=line-29></a>
<a name=line-30></a>
<a name=line-31></a><span class=k>def</span> <span class=nf>_call_and_set_future</span><span class=p>(</span><span class=n>loop</span><span class=p>,</span> <span class=n>future</span><span class=p>,</span> <span class=n>func</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
<a name=line-32></a>    <span class=k>try</span><span class=p>:</span>
<a name=line-33></a>        <span class=n>res</span> <span class=o>=</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
<a name=line-34></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
<a name=line-35></a>        <span class=c1># Tornado futures are not thread-safe, need to</span>
<a name=line-36></a>        <span class=c1># set_result() / set_exc_info() from the loop&#39;s thread</span>
<a name=line-37></a>        <span class=n>_loop_add_callback</span><span class=p>(</span><span class=n>loop</span><span class=p>,</span> <span class=n>future</span><span class=o>.</span><span class=n>set_exception</span><span class=p>,</span> <span class=n>exc</span><span class=p>)</span>
<a name=line-38></a>    <span class=k>else</span><span class=p>:</span>
<a name=line-39></a>        <span class=n>_loop_add_callback</span><span class=p>(</span><span class=n>loop</span><span class=p>,</span> <span class=n>future</span><span class=o>.</span><span class=n>set_result</span><span class=p>,</span> <span class=n>res</span><span class=p>)</span>
<a name=line-40></a>
<a name=line-41></a>
<a name=line-42></a><span class=k>class</span> <span class=nc>_ProcessState</span><span class=p>:</span>
<a name=line-43></a>    <span class=n>is_alive</span> <span class=o>=</span> <span class=kc>False</span>
<a name=line-44></a>    <span class=n>pid</span> <span class=o>=</span> <span class=kc>None</span>
<a name=line-45></a>    <span class=n>exitcode</span> <span class=o>=</span> <span class=kc>None</span>
<a name=line-46></a>
<a name=line-47></a>
<a name=line-48></a><span class=k>class</span> <span class=nc>AsyncProcess</span><span class=p>:</span>
<a name=line-49></a>    <span class=sd>&quot;&quot;&quot;</span>
<a name=line-50></a><span class=sd>    A coroutine-compatible multiprocessing.Process-alike.</span>
<a name=line-51></a><span class=sd>    All normally blocking methods are wrapped in Tornado coroutines.</span>
<a name=line-52></a><span class=sd>    &quot;&quot;&quot;</span>
<a name=line-53></a>
<a name=line-54></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>loop</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>target</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(),</span> <span class=n>kwargs</span><span class=o>=</span><span class=p>{}):</span>
<a name=line-55></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>callable</span><span class=p>(</span><span class=n>target</span><span class=p>):</span>
<a name=line-56></a>            <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span><span class=s2>&quot;`target` needs to be callable, not </span><span class=si>%r</span><span class=s2>&quot;</span> <span class=o>%</span> <span class=p>(</span><span class=nb>type</span><span class=p>(</span><span class=n>target</span><span class=p>),))</span>
<a name=line-57></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_state</span> <span class=o>=</span> <span class=n>_ProcessState</span><span class=p>()</span>
<a name=line-58></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_loop</span> <span class=o>=</span> <span class=n>loop</span> <span class=ow>or</span> <span class=n>IOLoop</span><span class=o>.</span><span class=n>current</span><span class=p>(</span><span class=n>instance</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a name=line-59></a>
<a name=line-60></a>        <span class=c1># _keep_child_alive is the write side of a pipe, which, when it is</span>
<a name=line-61></a>        <span class=c1># closed, causes the read side of the pipe to unblock for reading. Note</span>
<a name=line-62></a>        <span class=c1># that it is never closed directly. The write side is closed by the</span>
<a name=line-63></a>        <span class=c1># kernel when our process exits, or possibly by the garbage collector</span>
<a name=line-64></a>        <span class=c1># closing the file descriptor when the last reference to</span>
<a name=line-65></a>        <span class=c1># _keep_child_alive goes away. We can take advantage of this fact to</span>
<a name=line-66></a>        <span class=c1># monitor from the child and exit when the parent goes away unexpectedly</span>
<a name=line-67></a>        <span class=c1># (for example due to SIGKILL). This variable is otherwise unused except</span>
<a name=line-68></a>        <span class=c1># for the assignment here.</span>
<a name=line-69></a>        <span class=n>parent_alive_pipe</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_keep_child_alive</span> <span class=o>=</span> <span class=n>mp_context</span><span class=o>.</span><span class=n>Pipe</span><span class=p>(</span><span class=n>duplex</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a name=line-70></a>
<a name=line-71></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_process</span> <span class=o>=</span> <span class=n>mp_context</span><span class=o>.</span><span class=n>Process</span><span class=p>(</span>
<a name=line-72></a>            <span class=n>target</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_run</span><span class=p>,</span>
<a name=line-73></a>            <span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>,</span>
<a name=line-74></a>            <span class=n>args</span><span class=o>=</span><span class=p>(</span>
<a name=line-75></a>                <span class=n>target</span><span class=p>,</span>
<a name=line-76></a>                <span class=n>args</span><span class=p>,</span>
<a name=line-77></a>                <span class=n>kwargs</span><span class=p>,</span>
<a name=line-78></a>                <span class=n>parent_alive_pipe</span><span class=p>,</span>
<a name=line-79></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_keep_child_alive</span><span class=p>,</span>
<a name=line-80></a>                <span class=n>dask</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>global_config</span><span class=p>,</span>
<a name=line-81></a>            <span class=p>),</span>
<a name=line-82></a>        <span class=p>)</span>
<a name=line-83></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process</span><span class=o>.</span><span class=n>name</span>
<a name=line-84></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_proc_finalizer</span> <span class=o>=</span> <span class=n>weakref</span><span class=o>.</span><span class=n>finalize</span><span class=p>(</span>
<a name=line-85></a>            <span class=bp>self</span><span class=p>,</span> <span class=n>_asyncprocess_finalizer</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process</span>
<a name=line-86></a>        <span class=p>)</span>
<a name=line-87></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_watch_q</span> <span class=o>=</span> <span class=n>PyQueue</span><span class=p>()</span>
<a name=line-88></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_exit_future</span> <span class=o>=</span> <span class=n>Future</span><span class=p>()</span>
<a name=line-89></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_exit_callback</span> <span class=o>=</span> <span class=kc>None</span>
<a name=line-90></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_closed</span> <span class=o>=</span> <span class=kc>False</span>
<a name=line-91></a>
<a name=line-92></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_start_threads</span><span class=p>()</span>
<a name=line-93></a>
<a name=line-94></a>    <span class=k>def</span> <span class=fm>__repr__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-95></a>        <span class=k>return</span> <span class=s2>&quot;&lt;</span><span class=si>%s</span><span class=s2> </span><span class=si>%s</span><span class=s2>&gt;&quot;</span> <span class=o>%</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_name</span><span class=p>)</span>
<a name=line-96></a>
<a name=line-97></a>    <span class=k>def</span> <span class=nf>_check_closed</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-98></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_closed</span><span class=p>:</span>
<a name=line-99></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;invalid operation on closed AsyncProcess&quot;</span><span class=p>)</span>
<a name=line-100></a>
<a name=line-101></a>    <span class=k>def</span> <span class=nf>_start_threads</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-102></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_watch_message_thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span>
<a name=line-103></a>            <span class=n>target</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_watch_message_queue</span><span class=p>,</span>
<a name=line-104></a>            <span class=n>name</span><span class=o>=</span><span class=s2>&quot;AsyncProcess </span><span class=si>%s</span><span class=s2> watch message queue&quot;</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
<a name=line-105></a>            <span class=n>args</span><span class=o>=</span><span class=p>(</span>
<a name=line-106></a>                <span class=n>weakref</span><span class=o>.</span><span class=n>ref</span><span class=p>(</span><span class=bp>self</span><span class=p>),</span>
<a name=line-107></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_process</span><span class=p>,</span>
<a name=line-108></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_loop</span><span class=p>,</span>
<a name=line-109></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_state</span><span class=p>,</span>
<a name=line-110></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_watch_q</span><span class=p>,</span>
<a name=line-111></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_exit_future</span><span class=p>,</span>
<a name=line-112></a>            <span class=p>),</span>
<a name=line-113></a>        <span class=p>)</span>
<a name=line-114></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_watch_message_thread</span><span class=o>.</span><span class=n>daemon</span> <span class=o>=</span> <span class=kc>True</span>
<a name=line-115></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_watch_message_thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
<a name=line-116></a>
<a name=line-117></a>        <span class=k>def</span> <span class=nf>stop_thread</span><span class=p>(</span><span class=n>q</span><span class=p>):</span>
<a name=line-118></a>            <span class=n>q</span><span class=o>.</span><span class=n>put_nowait</span><span class=p>({</span><span class=s2>&quot;op&quot;</span><span class=p>:</span> <span class=s2>&quot;stop&quot;</span><span class=p>})</span>
<a name=line-119></a>            <span class=c1># We don&#39;t join the thread here as a finalizer can be called</span>
<a name=line-120></a>            <span class=c1># asynchronously from anywhere</span>
<a name=line-121></a>
<a name=line-122></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_thread_finalizer</span> <span class=o>=</span> <span class=n>weakref</span><span class=o>.</span><span class=n>finalize</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stop_thread</span><span class=p>,</span> <span class=n>q</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_watch_q</span><span class=p>)</span>
<a name=line-123></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_thread_finalizer</span><span class=o>.</span><span class=n>atexit</span> <span class=o>=</span> <span class=kc>False</span>
<a name=line-124></a>
<a name=line-125></a>    <span class=k>def</span> <span class=nf>_on_exit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>exitcode</span><span class=p>):</span>
<a name=line-126></a>        <span class=c1># Called from the event loop when the child process exited</span>
<a name=line-127></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_process</span> <span class=o>=</span> <span class=kc>None</span>
<a name=line-128></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_exit_callback</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-129></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_exit_callback</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
<a name=line-130></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_exit_future</span><span class=o>.</span><span class=n>set_result</span><span class=p>(</span><span class=n>exitcode</span><span class=p>)</span>
<a name=line-131></a>
<a name=line-132></a>    <span class=nd>@classmethod</span>
<a name=line-133></a>    <span class=k>def</span> <span class=nf>_immediate_exit_when_closed</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>parent_alive_pipe</span><span class=p>):</span>
<a name=line-134></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-135></a><span class=sd>        Immediately exit the process when parent_alive_pipe is closed.</span>
<a name=line-136></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-137></a>
<a name=line-138></a>        <span class=k>def</span> <span class=nf>monitor_parent</span><span class=p>():</span>
<a name=line-139></a>            <span class=k>try</span><span class=p>:</span>
<a name=line-140></a>                <span class=c1># The parent_alive_pipe should be held open as long as the</span>
<a name=line-141></a>                <span class=c1># parent is alive and wants us to stay alive. Nothing writes to</span>
<a name=line-142></a>                <span class=c1># it, so the read will block indefinitely.</span>
<a name=line-143></a>                <span class=n>parent_alive_pipe</span><span class=o>.</span><span class=n>recv</span><span class=p>()</span>
<a name=line-144></a>            <span class=k>except</span> <span class=ne>EOFError</span><span class=p>:</span>
<a name=line-145></a>                <span class=c1># Parent process went away unexpectedly. Exit immediately. Could</span>
<a name=line-146></a>                <span class=c1># consider other exiting approches here. My initial preference</span>
<a name=line-147></a>                <span class=c1># is to unconditionally and immediately exit. If we&#39;re in this</span>
<a name=line-148></a>                <span class=c1># state it is possible that a &quot;clean&quot; process exit won&#39;t work</span>
<a name=line-149></a>                <span class=c1># anyway - if, for example, the system is getting bogged down</span>
<a name=line-150></a>                <span class=c1># due to the running out of memory, exiting sooner rather than</span>
<a name=line-151></a>                <span class=c1># later might be needed to restore normal system function.</span>
<a name=line-152></a>                <span class=c1># If this is in appropriate for your use case, please file a</span>
<a name=line-153></a>                <span class=c1># bug.</span>
<a name=line-154></a>                <span class=n>os</span><span class=o>.</span><span class=n>_exit</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
<a name=line-155></a>            <span class=k>else</span><span class=p>:</span>
<a name=line-156></a>                <span class=c1># If we get here, something odd is going on. File descriptors</span>
<a name=line-157></a>                <span class=c1># got crossed?</span>
<a name=line-158></a>                <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&quot;unexpected state: should be unreachable&quot;</span><span class=p>)</span>
<a name=line-159></a>
<a name=line-160></a>        <span class=n>t</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>monitor_parent</span><span class=p>)</span>
<a name=line-161></a>        <span class=n>t</span><span class=o>.</span><span class=n>daemon</span> <span class=o>=</span> <span class=kc>True</span>
<a name=line-162></a>        <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
<a name=line-163></a>
<a name=line-164></a>    <span class=nd>@staticmethod</span>
<a name=line-165></a>    <span class=k>def</span> <span class=nf>reset_logger_locks</span><span class=p>():</span>
<a name=line-166></a>        <span class=sd>&quot;&quot;&quot;Python 2&#39;s logger&#39;s locks don&#39;t survive a fork event</span>
<a name=line-167></a>
<a name=line-168></a><span class=sd>        https://github.com/dask/distributed/issues/1491</span>
<a name=line-169></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-170></a>        <span class=k>for</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>logging</span><span class=o>.</span><span class=n>Logger</span><span class=o>.</span><span class=n>manager</span><span class=o>.</span><span class=n>loggerDict</span><span class=o>.</span><span class=n>keys</span><span class=p>():</span>
<a name=line-171></a>            <span class=k>for</span> <span class=n>handler</span> <span class=ow>in</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=n>name</span><span class=p>)</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span>
<a name=line-172></a>                <span class=n>handler</span><span class=o>.</span><span class=n>createLock</span><span class=p>()</span>
<a name=line-173></a>
<a name=line-174></a>    <span class=nd>@classmethod</span>
<a name=line-175></a>    <span class=k>def</span> <span class=nf>_run</span><span class=p>(</span>
<a name=line-176></a>        <span class=bp>cls</span><span class=p>,</span> <span class=n>target</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>,</span> <span class=n>parent_alive_pipe</span><span class=p>,</span> <span class=n>_keep_child_alive</span><span class=p>,</span> <span class=n>inherit_config</span>
<a name=line-177></a>    <span class=p>):</span>
<a name=line-178></a>        <span class=c1># On Python 2 with the fork method, we inherit the _keep_child_alive fd,</span>
<a name=line-179></a>        <span class=c1># whether it is passed or not. Therefore, pass it unconditionally and</span>
<a name=line-180></a>        <span class=c1># close it here, so that there are no other references to the pipe lying</span>
<a name=line-181></a>        <span class=c1># around.</span>
<a name=line-182></a>        <span class=bp>cls</span><span class=o>.</span><span class=n>reset_logger_locks</span><span class=p>()</span>
<a name=line-183></a>
<a name=line-184></a>        <span class=n>_keep_child_alive</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
<a name=line-185></a>
<a name=line-186></a>        <span class=c1># Child process entry point</span>
<a name=line-187></a>        <span class=bp>cls</span><span class=o>.</span><span class=n>_immediate_exit_when_closed</span><span class=p>(</span><span class=n>parent_alive_pipe</span><span class=p>)</span>
<a name=line-188></a>
<a name=line-189></a>        <span class=n>threading</span><span class=o>.</span><span class=n>current_thread</span><span class=p>()</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;MainThread&quot;</span>
<a name=line-190></a>        <span class=c1># Update the global config given priority to the existing global config</span>
<a name=line-191></a>        <span class=n>dask</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>dask</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>global_config</span><span class=p>,</span> <span class=n>inherit_config</span><span class=p>,</span> <span class=n>priority</span><span class=o>=</span><span class=s2>&quot;old&quot;</span><span class=p>)</span>
<a name=line-192></a>        <span class=n>target</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
<a name=line-193></a>
<a name=line-194></a>    <span class=nd>@classmethod</span>
<a name=line-195></a>    <span class=k>def</span> <span class=nf>_watch_message_queue</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>selfref</span><span class=p>,</span> <span class=n>process</span><span class=p>,</span> <span class=n>loop</span><span class=p>,</span> <span class=n>state</span><span class=p>,</span> <span class=n>q</span><span class=p>,</span> <span class=n>exit_future</span><span class=p>):</span>
<a name=line-196></a>        <span class=c1># As multiprocessing.Process is not thread-safe, we run all</span>
<a name=line-197></a>        <span class=c1># blocking operations from this single loop and ship results</span>
<a name=line-198></a>        <span class=c1># back to the caller when needed.</span>
<a name=line-199></a>        <span class=n>r</span> <span class=o>=</span> <span class=nb>repr</span><span class=p>(</span><span class=n>selfref</span><span class=p>())</span>
<a name=line-200></a>        <span class=n>name</span> <span class=o>=</span> <span class=n>selfref</span><span class=p>()</span><span class=o>.</span><span class=n>name</span>
<a name=line-201></a>
<a name=line-202></a>        <span class=k>def</span> <span class=nf>_start</span><span class=p>():</span>
<a name=line-203></a>            <span class=n>process</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
<a name=line-204></a>
<a name=line-205></a>            <span class=n>thread</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span>
<a name=line-206></a>                <span class=n>target</span><span class=o>=</span><span class=n>AsyncProcess</span><span class=o>.</span><span class=n>_watch_process</span><span class=p>,</span>
<a name=line-207></a>                <span class=n>name</span><span class=o>=</span><span class=s2>&quot;AsyncProcess </span><span class=si>%s</span><span class=s2> watch process join&quot;</span> <span class=o>%</span> <span class=n>name</span><span class=p>,</span>
<a name=line-208></a>                <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>selfref</span><span class=p>,</span> <span class=n>process</span><span class=p>,</span> <span class=n>state</span><span class=p>,</span> <span class=n>q</span><span class=p>),</span>
<a name=line-209></a>            <span class=p>)</span>
<a name=line-210></a>            <span class=n>thread</span><span class=o>.</span><span class=n>daemon</span> <span class=o>=</span> <span class=kc>True</span>
<a name=line-211></a>            <span class=n>thread</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
<a name=line-212></a>
<a name=line-213></a>            <span class=n>state</span><span class=o>.</span><span class=n>is_alive</span> <span class=o>=</span> <span class=kc>True</span>
<a name=line-214></a>            <span class=n>state</span><span class=o>.</span><span class=n>pid</span> <span class=o>=</span> <span class=n>process</span><span class=o>.</span><span class=n>pid</span>
<a name=line-215></a>            <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;[</span><span class=si>%s</span><span class=s2>] created process with pid </span><span class=si>%r</span><span class=s2>&quot;</span> <span class=o>%</span> <span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>state</span><span class=o>.</span><span class=n>pid</span><span class=p>))</span>
<a name=line-216></a>
<a name=line-217></a>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
<a name=line-218></a>            <span class=n>msg</span> <span class=o>=</span> <span class=n>q</span><span class=o>.</span><span class=n>get</span><span class=p>()</span>
<a name=line-219></a>            <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;[</span><span class=si>%s</span><span class=s2>] got message </span><span class=si>%r</span><span class=s2>&quot;</span> <span class=o>%</span> <span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>msg</span><span class=p>))</span>
<a name=line-220></a>            <span class=n>op</span> <span class=o>=</span> <span class=n>msg</span><span class=p>[</span><span class=s2>&quot;op&quot;</span><span class=p>]</span>
<a name=line-221></a>            <span class=k>if</span> <span class=n>op</span> <span class=o>==</span> <span class=s2>&quot;start&quot;</span><span class=p>:</span>
<a name=line-222></a>                <span class=n>_call_and_set_future</span><span class=p>(</span><span class=n>loop</span><span class=p>,</span> <span class=n>msg</span><span class=p>[</span><span class=s2>&quot;future&quot;</span><span class=p>],</span> <span class=n>_start</span><span class=p>)</span>
<a name=line-223></a>            <span class=k>elif</span> <span class=n>op</span> <span class=o>==</span> <span class=s2>&quot;terminate&quot;</span><span class=p>:</span>
<a name=line-224></a>                <span class=n>_call_and_set_future</span><span class=p>(</span><span class=n>loop</span><span class=p>,</span> <span class=n>msg</span><span class=p>[</span><span class=s2>&quot;future&quot;</span><span class=p>],</span> <span class=n>process</span><span class=o>.</span><span class=n>terminate</span><span class=p>)</span>
<a name=line-225></a>            <span class=k>elif</span> <span class=n>op</span> <span class=o>==</span> <span class=s2>&quot;stop&quot;</span><span class=p>:</span>
<a name=line-226></a>                <span class=k>break</span>
<a name=line-227></a>            <span class=k>else</span><span class=p>:</span>
<a name=line-228></a>                <span class=k>assert</span> <span class=mi>0</span><span class=p>,</span> <span class=n>msg</span>
<a name=line-229></a>
<a name=line-230></a>    <span class=nd>@classmethod</span>
<a name=line-231></a>    <span class=k>def</span> <span class=nf>_watch_process</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>selfref</span><span class=p>,</span> <span class=n>process</span><span class=p>,</span> <span class=n>state</span><span class=p>,</span> <span class=n>q</span><span class=p>):</span>
<a name=line-232></a>        <span class=n>r</span> <span class=o>=</span> <span class=nb>repr</span><span class=p>(</span><span class=n>selfref</span><span class=p>())</span>
<a name=line-233></a>        <span class=n>process</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
<a name=line-234></a>        <span class=n>exitcode</span> <span class=o>=</span> <span class=n>process</span><span class=o>.</span><span class=n>exitcode</span>
<a name=line-235></a>        <span class=k>assert</span> <span class=n>exitcode</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
<a name=line-236></a>        <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;[</span><span class=si>%s</span><span class=s2>] process </span><span class=si>%r</span><span class=s2> exited with code </span><span class=si>%r</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=n>state</span><span class=o>.</span><span class=n>pid</span><span class=p>,</span> <span class=n>exitcode</span><span class=p>)</span>
<a name=line-237></a>        <span class=n>state</span><span class=o>.</span><span class=n>is_alive</span> <span class=o>=</span> <span class=kc>False</span>
<a name=line-238></a>        <span class=n>state</span><span class=o>.</span><span class=n>exitcode</span> <span class=o>=</span> <span class=n>exitcode</span>
<a name=line-239></a>        <span class=c1># Make sure the process is removed from the global list</span>
<a name=line-240></a>        <span class=c1># (see _children in multiprocessing/process.py)</span>
<a name=line-241></a>        <span class=c1># Then notify the Process object</span>
<a name=line-242></a>        <span class=bp>self</span> <span class=o>=</span> <span class=n>selfref</span><span class=p>()</span>  <span class=c1># only keep self alive when required</span>
<a name=line-243></a>        <span class=k>try</span><span class=p>:</span>
<a name=line-244></a>            <span class=k>if</span> <span class=bp>self</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-245></a>                <span class=n>_loop_add_callback</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_loop</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_on_exit</span><span class=p>,</span> <span class=n>exitcode</span><span class=p>)</span>
<a name=line-246></a>        <span class=k>finally</span><span class=p>:</span>
<a name=line-247></a>            <span class=bp>self</span> <span class=o>=</span> <span class=kc>None</span>  <span class=c1># lose reference</span>
<a name=line-248></a>
<a name=line-249></a>    <span class=k>def</span> <span class=nf>start</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-250></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-251></a><span class=sd>        Start the child process.</span>
<a name=line-252></a>
<a name=line-253></a><span class=sd>        This method is a coroutine.</span>
<a name=line-254></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-255></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_check_closed</span><span class=p>()</span>
<a name=line-256></a>        <span class=n>fut</span> <span class=o>=</span> <span class=n>Future</span><span class=p>()</span>
<a name=line-257></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_watch_q</span><span class=o>.</span><span class=n>put_nowait</span><span class=p>({</span><span class=s2>&quot;op&quot;</span><span class=p>:</span> <span class=s2>&quot;start&quot;</span><span class=p>,</span> <span class=s2>&quot;future&quot;</span><span class=p>:</span> <span class=n>fut</span><span class=p>})</span>
<a name=line-258></a>        <span class=k>return</span> <span class=n>fut</span>
<a name=line-259></a>
<a name=line-260></a>    <span class=k>def</span> <span class=nf>terminate</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-261></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-262></a><span class=sd>        Terminate the child process.</span>
<a name=line-263></a>
<a name=line-264></a><span class=sd>        This method is a coroutine.</span>
<a name=line-265></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-266></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_check_closed</span><span class=p>()</span>
<a name=line-267></a>        <span class=n>fut</span> <span class=o>=</span> <span class=n>Future</span><span class=p>()</span>
<a name=line-268></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_watch_q</span><span class=o>.</span><span class=n>put_nowait</span><span class=p>({</span><span class=s2>&quot;op&quot;</span><span class=p>:</span> <span class=s2>&quot;terminate&quot;</span><span class=p>,</span> <span class=s2>&quot;future&quot;</span><span class=p>:</span> <span class=n>fut</span><span class=p>})</span>
<a name=line-269></a>        <span class=k>return</span> <span class=n>fut</span>
<a name=line-270></a>
<a name=line-271></a>    <span class=nd>@gen</span><span class=o>.</span><span class=n>coroutine</span>
<a name=line-272></a>    <span class=k>def</span> <span class=nf>join</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a name=line-273></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-274></a><span class=sd>        Wait for the child process to exit.</span>
<a name=line-275></a>
<a name=line-276></a><span class=sd>        This method is a coroutine.</span>
<a name=line-277></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-278></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_check_closed</span><span class=p>()</span>
<a name=line-279></a>        <span class=k>assert</span> <span class=bp>self</span><span class=o>.</span><span class=n>_state</span><span class=o>.</span><span class=n>pid</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>,</span> <span class=s2>&quot;can only join a started process&quot;</span>
<a name=line-280></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_state</span><span class=o>.</span><span class=n>exitcode</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-281></a>            <span class=k>return</span>
<a name=line-282></a>        <span class=k>if</span> <span class=n>timeout</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a name=line-283></a>            <span class=k>yield</span> <span class=bp>self</span><span class=o>.</span><span class=n>_exit_future</span>
<a name=line-284></a>        <span class=k>else</span><span class=p>:</span>
<a name=line-285></a>            <span class=k>try</span><span class=p>:</span>
<a name=line-286></a>                <span class=k>yield</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>wait_for</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_exit_future</span><span class=p>,</span> <span class=n>timeout</span><span class=p>)</span>
<a name=line-287></a>            <span class=k>except</span> <span class=ne>TimeoutError</span><span class=p>:</span>
<a name=line-288></a>                <span class=k>pass</span>
<a name=line-289></a>
<a name=line-290></a>    <span class=k>def</span> <span class=nf>close</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-291></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-292></a><span class=sd>        Stop helper thread and release resources.  This method returns</span>
<a name=line-293></a><span class=sd>        immediately and does not ensure the child process has exited.</span>
<a name=line-294></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-295></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_closed</span><span class=p>:</span>
<a name=line-296></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_thread_finalizer</span><span class=p>()</span>
<a name=line-297></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_process</span> <span class=o>=</span> <span class=kc>None</span>
<a name=line-298></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_closed</span> <span class=o>=</span> <span class=kc>True</span>
<a name=line-299></a>
<a name=line-300></a>    <span class=k>def</span> <span class=nf>set_exit_callback</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>):</span>
<a name=line-301></a>        <span class=sd>&quot;&quot;&quot;</span>
<a name=line-302></a><span class=sd>        Set a function to be called by the event loop when the process exits.</span>
<a name=line-303></a><span class=sd>        The function is called with the AsyncProcess as sole argument.</span>
<a name=line-304></a>
<a name=line-305></a><span class=sd>        The function may be a coroutine function.</span>
<a name=line-306></a><span class=sd>        &quot;&quot;&quot;</span>
<a name=line-307></a>        <span class=c1># XXX should this be a property instead?</span>
<a name=line-308></a>        <span class=k>assert</span> <span class=n>callable</span><span class=p>(</span><span class=n>func</span><span class=p>),</span> <span class=s2>&quot;exit callback should be callable&quot;</span>
<a name=line-309></a>        <span class=k>assert</span> <span class=p>(</span>
<a name=line-310></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_state</span><span class=o>.</span><span class=n>pid</span> <span class=ow>is</span> <span class=kc>None</span>
<a name=line-311></a>        <span class=p>),</span> <span class=s2>&quot;cannot set exit callback when process already started&quot;</span>
<a name=line-312></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_exit_callback</span> <span class=o>=</span> <span class=n>func</span>
<a name=line-313></a>
<a name=line-314></a>    <span class=k>def</span> <span class=nf>is_alive</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-315></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_state</span><span class=o>.</span><span class=n>is_alive</span>
<a name=line-316></a>
<a name=line-317></a>    <span class=nd>@property</span>
<a name=line-318></a>    <span class=k>def</span> <span class=nf>pid</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-319></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_state</span><span class=o>.</span><span class=n>pid</span>
<a name=line-320></a>
<a name=line-321></a>    <span class=nd>@property</span>
<a name=line-322></a>    <span class=k>def</span> <span class=nf>exitcode</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-323></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_state</span><span class=o>.</span><span class=n>exitcode</span>
<a name=line-324></a>
<a name=line-325></a>    <span class=nd>@property</span>
<a name=line-326></a>    <span class=k>def</span> <span class=nf>name</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-327></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_name</span>
<a name=line-328></a>
<a name=line-329></a>    <span class=nd>@property</span>
<a name=line-330></a>    <span class=k>def</span> <span class=nf>daemon</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a name=line-331></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process</span><span class=o>.</span><span class=n>daemon</span>
<a name=line-332></a>
<a name=line-333></a>    <span class=nd>@daemon</span><span class=o>.</span><span class=n>setter</span>
<a name=line-334></a>    <span class=k>def</span> <span class=nf>daemon</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
<a name=line-335></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_process</span><span class=o>.</span><span class=n>daemon</span> <span class=o>=</span> <span class=n>value</span>
<a name=line-336></a>
<a name=line-337></a>
<a name=line-338></a><span class=k>def</span> <span class=nf>_asyncprocess_finalizer</span><span class=p>(</span><span class=n>proc</span><span class=p>):</span>
<a name=line-339></a>    <span class=k>if</span> <span class=n>proc</span><span class=o>.</span><span class=n>is_alive</span><span class=p>():</span>
<a name=line-340></a>        <span class=k>try</span><span class=p>:</span>
<a name=line-341></a>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;reaping stray process </span><span class=si>%s</span><span class=s2>&quot;</span> <span class=o>%</span> <span class=p>(</span><span class=n>proc</span><span class=p>,))</span>
<a name=line-342></a>            <span class=n>proc</span><span class=o>.</span><span class=n>terminate</span><span class=p>()</span>
<a name=line-343></a>        <span class=k>except</span> <span class=ne>OSError</span><span class=p>:</span>
<a name=line-344></a>            <span class=k>pass</span>
</pre></div></td></tr></table><p class=footer> Generated by <a href=https://github.com/spirali/nedoc>nedoc</a> v0.9 at 2020-12-29 14:05 </p></div></div></body></html>