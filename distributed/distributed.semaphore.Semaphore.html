<!DOCTYPE html><html><head><meta charset=utf-8><title>distributed.semaphore.Semaphore</title><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=stylesheet href=./assets/purecss/pure-min.css><link rel=stylesheet href=./assets/purecss/grids-responsive-min.css><link rel=stylesheet href=./assets/style.css><link rel=stylesheet href=./assets/pygments/default.css><link rel=stylesheet href=./assets/jquery/jquery-ui.min.css><script src=./assets/jquery/jquery-3.0.0.min.js></script><script src=./assets/jquery/jquery-ui.min.js></script><script src=nedoc.js></script></head><body><div id=layout class=pure-g><div class="sidebar pure-u-1 pure-u-md-1-4"><div class=header><h1 class=brand-title>Distributed</h1> 1.0 </div><div id=sbox><input id=search style="color: black;" placeholder="search ..."></div><div class=tree><ul><li><a href=distributed.html>&#9662; distributed</a> </li><li><ul><li><a href=distributed.actor.html>&#9656; actor</a> </li><li><a href=distributed.asyncio.html>&#9656; asyncio</a> </li><li><a href=distributed.batched.html>&#9656; batched</a> </li><li><a href=distributed.bokeh.html>&#9656; bokeh</a> </li><li><a href=distributed.cfexecutor.html>&#9656; cfexecutor</a> </li><li><a href=distributed.cli.html>&#9656; cli</a> </li><li><a href=distributed.client.html>&#9656; client</a> </li><li><a href=distributed.comm.html>&#9656; comm</a> </li><li><a href=distributed.compatibility.html>&#9656; compatibility</a> </li><li><a href=distributed.config.html>&#9656; config</a> </li><li><a href=distributed.core.html>&#9656; core</a> </li><li><a href=distributed.counter.html>&#9656; counter</a> </li><li><a href=distributed.dashboard.html>&#9656; dashboard</a> </li><li><a href=distributed.deploy.html>&#9656; deploy</a> </li><li><a href=distributed.diagnostics.html>&#9656; diagnostics</a> </li><li><a href=distributed.diskutils.html>&#9656; diskutils</a> </li><li><a href=distributed.event.html>&#9656; event</a> </li><li><a href=distributed.http.html>&#9656; http</a> </li><li><a href=distributed.lock.html>&#9656; lock</a> </li><li><a href=distributed.locket.html>&#9656; locket</a> </li><li><a href=distributed.metrics.html>&#9656; metrics</a> </li><li><a href=distributed.nanny.html>&#9656; nanny</a> </li><li><a href=distributed.node.html>&#9656; node</a> </li><li><a href=distributed.preloading.html>&#9656; preloading</a> </li><li><a href=distributed.process.html>&#9656; process</a> </li><li><a href=distributed.proctitle.html>&#9656; proctitle</a> </li><li><a href=distributed.profile.html>&#9656; profile</a> </li><li><a href=distributed.protocol.html>&#9656; protocol</a> </li><li><a href=distributed.publish.html>&#9656; publish</a> </li><li><a href=distributed.pubsub.html>&#9656; pubsub</a> </li><li><a href=distributed.pytest_resourceleaks.html>&#9656; pytest_resourceleaks</a> </li><li><a href=distributed.queues.html>&#9656; queues</a> </li><li><a href=distributed.recreate_exceptions.html>&#9656; recreate_exceptions</a> </li><li><a href=distributed.scheduler.html>&#9656; scheduler</a> </li><li><a href=distributed.security.html>&#9656; security</a> </li><li><a href=distributed.semaphore.html>&#9662; semaphore</a> </li><li><ul><li><div class=select><a href=distributed.semaphore.Semaphore.html> <i>class</i> Semaphore</a> </div></li><li><a href=distributed.semaphore.SemaphoreExtension.html> <i>class</i> SemaphoreExtension</a> </li></ul></li><li><a href=distributed.sizeof.html>&#9656; sizeof</a> </li><li><a href=distributed.stealing.html>&#9656; stealing</a> </li><li><a href=distributed.system.html>&#9656; system</a> </li><li><a href=distributed.system_monitor.html>&#9656; system_monitor</a> </li><li><a href=distributed.tests.html>&#9656; tests</a> </li><li><a href=distributed.threadpoolexecutor.html>&#9656; threadpoolexecutor</a> </li><li><a href=distributed.utils.html>&#9656; utils</a> </li><li><a href=distributed.utils_comm.html>&#9656; utils_comm</a> </li><li><a href=distributed.utils_perf.html>&#9656; utils_perf</a> </li><li><a href=distributed.utils_test.html>&#9656; utils_test</a> </li><li><a href=distributed.variable.html>&#9656; variable</a> </li><li><a href=distributed.versions.html>&#9656; versions</a> </li><li><a href=distributed.worker.html>&#9656; worker</a> </li><li><a href=distributed.worker_client.html>&#9656; worker_client</a> </li></ul></ul></div></div><div class="content pure-u-1 pure-u-md-3-4"><h1>Class Semaphore</h1><div id=path><a class=symbol href=distributed.html>distributed</a>.<a class=symbol href=distributed.semaphore.html>semaphore</a>.<a class=symbol href=distributed.semaphore.Semaphore.html>Semaphore</a></div><p><div class=docline> Semaphore </div></p><h2>Declaration</h2><div class=decl><span class=kw>class</span> Semaphore</div><a class=sourcelink href=source+distributed.semaphore.py.html#line-268>source</a> <a class=sourcelink href=distributed.semaphore.Semaphore.html>link</a><h2>Documentation</h2><pre>This `semaphore &lt;https://en.wikipedia.org/wiki/Semaphore_(programming)&gt;`_
will track leases on the scheduler which can be acquired and
released by an instance of this class. If the maximum amount of leases are
already acquired, it is not possible to acquire more and the caller waits
until another lease has been released.

The lifetime or leases are controlled using a timeout. This timeout is
refreshed in regular intervals by the ``Client`` of this instance and
provides protection from deadlocks or resource starvation in case of worker
failure.
The timeout can be controlled using the configuration option
``distributed.scheduler.locks.lease-timeout`` and the interval in which the
scheduler verifies the timeout is set using the option
``distributed.scheduler.locks.lease-validation-interval``.

A noticeable difference to the Semaphore of the python standard library is
that this implementation does not allow to release more often than it was
acquired. If this happens, a warning is emitted but the internal state is
not modified.

.. warning::

    This implementation is still in an experimental state and subtle
    changes in behavior may occur without any change in the major version
    of this library.

.. warning::

    This implementation is susceptible to lease overbooking in case of
    lease timeouts. It is advised to monitor log information and adjust
    above configuration options to suitable values for the user application.</pre><h3>Attributes</h3><ul class=params><li><strong>max_leases</strong> : int <br><pre>The maximum amount of leases that may be granted at the same time. This
effectively sets an upper limit to the amount of parallel access to a specific resource.
Defaults to 1.</pre></li><li><strong>name</strong> : string <br><pre>Name of the semaphore to acquire.  Choosing the same name allows two
disconnected processes to coordinate.  If not given, a random
name will be generated.</pre></li><li><strong>client</strong> : Client <br><pre>Client to use for communication with the scheduler.  If not given, the
default global client will be used.</pre></li><li><strong>register</strong> : bool <br><pre>If True, register the semaphore with the scheduler. This needs to be
done before any leases can be acquired. If not done during
initialization, this can also be done by calling the register method of
this class.
When registering, this needs to be awaited.</pre></li></ul><h3>Examples</h3><pre>&gt;&gt;&gt; from distributed import Semaphore
... sem = Semaphore(max_leases=2, name=&#39;my_database&#39;)
...
... def access_resource(s, sem):
...     # This automatically acquires a lease from the semaphore (if available) which will be
...     # released when leaving the context manager.
...     with sem:
...         pass
...
... futures = client.map(access_resource, range(10), sem=sem)
... client.gather(futures)
... # Once done, close the semaphore to clean up the state on scheduler side.
... sem.close()</pre><h3>Notes</h3><pre>If a client attempts to release the semaphore but doesn&#39;t have a lease acquired, this will raise an exception.


When a semaphore is closed, if, for that closed semaphore, a client attempts to:

- Acquire a lease: an exception will be raised.
- Release: a warning will be logged.
- Close: nothing will happen.


dask executes functions by default assuming they are pure, when using semaphore acquire/releases inside
such a function, it must be noted that there *are* in fact side-effects, thus, the function can no longer be
considered pure. If this is not taken into account, this may lead to unexpected behavior.</pre><h2>Methods</h2><ul class=deflst><li><div class=fn><a id=f___await__></a><div class=fshort><span class=def><span class=ftoggle-empty>&#9655;</span> def <a class="fexpand symbol-no-doc" href=distributed.semaphore.Semaphore.html#f___await__>__await__</a>(<span class=args>self</span>) </span></div><div class=fdetail id=fn___await__><div class=idnt><a class=sourcelink href=source+distributed.semaphore.py.html#line-405>source</a> <a class=sourcelink href=distributed.semaphore.Semaphore.html#f___await__>link</a></div></div></div></li><li><div class=fn><a id=f___del__></a><div class=fshort><span class=def><span class=ftoggle-empty>&#9655;</span> def <a class="fexpand symbol-no-doc" href=distributed.semaphore.Semaphore.html#f___del__>__del__</a>(<span class=args>self</span>) </span></div><div class=fdetail id=fn___del__><div class=idnt><a class=sourcelink href=source+distributed.semaphore.py.html#line-536>source</a> <a class=sourcelink href=distributed.semaphore.Semaphore.html#f___del__>link</a></div></div></div></li><li><div class=fn><a id=f___enter__></a><div class=fshort><span class=def><span class=ftoggle-empty>&#9655;</span> def <a class="fexpand symbol-no-doc" href=distributed.semaphore.Semaphore.html#f___enter__>__enter__</a>(<span class=args>self</span>) </span></div><div class=fdetail id=fn___enter__><div class=idnt><a class=sourcelink href=source+distributed.semaphore.py.html#line-509>source</a> <a class=sourcelink href=distributed.semaphore.Semaphore.html#f___enter__>link</a></div></div></div></li><li><div class=fn><a id=f___exit__></a><div class=fshort><span class=def><span class=ftoggle-empty>&#9655;</span> def <a class="fexpand symbol-no-doc" href=distributed.semaphore.Semaphore.html#f___exit__>__exit__</a>(<span class=args>self, *args, **kwargs</span>) </span></div><div class=fdetail id=fn___exit__><div class=idnt><a class=sourcelink href=source+distributed.semaphore.py.html#line-513>source</a> <a class=sourcelink href=distributed.semaphore.Semaphore.html#f___exit__>link</a></div></div></div></li><li><div class=fn><a id=f___getstate__></a><div class=fshort><span class=def><span class=ftoggle-empty>&#9655;</span> def <a class="fexpand symbol-no-doc" href=distributed.semaphore.Semaphore.html#f___getstate__>__getstate__</a>(<span class=args>self</span>) </span></div><div class=fdetail id=fn___getstate__><div class=idnt><a class=sourcelink href=source+distributed.semaphore.py.html#line-523>source</a> <a class=sourcelink href=distributed.semaphore.Semaphore.html#f___getstate__>link</a></div></div></div></li><li><div class=fn><a id=f___init__></a><div class=fshort><span class=def><span class=ftoggle-empty>&#9655;</span> def <a class="fexpand symbol-no-doc" href=distributed.semaphore.Semaphore.html#f___init__>__init__</a>(<span class=args>self, max_leases=1, name=None, client=None, register=True</span>) </span></div><div class=fdetail id=fn___init__><div class=idnt><a class=sourcelink href=source+distributed.semaphore.py.html#line-357>source</a> <a class=sourcelink href=distributed.semaphore.Semaphore.html#f___init__>link</a></div></div></div></li><li><div class=fn><a id=f___setstate__></a><div class=fshort><span class=def><span class=ftoggle-empty>&#9655;</span> def <a class="fexpand symbol-no-doc" href=distributed.semaphore.Semaphore.html#f___setstate__>__setstate__</a>(<span class=args>self, state</span>) </span></div><div class=fdetail id=fn___setstate__><div class=idnt><a class=sourcelink href=source+distributed.semaphore.py.html#line-528>source</a> <a class=sourcelink href=distributed.semaphore.Semaphore.html#f___setstate__>link</a></div></div></div></li><li><div class=fn><a id=f_acquire></a><div class=fshort><span class=def><span class=ftoggle>&#9654;</span> def <a class="fexpand symbol" href=distributed.semaphore.Semaphore.html#f_acquire>acquire</a>(<span class=args>self, timeout=None</span>) </span><div class=docline> Acquire a semaphore. </div></div><div class=fdetail id=fn_acquire><div class=idnt><a class=sourcelink href=source+distributed.semaphore.py.html#line-446>source</a> <a class=sourcelink href=distributed.semaphore.Semaphore.html#f_acquire>link</a></div><pre>If the internal counter is greater than zero, decrement it by one and return True immediately.
If it is zero, wait until a release() is called and return True.</pre><h3>Parameters</h3><ul class=params><li><strong>timeout</strong> : number or string or timedelta <br><pre>Seconds to wait on acquiring the semaphore.  This does not
include local coroutine time, network transfer time, etc..
Instead of number of seconds, it is also possible to specify
a timedelta in string format, e.g. &#34;200ms&#34;.</pre></li></ul></div></div></li><li><div class=fn><a id=f_close></a><div class=fshort><span class=def><span class=ftoggle-empty>&#9655;</span> def <a class="fexpand symbol-no-doc" href=distributed.semaphore.Semaphore.html#f_close>close</a>(<span class=args>self</span>) </span></div><div class=fdetail id=fn_close><div class=idnt><a class=sourcelink href=source+distributed.semaphore.py.html#line-533>source</a> <a class=sourcelink href=distributed.semaphore.Semaphore.html#f_close>link</a></div></div></div></li><li><div class=fn><a id=f_get_value></a><div class=fshort><span class=def><span class=ftoggle-empty>&#9655;</span> def <a class="fexpand symbol" href=distributed.semaphore.Semaphore.html#f_get_value>get_value</a>(<span class=args>self</span>) </span><div class=docline> Return the number of currently registered leases. </div></div><div class=fdetail id=fn_get_value><div class=idnt><a class=sourcelink href=source+distributed.semaphore.py.html#line-503>source</a> <a class=sourcelink href=distributed.semaphore.Semaphore.html#f_get_value>link</a></div></div></div></li><li><div class=fn><a id=f_register></a><div class=fshort><span class=def><span class=ftoggle>&#9654;</span> def <a class="fexpand symbol" href=distributed.semaphore.Semaphore.html#f_register>register</a>(<span class=args>self</span>) </span><div class=docline> Register the semaphore on scheduler side </div></div><div class=fdetail id=fn_register><div class=idnt><a class=sourcelink href=source+distributed.semaphore.py.html#line-391>source</a> <a class=sourcelink href=distributed.semaphore.Semaphore.html#f_register>link</a></div><pre>This will register the semaphore on scheduler side and ensure that all necessary data structures exist.</pre></div></div></li><li><div class=fn><a id=f_release></a><div class=fshort><span class=def><span class=ftoggle>&#9654;</span> def <a class="fexpand symbol" href=distributed.semaphore.Semaphore.html#f_release>release</a>(<span class=args>self</span>) </span><div class=docline> Release the semaphore. </div></div><div class=fdetail id=fn_release><div class=idnt><a class=sourcelink href=source+distributed.semaphore.py.html#line-486>source</a> <a class=sourcelink href=distributed.semaphore.Semaphore.html#f_release>link</a></div><h3>Returns</h3><ul class=params><li> bool <br><pre>This value indicates whether a lease was released immediately or not. Note that a user should  *not* retry
this operation. Under certain circumstances (e.g. scheduler overload) the lease may not be released
immediately, but it will always be automatically released after a specific interval configured using
&#34;distributed.scheduler.locks.lease-validation-interval&#34; and &#34;distributed.scheduler.locks.lease-timeout&#34;.</pre></li></ul></div></div></li></ul><h2>Reexports</h2><ul class=deflst><li> Imported in <a class=symbol href=distributed.http.scheduler.tests.test_semaphore_http.html>distributed.http.scheduler.tests.test_semaphore_http</a>. </li><li> Imported in <a class=symbol href=distributed.tests.test_semaphore.html>distributed.tests.test_semaphore</a>. </li><li> Imported in <a class=symbol href=distributed.html>distributed</a>. </li></ul><p class=footer> Generated by <a href=https://github.com/spirali/nedoc>nedoc</a> v0.9 at 2020-12-29 14:05 </p></div></div></body></html>